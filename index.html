<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simular Pedido — São José</title>
  <style>
    :root{
      --azul:#007BFF;
      --fundo:#fbfcfe;
      --card:#ffffff;
      --muted:#6b7280;
      --accent:#0b5ed7;
      --glass: rgba(11,78,167,0.04);
    }
    html,body{height:100%;margin:0;font-family:monospace;background:var(--fundo);color:#111}
    .wrap{max-width:1100px;margin:18px auto;padding:18px}
    h1{margin:0 0 8px 0;color:var(--accent);font-size:20px}
    p.lead{margin:4px 0 18px 0;color:var(--muted);font-size:13px}

    .grid{display:grid;grid-template-columns: 360px 1fr;gap:16px}
    @media (max-width:860px){ .grid{grid-template-columns:1fr} }

    .card{background:var(--card);border:1px solid #e6eefc;padding:12px;border-radius:8px;box-shadow:0 4px 12px var(--glass)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text], input[type=number]{width:100%;padding:8px;border-radius:6px;border:1px solid #eef6ff;background:#fff}
    .row{display:flex;gap:8px}
    .btn{display:inline-block;padding:8px 10px;border-radius:8px;border:0;background:var(--azul);color:white;font-weight:600;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--azul);border:1px solid #e6eefc}
    .btn.warn{background:#ff7b59}
    .preset-list{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
    .preset{padding:6px 8px;border-radius:6px;border:1px solid #e6eefc;background:#f7fbff;cursor:pointer;font-size:13px}

    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:8px;border-bottom:1px solid #f0f6ff;text-align:left}
    th{font-size:13px;color:var(--muted)}
    td.actions{width:100px;text-align:right}
    .qty-input{width:72px}

    .totals{display:flex;justify-content:flex-end;gap:18px;align-items:center;margin-top:12px}
    .totals .total{font-size:18px;font-weight:700;color:var(--azul)}

    .meta{font-size:13px;color:var(--muted);margin-top:10px}

    /* small helpers */
    .small{font-size:12px;color:var(--muted)}
    .empty{padding:12px;text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap" role="main">
    <h1>Simular Pedido</h1>
    <p class="lead">Monte um pedido rapidamente: adicione produtos, ajuste quantidades e gere um resumo imprimível ou exporte em CSV.</p>

    <div class="grid">
      <!-- coluna esquerda: adicionar produtos / presets -->
      <div class="card" aria-labelledby="add-title">
        <div id="add-title"><strong>Adicionar produto</strong></div>
        <div style="margin-top:8px">
          <label for="prod-name">Nome do produto</label>
          <input id="prod-name" type="text" placeholder="Ex: Baguete 7kg" />
        </div>
        <div style="margin-top:8px">
          <label for="prod-price">Preço unitário (R$)</label>
          <input id="prod-price" type="text" placeholder="Ex: 50,00" />
        </div>
        <div style="margin-top:8px">
          <label for="prod-qty">Quantidade</label>
          <input id="prod-qty" type="number" min="1" step="1" value="1" class="qty-input" />
        </div>

        <div style="margin-top:10px;display:flex;gap:8px">
          <button id="btn-add" class="btn">Adicionar</button>
          <button id="btn-clear-form" class="btn ghost">Limpar</button>
        </div>

        <div style="margin-top:14px">
          <div class="small">Presets rápidos</div>
          <div class="preset-list" id="preset-list">
            <!-- preenchidos via JS -->
          </div>
        </div>

        <div style="margin-top:12px" class="small">Dica: clique no produto preset para adicioná-lo rapidamente. Valores aceitam vírgula ou ponto.</div>
      </div>

      <!-- coluna direita: tabela do pedido -->
      <div class="card" aria-labelledby="order-title">
        <div id="order-title" style="display:flex;justify-content:space-between;align-items:center">
          <strong>Resumo do pedido</strong>
          <div style="display:flex;gap:8px">
            <button id="btn-copy" class="btn ghost" title="Copiar resumo">Copiar</button>
            <button id="btn-csv" class="btn ghost" title="Exportar CSV">CSV</button>
            <button id="btn-print" class="btn">Imprimir</button>
          </div>
        </div>

        <div id="order-table-wrapper">
          <table id="order-table" aria-live="polite">
            <thead>
              <tr>
                <th>Produto</th>
                <th>Valor unit.</th>
                <th>Qtd</th>
                <th style="text-align:right">Subtotal</th>
                <th class="actions" aria-hidden="true"></th>
              </tr>
            </thead>
            <tbody id="order-body">
              <tr class="empty-row"><td colspan="5" class="empty">Nenhum item adicionado. Use o formulário ao lado ou os presets.</td></tr>
            </tbody>
          </table>
        </div>

        <div class="totals">
          <div class="small">Itens: <span id="count-items">0</span></div>
          <div class="total">Total: <span id="total">R$ 0,00</span></div>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
          <button id="btn-clear" class="btn ghost">Limpar pedido</button>
        </div>

        <div class="meta">Salvamento automático: o pedido atual é mantido localmente no seu navegador.</div>
      </div>
    </div>

  </div>

  <script>
    // dados iniciais (exemplos) - altere conforme precisar
    const PRESETS = [
      {name: 'Baguete 06h 7kg', price: 50},
      {name: 'Pão Francês 1kg', price: 10},
      {name: 'Pão Doce (cx)', price: 20},
      {name: 'Brioche Médio', price: 18},
    ];

    // estado
    let items = [];

    // elementos
    const elName = document.getElementById('prod-name');
    const elPrice = document.getElementById('prod-price');
    const elQty = document.getElementById('prod-qty');
    const btnAdd = document.getElementById('btn-add');
    const btnClearForm = document.getElementById('btn-clear-form');
    const presetList = document.getElementById('preset-list');
    const orderBody = document.getElementById('order-body');
    const totalEl = document.getElementById('total');
    const countItems = document.getElementById('count-items');
    const btnCopy = document.getElementById('btn-copy');
    const btnCSV = document.getElementById('btn-csv');
    const btnPrint = document.getElementById('btn-print');
    const btnClear = document.getElementById('btn-clear');

    // util: formata número para BRL
    function fmtBRL(v){
      return Number(v || 0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    }

    function parsePrice(str){
      if(!str) return NaN;
      // aceita vírgula ou ponto
      const normalized = String(str).replace(/\s/g,'').replace(',','.').replace(/[^0-9.\-]/g,'');
      return parseFloat(normalized);
    }

    // render presets
    function renderPresets(){
      presetList.innerHTML = '';
      PRESETS.forEach(p=>{
        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'preset';
        b.textContent = `${p.name} — ${fmtBRL(p.price)}`;
        b.addEventListener('click', ()=>{ addProduct(p.name, p.price, 1); });
        presetList.appendChild(b);
      });
    }

    // adicionar produto
    function addProduct(name, price, qty){
      const p = parseFloat(price);
      const q = Number(qty) || 1;
      if(!name || isNaN(p) || p < 0 || q <= 0){ alert('Nome, preço e quantidade válidos são necessários.'); return; }
      items.push({name: String(name).trim(), price: round(p,2), qty: Math.floor(q)});
      saveState(); render();
    }

    function round(n,dec=2){ return Math.round((n+Number.EPSILON)*Math.pow(10,dec))/Math.pow(10,dec); }

    // render tabela
    function render(){
      // limpa linhas
      orderBody.innerHTML = '';
      if(items.length === 0){
        const tr = document.createElement('tr'); tr.className='empty-row';
        tr.innerHTML = `<td colspan="5" class="empty">Nenhum item adicionado. Use o formulário ao lado ou os presets.</td>`;
        orderBody.appendChild(tr);
      } else {
        items.forEach((it, idx)=>{
          const tr = document.createElement('tr');
          const subtotal = round(it.price * it.qty,2);
          tr.innerHTML = `
            <td>${escapeHtml(it.name)}</td>
            <td>${fmtBRL(it.price)}</td>
            <td><input class="qty-input" type="number" min="1" step="1" value="${it.qty}" data-idx="${idx}" aria-label="Quantidade ${escapeHtml(it.name)}"></td>
            <td style="text-align:right">${fmtBRL(subtotal)}</td>
            <td class="actions"><button data-remove="${idx}" title="Remover" class="btn ghost">Remover</button></td>
          `;
          orderBody.appendChild(tr);
        });
      }

      // attach listeners for qty and remove
      orderBody.querySelectorAll('input[type=number]').forEach(inp=>{
        inp.addEventListener('change', (e)=>{
          const i = Number(e.target.dataset.idx); const v = Number(e.target.value) || 1;
          items[i].qty = Math.max(1, Math.floor(v)); saveState(); render();
        });
      });
      orderBody.querySelectorAll('button[data-remove]').forEach(b=>{
        b.addEventListener('click', ()=>{
          const i = Number(b.getAttribute('data-remove'));
          items.splice(i,1); saveState(); render();
        });
      });

      // atualiza total
      const tot = items.reduce((s,it)=> s + it.price*it.qty, 0);
      totalEl.textContent = fmtBRL(round(tot,2));
      countItems.textContent = items.length;
    }

    // escape HTML para segurança básica
    function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // handlers
    btnAdd.addEventListener('click', ()=>{
      const n = elName.value.trim();
      const p = parsePrice(elPrice.value);
      const q = Number(elQty.value) || 1;
      if(!n || isNaN(p)) { alert('Preencha nome e preço corretamente.'); return; }
      addProduct(n, p, q);
      elName.value=''; elPrice.value=''; elQty.value = 1; elName.focus();
    });

    btnClearForm.addEventListener('click', ()=>{ elName.value=''; elPrice.value=''; elQty.value=1; elName.focus(); });

    btnClear.addEventListener('click', ()=>{
      if(confirm('Limpar o pedido atual?')){ items = []; saveState(); render(); }
    });

    // copiar resumo para área de transferência
    btnCopy.addEventListener('click', async ()=>{
      if(items.length===0){ alert('Nenhum item para copiar.'); return; }
      const lines = items.map(it => `${it.qty} x ${it.name} — ${fmtBRL(it.price)} = ${fmtBRL(round(it.price*it.qty,2))}`);
      lines.push('---'); lines.push('Total: ' + totalEl.textContent);
      const text = lines.join('\n');
      try{ await navigator.clipboard.writeText(text); alert('Resumo copiado para a área de transferência.'); } catch(e){ prompt('Copie manualmente o texto abaixo:', text); }
    });

    // exportar CSV
    btnCSV.addEventListener('click', ()=>{
      if(items.length===0){ alert('Nenhum item para exportar.'); return; }
      const header = ['Produto','PrecoUnit','Quantidade','Subtotal'];
      const rows = items.map(it=> [it.name, it.price.toFixed(2), it.qty, (it.price*it.qty).toFixed(2)].map(v=>`"${String(v).replace(/"/g,'""')}"`).join(','));
      const csv = [header.join(','), ...rows].join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'pedido.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    // imprimir (abre nova janela com resumo simplificado)
    btnPrint.addEventListener('click', ()=>{
      if(items.length===0){ alert('Nenhum item para imprimir.'); return; }
      const w = window.open('', '_blank');
      const rows = items.map(it=> `<tr><td>${escapeHtml(it.name)}</td><td style="text-align:right">${fmtBRL(it.price)}</td><td style="text-align:center">${it.qty}</td><td style="text-align:right">${fmtBRL(round(it.price*it.qty,2))}</td></tr>`).join('');
      const html = `<!doctype html><html lang="pt-BR"><head><meta charset="utf-8"><title>Resumo do Pedido</title><style>body{font-family:monospace;padding:20px}table{width:100%;border-collapse:collapse}td,th{padding:8px;border-bottom:1px solid #ddd}h2{color:#0b5ed7}</style></head><body><h2>Resumo do Pedido</h2><table><thead><tr><th>Produto</th><th>Valor unit.</th><th>Qtd</th><th style="text-align:right">Subtotal</th></tr></thead><tbody>${rows}</tbody></table><h3 style="text-align:right">Total: ${totalEl.textContent}</h3><p style="font-size:12px;color:#666">Gerado em ${new Date().toLocaleString('pt-BR')}</p><script>window.print();</script></body></html>`;
      w.document.open(); w.document.write(html); w.document.close();
    });

    // estado em localStorage
    function saveState(){ try{ localStorage.setItem('simularpedido_items', JSON.stringify(items)); }catch(e){} }
    function loadState(){ try{ const s = localStorage.getItem('simularpedido_items'); if(s) items = JSON.parse(s); }catch(e){ items = []; } }

    // inicialização
    (function init(){
      renderPresets(); loadState(); render();

      // atalho Enter no campo preço para adicionar
      elPrice.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') btnAdd.click(); });
    })();
  </script>
</body>
</html>
