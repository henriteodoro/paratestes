<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pedido — Pão Total</title>

<link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700;800&family=DM+Sans:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
:root {
  --bg: #eef3fb;
  --surface: #ffffff;
  --surface2: #f4f8ff;
  --border: #dce8fb;
  --border2: #c8d9f5;
  --text-primary: #1a2740;
  --text-secondary: #4e6080;
  --text-muted: #8fa3bf;
  --accent: #1a56db;
  --accent-dark: #1040b0;
  --accent-light: #e8f0fe;
  --success: #10b981;
  --danger: #dc2626;
  --warn: #f59e0b;
  --shadow-sm: 0 2px 8px rgba(20,60,120,0.07);
  --shadow-md: 0 6px 24px rgba(20,60,120,0.10);
  --shadow-lg: 0 14px 40px rgba(20,60,120,0.14);
  --radius-sm: 10px;
  --radius-md: 16px;
  --radius-lg: 22px;
  --print-border: 1.5px;
  --screen-font: 'DM Sans', system-ui, sans-serif;
  --print-font: 'Helvetica', Arial, sans-serif;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; }

body {
  font-family: var(--screen-font);
  background: var(--bg);
  color: var(--text-primary);
  line-height: 1.55;
}

body::before {
  content: '';
  position: fixed; inset: 0;
  background-image: radial-gradient(circle, #c0d0eb 1px, transparent 1px);
  background-size: 28px 28px;
  opacity: 0.3;
  pointer-events: none;
  z-index: 0;
}

.sr-only {
  position: absolute; width: 1px; height: 1px; padding: 0;
  margin: -1px; overflow: hidden; clip: rect(0,0,0,0);
  white-space: nowrap; border: 0;
}

/* ── TOPBAR ─────────────────────────────────── */
.topbar {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
  padding: 0 20px;
  height: 62px;
  display: flex;
  align-items: center;
  gap: 10px;
  position: sticky;
  top: 0;
  z-index: 100;
}

.topbar-left {
  display: flex;
  align-items: center;
  gap: 4px;
  flex-shrink: 0;
}

.topbar-brand {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-shrink: 0;
}
.brand-icon {
  width: 38px; height: 38px;
  background: var(--accent);
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 4px 12px rgba(26,86,219,0.3);
  font-family: 'Sora', sans-serif;
  font-weight: 800;
  font-size: 0.7rem;
  color: white;
  letter-spacing: -0.5px;
  flex-shrink: 0;
  text-align: center;
  line-height: 1.2;
}
.brand-name {
  font-family: 'Sora', sans-serif;
  font-weight: 700;
  font-size: 1rem;
  color: var(--accent);
  line-height: 1.1;
  white-space: nowrap;
}
.brand-sub {
  font-size: 0.7rem;
  color: var(--text-muted);
  font-weight: 500;
}

/* ── NAV ARROW ──────────────────────────────── */
.nav-arrow-btn {
  display: flex; align-items: center; justify-content: center;
  width: 32px; height: 32px;
  border-radius: 8px;
  border: 1.5px solid var(--border2);
  background: white;
  color: var(--text-secondary);
  cursor: pointer;
  text-decoration: none;
  flex-shrink: 0;
  transition: all 0.18s;
}
.nav-arrow-btn:hover {
  background: var(--accent-light);
  border-color: var(--accent);
  color: var(--accent);
}

.topbar-divider {
  width: 1px; height: 28px;
  background: var(--border);
  flex-shrink: 0;
  margin: 0 2px;
}
.topbar-spacer { flex: 1; }
.topbar-actions {
  display: flex;
  gap: 4px;
  align-items: center;
  flex-shrink: 0;
}

/* ── ICON BUTTONS ─────────────────────────────── */
.icon-btn {
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 7px 8px;
  border-radius: 8px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: all 0.18s;
  position: relative;
}
.icon-btn svg { width: 20px; height: 20px; display: block; }
.icon-btn:hover {
  background: var(--accent-light);
  color: var(--accent);
}

/* ── DROPDOWNS ──────────────────────────────── */
.menu-dropdown { position: relative; }
.menu-dropdown-content {
  display: none;
  position: absolute;
  top: calc(100% + 8px);
  left: 0;
  background: var(--surface);
  border: 1.5px solid var(--border2);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  min-width: 270px;
  max-width: calc(100vw - 32px);
  overflow: auto;
  z-index: 1200;
  padding: 6px;
}
.menu-right .menu-dropdown-content { right: 0; left: auto; }

.menu-dropdown-content a {
  display: flex;
  align-items: center;
  padding: 9px 11px;
  color: var(--text-primary);
  text-decoration: none;
  font-size: 0.87rem;
  border-radius: 8px;
  transition: all 0.15s;
  gap: 8px;
}
.menu-dropdown-content a:hover {
  background: var(--accent-light);
  color: var(--accent);
}

.dropdown-section {
  border-top: 1px solid var(--border);
  margin-top: 4px;
  padding-top: 4px;
}
.dropdown-section:first-child { border-top: none; margin-top: 0; padding-top: 0; }

.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  padding: 8px 11px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.8rem;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--text-muted);
  border-radius: 8px;
  transition: all 0.15s;
}
.section-header:hover {
  background: var(--surface2);
  color: var(--text-secondary);
}

.mac-code {
  display: inline-flex; align-items: center; justify-content: center;
  background: var(--accent);
  color: white;
  padding: 3px 7px;
  border-radius: 6px;
  font-size: 0.75rem;
  font-weight: 700;
  min-width: 36px;
  flex-shrink: 0;
}

.submenu { display: none; padding-left: 4px; }
.submenu a { padding-left: 14px; }

/* ── SAVE DROPDOWN ──────────────────────────── */
.save-dropdown {
  display: none;
  position: absolute;
  top: calc(100% + 6px);
  right: 0;
  background: var(--surface);
  border: 1.5px solid var(--border2);
  border-radius: var(--radius-sm);
  box-shadow: var(--shadow-lg);
  min-width: 200px;
  z-index: 1200;
  padding: 6px;
}
.save-dropdown a {
  display: flex; align-items: center; gap: 8px;
  padding: 9px 12px;
  border-radius: 8px;
  color: var(--text-primary);
  text-decoration: none;
  font-size: 0.87rem;
  transition: background 0.15s;
}
.save-dropdown a svg { width: 15px; height: 15px; color: var(--text-muted); flex-shrink: 0; }
.save-dropdown a:hover { background: var(--accent-light); color: var(--accent); }
.save-dropdown a:hover svg { color: var(--accent); }

/* ── MAIN LAYOUT ────────────────────────────── */
.page-wrapper {
  position: relative;
  z-index: 1;
  padding: 20px 20px 60px;
  max-width: 1280px;
  margin: 0 auto;
}

/* ── TOPBAR ROW ─────────────────────────────── */
.topbar-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 18px;
  flex-wrap: wrap;
}
.topbar-row-spacer { flex: 1; min-width: 16px; }

/* ── STAT CHIPS ─────────────────────────────── */
.stat-chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 14px;
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: 99px;
  font-size: 0.82rem;
  font-weight: 600;
  color: var(--text-secondary);
  box-shadow: var(--shadow-sm);
  white-space: nowrap;
}
.stat-chip svg { width: 14px; height: 14px; color: var(--accent); flex-shrink: 0; }
.stat-chip .val { color: var(--accent); font-family: 'Sora', sans-serif; }

/* ── DATE GROUP ─────────────────────────────── */
.date-group {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
  flex-wrap: nowrap;
}
.date-group label {
  font-size: 0.82rem;
  font-weight: 600;
  color: var(--text-secondary);
  white-space: nowrap;
}
.date-group input[type="text"] {
  border: 1.5px solid var(--border2);
  border-radius: 8px;
  padding: 6px 12px;
  width: 140px;
  font-family: var(--screen-font);
  font-size: 0.85rem;
  color: var(--text-primary);
  background: var(--surface);
  outline: none;
  transition: border-color 0.15s, box-shadow 0.15s;
  box-shadow: var(--shadow-sm);
}
.date-group input[type="text"]:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(26,86,219,0.12);
  background: white;
}
.chip {
  background: var(--surface);
  border: 1.5px solid var(--border2);
  border-radius: 99px;
  padding: 5px 13px;
  font-size: 0.78rem;
  font-weight: 600;
  font-family: var(--screen-font);
  cursor: pointer;
  color: var(--text-secondary);
  transition: all 0.15s;
  box-shadow: var(--shadow-sm);
  white-space: nowrap;
}
.chip:hover {
  background: var(--accent-light);
  border-color: var(--accent);
  color: var(--accent);
}

/* ── CONTENT GRID ───────────────────────────── */
.content-grid {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  gap: 16px;
  align-items: start;
}

/* ── COLUMN PANELS ──────────────────────────── */
.col-panel {
  background: var(--surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
}

.col-header {
  padding: 13px 18px;
  background: var(--surface2);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 10px;
}
.col-header-icon {
  width: 30px; height: 30px;
  border-radius: 8px;
  background: var(--accent);
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
  box-shadow: 0 2px 8px rgba(26,86,219,0.25);
}
.col-header-icon svg { width: 15px; height: 15px; color: white; }
.col-header-title {
  font-family: 'Sora', sans-serif;
  font-weight: 700;
  font-size: 0.9rem;
  color: var(--text-primary);
  flex: 1;
}

.col-body { padding: 8px; }

/* ── ITEMS ──────────────────────────────────── */
.item {
  display: grid;
  grid-template-columns: 1fr 118px;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  border-radius: 8px;
  border-bottom: 1px dashed var(--border);
  transition: background 0.13s;
}
.item:last-child { border-bottom: none; }
.item:hover { background: var(--surface2); }
.item.hidden-empty { display: none; }

.label-wrap {
  display: flex;
  align-items: center;
  gap: 6px;
  min-width: 0;
}

.item .label {
  font-size: 0.83rem;
  color: var(--text-primary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  display: inline-block;
  min-width: 0;
  font-family: var(--screen-font);
}
.item .label.expanded {
  white-space: normal;
  overflow: visible;
}

.ellipsis-btn {
  background: none;
  border: none;
  cursor: pointer;
  font-weight: 700;
  padding: 1px 5px;
  border-radius: 5px;
  font-size: 11px;
  color: var(--text-muted);
  flex-shrink: 0;
  transition: color 0.15s;
}
.ellipsis-btn:hover { color: var(--accent); }

/* ── SELETOR DE PESO ────────────────────────── */
.weight-selector {
  padding: 3px 6px;
  border: 1.5px solid var(--border2);
  border-radius: 7px;
  background: var(--surface);
  font-size: 0.75rem;
  font-family: var(--screen-font);
  color: var(--text-secondary);
  cursor: pointer;
  outline: none;
  transition: border-color 0.15s;
  flex-shrink: 0;
}
.weight-selector:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(26,86,219,0.12);
}

/* ── QTY WRAP COM BOTÕES +/- ─────────────────── */
.qty-wrap {
  display: inline-flex;
  align-items: center;
  border: 1.5px solid var(--border2);
  border-radius: 9px;
  overflow: hidden;
  background: var(--surface);
  transition: border-color 0.15s, box-shadow 0.15s;
  width: 100%;
}
.qty-wrap:focus-within {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(26,86,219,0.12);
}

.qty-btn {
  background: var(--surface2);
  border: none;
  color: var(--text-secondary);
  width: 28px;
  height: 34px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.15s;
  flex-shrink: 0;
  user-select: none;
}
.qty-btn svg { width: 12px; height: 12px; pointer-events: none; }
.qty-btn:hover { background: var(--accent-light); color: var(--accent); }
.qty-btn:active { background: var(--accent); color: white; }

input.qty-input {
  flex: 1;
  min-width: 0;
  padding: 6px 2px;
  border: none;
  text-align: center;
  font-family: 'Sora', sans-serif;
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--text-primary);
  background: transparent;
  outline: none;
  -moz-appearance: textfield;
}
input.qty-input::-webkit-outer-spin-button,
input.qty-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

/* ── CUSTOM ITEMS ─────────────────────────────── */
.custom-item {
  display: grid;
  grid-template-columns: 1fr 80px 26px;
  align-items: center;
  gap: 8px;
  padding: 7px 10px;
  border-radius: 8px;
  border-bottom: 1px dashed #86efac;
  background: #f0fdf4;
}
.custom-item:hover { background: #dcfce7; }

.custom-item input[type="text"] {
  width: 100%;
  padding: 6px 8px;
  border: 1.5px solid var(--border2);
  border-radius: 7px;
  font-family: var(--screen-font);
  font-size: 0.83rem;
  color: var(--text-primary);
  background: white;
  outline: none;
  transition: border-color 0.15s, box-shadow 0.15s;
}
.custom-item input[type="text"]:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(26,86,219,0.12);
}
.custom-item input[type="number"] {
  width: 100%;
  padding: 6px 6px;
  border: 1.5px solid var(--border2);
  border-radius: 7px;
  font-family: 'Sora', sans-serif;
  font-size: 0.85rem;
  text-align: center;
  color: var(--text-primary);
  background: white;
  outline: none;
  transition: border-color 0.15s, box-shadow 0.15s;
  -moz-appearance: textfield;
}
.custom-item input[type="number"]::-webkit-outer-spin-button,
.custom-item input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
.custom-item input[type="number"]:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(26,86,219,0.12);
}

.remove-btn {
  background: none;
  border: none;
  cursor: pointer;
  color: var(--text-muted);
  font-size: 13px;
  font-weight: 700;
  width: 22px; height: 22px;
  border-radius: 6px;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
  transition: all 0.15s;
}
.remove-btn:hover { background: #fee2e2; color: var(--danger); }

/* ── ADD ITEM BUTTON ─────────────────────────── */
.add-item-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  margin: 8px 8px 2px;
  padding: 8px 12px;
  background: var(--surface2);
  border: 1.5px dashed var(--border2);
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.81rem;
  font-weight: 600;
  color: var(--text-muted);
  font-family: var(--screen-font);
  transition: all 0.18s;
}
.add-item-btn:hover {
  background: var(--accent-light);
  border-color: var(--accent);
  border-style: solid;
  color: var(--accent);
}

/* ── MIDDLE CONTROLS ────────────────────────── */
.middle-controls {
  display: flex;
  flex-direction: column;
  gap: 8px;
  align-items: center;
  padding-top: 56px;
}

.ctrl-btn {
  width: 158px;
  padding: 10px 14px;
  font-size: 0.83rem;
  font-family: var(--screen-font);
  font-weight: 600;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  transition: all 0.18s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 7px;
  box-shadow: var(--shadow-sm);
}
.ctrl-btn svg { width: 14px; height: 14px; flex-shrink: 0; }
.ctrl-btn:hover { transform: translateY(-1px); box-shadow: var(--shadow-md); }
.ctrl-btn:active { transform: translateY(0); }

.ctrl-btn.green  { background: var(--success); color: white; }
.ctrl-btn.green:hover  { background: #059669; }
.ctrl-btn.amber  { background: var(--warn); color: white; }
.ctrl-btn.amber:hover  { background: #d97706; }
.ctrl-btn.red    { background: var(--danger); color: white; }
.ctrl-btn.red:hover    { background: #b91c1c; }

/* ── OBSERVATIONS ─────────────────────────────── */
.obs-panel {
  background: var(--surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
  margin-top: 16px;
}
.obs-header {
  padding: 13px 18px;
  background: var(--surface2);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 10px;
}
.obs-header-icon {
  width: 30px; height: 30px;
  border-radius: 8px;
  background: var(--warn);
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
  box-shadow: 0 2px 8px rgba(245,158,11,0.3);
}
.obs-header-icon svg { width: 15px; height: 15px; color: white; }
.obs-header-title {
  font-family: 'Sora', sans-serif;
  font-weight: 700;
  font-size: 0.9rem;
  color: var(--text-primary);
}
.obs-body { padding: 14px 16px; }
.obs-body textarea {
  width: 100%;
  min-height: 90px;
  padding: 10px 12px;
  resize: vertical;
  border: 1.5px solid var(--border2);
  border-radius: 10px;
  font-family: var(--screen-font);
  font-size: 0.85rem;
  color: var(--text-primary);
  background: var(--surface2);
  outline: none;
  transition: border-color 0.15s, box-shadow 0.15s;
}
.obs-body textarea:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(26,86,219,0.12);
  background: white;
}
.obs-options {
  margin-top: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.8rem;
  color: var(--text-secondary);
}
.obs-options input[type="checkbox"] { accent-color: var(--accent); }

/* ── TOAST ──────────────────────────────────── */
#copy-notice {
  position: fixed;
  right: 20px; bottom: 20px;
  background: var(--text-primary);
  color: white;
  padding: 10px 16px;
  border-radius: 10px;
  display: none;
  z-index: 3000;
  font-size: 0.85rem;
  font-weight: 500;
  box-shadow: var(--shadow-lg);
}

/* ── RESPONSIVE ─────────────────────────────── */
@media (max-width: 1100px) { .content-grid { gap: 12px; } }
@media (max-width: 900px) {
  .content-grid { grid-template-columns: 1fr; }
  .middle-controls { flex-direction: row; flex-wrap: wrap; justify-content: center; padding-top: 0; }
  .ctrl-btn { width: 145px; }
  .brand-name, .brand-sub { display: none; }
}
@media (max-width: 700px) {
  .topbar-row { flex-wrap: wrap; }
  .topbar-row-spacer { display: none; }
  .date-group { width: 100%; flex-wrap: wrap; }
  .page-wrapper { padding: 14px 12px 40px; }
  .topbar { padding: 0 12px; }
}

/* ── PRINT ──────────────────────────────────── */
@media print {
  .topbar, .topbar-row, .middle-controls, .add-item-btn,
  .remove-btn, .ellipsis-btn, .qty-btn, #copy-notice,
  body::before, .obs-options { display: none !important; }

  body { background: white; font-family: var(--print-font); color: #000; }
  @page { size: A4 portrait; margin: 10mm; }

  .page-wrapper { padding: 0 !important; max-width: 100% !important; }

  .content-grid {
    display: flex !important;
    gap: 5mm !important;
    align-items: flex-start !important;
  }
  .content-grid > .middle-controls { display: none !important; }

  .col-panel {
    flex: 1 !important;
    box-shadow: none !important;
    border: var(--print-border) solid #000 !important;
    border-radius: 4px !important;
    overflow: visible !important;
  }

  .col-header {
    padding: 5px 8px !important;
    background: #f0f0f0 !important;
    border-bottom: var(--print-border) solid #000 !important;
  }
  .col-header-icon { display: none !important; }
  .col-header-title { font-size: 9px !important; font-weight: bold; font-family: var(--print-font) !important; }

  .col-body { padding: 2px 4px !important; }

  .item {
    grid-template-columns: 1fr 80px !important;
    padding: 2px 4px !important;
    border-bottom: var(--print-border) solid #ccc !important;
    border-radius: 0 !important;
    background: none !important;
    break-inside: avoid;
    page-break-inside: avoid;
  }
  .item:last-child { border-bottom: none !important; }
  .item .label { font-size: 7.5px !important; line-height: 1.2 !important; white-space: normal !important; }
  .weight-selector { display: none !important; }

  .qty-wrap {
    border: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    width: 100% !important;
  }
  input.qty-input {
    font-size: 7.5px !important;
    padding: 1px 3px !important;
    border: var(--print-border) solid #999 !important;
    border-radius: 2px !important;
    background: white !important;
    width: 100% !important;
    flex: 1 !important;
  }

  .custom-item {
    display: grid !important;
    grid-template-columns: 1fr 60px !important;
    padding: 2px 4px !important;
    border-bottom: var(--print-border) solid #ccc !important;
    border-radius: 0 !important;
    background: none !important;
  }
  .custom-item input[type="text"] {
    font-size: 7.5px !important; padding: 1px 3px !important;
    border: none !important; background: transparent !important;
  }
  .custom-item input[type="number"] {
    font-size: 7.5px !important; padding: 1px 3px !important;
    border: var(--print-border) solid #999 !important;
    border-radius: 2px !important; background: white !important;
  }

  .obs-panel {
    border: var(--print-border) solid #000 !important;
    border-radius: 4px !important;
    box-shadow: none !important;
    margin-top: 8mm !important;
  }
  .obs-header {
    padding: 5px 8px !important;
    background: #f0f0f0 !important;
    border-bottom: var(--print-border) solid #000 !important;
  }
  .obs-header-icon { display: none !important; }
  .obs-header-title { font-size: 9px !important; font-family: var(--print-font) !important; }
  .obs-body { padding: 6px 8px !important; }
  .obs-body textarea {
    font-size: 8px !important;
    font-family: var(--print-font) !important;
    border: none !important;
    background: transparent !important;
    padding: 0 !important;
    min-height: 120px !important;
    white-space: pre-wrap;
    line-height: 1.3;
  }
}
</style>
</head>
<body>

<!-- ── TOPBAR ── -->
<header class="topbar">
  <div class="topbar-left">

    <!-- Menu Hamburger -->
    <div class="menu-dropdown">
      <button class="icon-btn" id="btn-hamburger" title="Menu" onclick="toggleMenu('dropdown-menu')" aria-haspopup="true" aria-controls="dropdown-menu" aria-expanded="false">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/>
          <rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/>
        </svg>
        <span class="sr-only">Menu</span>
      </button>
      <div class="menu-dropdown-content" id="dropdown-menu" role="menu" aria-hidden="true">

        <!-- MACS -->
        <div class="dropdown-section">
          <div class="section-header" tabindex="0" onclick="toggleSubmenu(this)" onkeydown="if(event.key==='Enter')toggleSubmenu(this)">
            <span>MACS</span><small class="chev">▸</small>
          </div>
          <div class="submenu">
            <a href="mac77.html"   onclick="abrirMac(event,'MAC Bairro São Geraldo')"><span class="mac-code">77</span>MAC Bairro São Geraldo</a>
            <a href="mac78.html"   onclick="abrirMac(event,'MAC Bairro Planalto')"><span class="mac-code">78</span>MAC Bairro Planalto</a>
            <a href="mac79.html"   onclick="abrirMac(event,'MAC Romeu Duarte')"><span class="mac-code">79</span>MAC Romeu Duarte</a>
            <a href="mac80.html"   onclick="abrirMac(event,'MAC Rua São Geraldo / Centro 2')"><span class="mac-code">80</span>MAC Rua São Geraldo / Centro 2</a>
            <a href="mac277.html"  onclick="abrirMac(event,'MAC Matriz')"><span class="mac-code">277</span>MAC Matriz</a>
            <a href="mac853.html"  onclick="abrirMac(event,'MAC Concesso')"><span class="mac-code">853</span>MAC Concesso</a>
            <a href="mac1249.html" onclick="abrirMac(event,'MAC Jardim do Lago')"><span class="mac-code">1249</span>MAC Jardim do Lago</a>
            <a href="mac989.html"  onclick="abrirMac(event,'MAC Araújos')"><span class="mac-code">989</span>MAC Araújos</a>
            <a href="mac1436.html" onclick="abrirMac(event,'MAC São Gonçalo do Pará')"><span class="mac-code">1436</span>MAC São Gonçalo do Pará</a>
          </div>
        </div>

        <!-- São José -->
        <div class="dropdown-section">
          <div class="section-header" tabindex="0" onclick="toggleSubmenu(this)" onkeydown="if(event.key==='Enter')toggleSubmenu(this)">
            <span>São José</span><small class="chev">▸</small>
          </div>
          <div class="submenu">
            <a href="saojose.html"  onclick="abrirLocal(event,'Pedido São José')">Pedido São José</a>
            <a href="paototal.html" onclick="abrirLocal(event,'Pedido Pão Total')">Pedido Pão Total</a>
          </div>
        </div>

        <!-- Tabelas -->
        <div class="dropdown-section">
          <div class="section-header" tabindex="0" onclick="toggleSubmenu(this)" onkeydown="if(event.key==='Enter')toggleSubmenu(this)">
            <span>Tabelas</span><small class="chev">▸</small>
          </div>
          <div class="submenu">
            <a href="pdfs/Tabela 2025 Geral.pdf"   onclick="abrirLocal(event,'Tabela de Preços Geral')">Tabela de Preços Geral</a>
            <a href="pdfs/Tabela 2025 Empresa.pdf" onclick="abrirLocal(event,'Tabela de Preços Empresa')">Tabela de Preços Empresa</a>
            <a href="https://github.com/henriteodoro/paratestes/releases/download/v1.0/Catalogo.Sao.Jose.2025.AT03.pdf" onclick="abrirLocal(event,'Catálogo de Produtos')">Catálogo de Produtos</a>
          </div>
        </div>

        <!-- Ferramentas -->
        <div class="dropdown-section">
          <div class="section-header" tabindex="0" onclick="toggleSubmenu(this)" onkeydown="if(event.key==='Enter')toggleSubmenu(this)">
            <span>Ferramentas</span><small class="chev">▸</small>
          </div>
          <div class="submenu">
            <a href="processadordepedidos.html" onclick="abrirLocal(event,'Processador de Pedidos')">Processador de Pedidos</a>
            <a href="ods.html"                  onclick="abrirLocal(event,'Visualizar Planilhas')">Visualizar Planilhas</a>
            <a href="simularpedido.html"         onclick="abrirLocal(event,'Simulador de Pedido')">Simulador de Pedido</a>
            <a href="anotacoes/anotacoes.html"   onclick="abrirLocal(event,'Anotações')">Anotações</a>
            <a href="planilhaautocontrole.html"  onclick="abrirLocal(event,'Planilhas de Autocontrole')">Planilhas de Autocontrole</a>
          </div>
        </div>

      </div>
    </div>

    <!-- Home -->
    <button class="icon-btn" title="Menu inicial" onclick="voltarMenu()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
        <polyline points="16 17 21 12 16 7"/>
        <line x1="21" y1="12" x2="9" y2="12"/>
      </svg>
      <span class="sr-only">Início</span>
    </button>

    <!-- Fechar -->
    <button class="icon-btn" title="Fechar" onclick="fecharPagina()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="9"/>
        <line x1="15" y1="9" x2="9" y2="15"/>
        <line x1="9" y1="9" x2="15" y2="15"/>
      </svg>
      <span class="sr-only">Fechar</span>
    </button>

    <div class="topbar-divider"></div>

    <!-- Brand -->
    <div class="topbar-brand">
      <div class="brand-icon">PT</div>
      <div>
        <div class="brand-name" id="titulo-principal">Lista Pedido Pão Total</div>
        <div class="brand-sub">Organizador de pedido</div>
      </div>
    </div>

    <!-- Seta esquerda — voltar à São José -->
    <a href="saojose.html" class="nav-arrow-btn" title="Pedido São José" onclick="abrirLocal(event,'Pedido São José')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
    </a>

  </div>

  <div class="topbar-spacer"></div>

  <!-- Actions right -->
  <div class="topbar-actions">

    <!-- Salvar dropdown -->
    <div class="menu-dropdown menu-right" style="position:relative;">
      <button class="icon-btn" title="Salvar" onclick="toggleMenu('dropdown-save')" aria-haspopup="true" aria-controls="dropdown-save">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 3v13"/>
          <polyline points="7 11 12 16 17 11"/>
          <path d="M5 20h14"/>
        </svg>
        <span class="sr-only">Salvar</span>
      </button>
      <div class="save-dropdown menu-dropdown-content" id="dropdown-save">
        <a href="#" onclick="salvarTXT(event)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
          Salvar como TXT
        </a>
        <a href="#" onclick="salvarPDF(event)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
          Salvar como PDF
        </a>
        <a href="#" onclick="salvarExcel(event)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/><line x1="2" y1="20" x2="22" y2="20"/></svg>
          Salvar como Excel
        </a>
      </div>
    </div>

    <!-- Imprimir -->
    <button class="icon-btn" id="btn-print" title="Imprimir">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="6 9 6 2 18 2 18 9"/>
        <path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/>
        <rect x="6" y="14" width="12" height="8"/>
      </svg>
      <span class="sr-only">Imprimir</span>
    </button>

    <!-- Copiar -->
    <button class="icon-btn" title="Copiar lista" onclick="copiarTudo()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="18" cy="5" r="3"/>
        <circle cx="6" cy="12" r="3"/>
        <circle cx="18" cy="19" r="3"/>
        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
      </svg>
      <span class="sr-only">Copiar</span>
    </button>
  </div>
</header>

<!-- ── PAGE WRAPPER ── -->
<div class="page-wrapper">

  <div class="topbar-row">

    <div class="stat-chip">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
      Preenchidos: <span class="val" id="contador-val">0</span>
    </div>

    <div class="stat-chip">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
      Produtos: <span class="val" id="total-val">0</span>
    </div>

    <div class="topbar-row-spacer"></div>

    <div class="date-group">
      <label for="dataPedido">Data:</label>
      <input id="dataPedido" type="text" placeholder="dd/mm/aaaa" inputmode="numeric" autocomplete="off" />
      <button class="chip" id="chipHoje">Hoje</button>
      <button class="chip" id="chipAmanha">Amanhã</button>
    </div>

  </div>

  <!-- Main grid -->
  <div class="content-grid">

    <!-- Coluna Produtos -->
    <div class="col-panel" id="coluna-principal-panel">
      <div class="col-header">
        <div class="col-header-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
        </div>
        <span class="col-header-title">PRODUTOS</span>
      </div>
      <div class="col-body">
        <div id="listaPrincipal"></div>
        <button class="add-item-btn" onclick="adicionarItem('listaPrincipal')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="width:13px;height:13px"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          Adicionar Item
        </button>
      </div>
    </div>

    <!-- Middle controls -->
    <div class="middle-controls" id="middle-controls">
      <button class="ctrl-btn green" onclick="imprimirDireto()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
        Imprimir
      </button>
      <button class="ctrl-btn amber" onclick="alternarLinhas()" id="btn-linhas">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        Ocultar Vazios
      </button>
      <button class="ctrl-btn red" onclick="resetarTudo()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 100-.49"/></svg>
        Resetar Tudo
      </button>
    </div>

    <!-- Coluna Ilha -->
    <div class="col-panel" id="coluna-ilha-panel">
      <div class="col-header">
        <div class="col-header-icon" style="background:var(--success);">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>
        </div>
        <span class="col-header-title">ILHA PÃO TOTAL</span>
      </div>
      <div class="col-body">
        <div id="listaIlha"></div>
        <button class="add-item-btn" onclick="adicionarItem('listaIlha')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="width:13px;height:13px"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          Adicionar Item
        </button>
      </div>
    </div>

  </div>

  <!-- Observações -->
  <div class="obs-panel">
    <div class="obs-header">
      <div class="obs-header-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      </div>
      <span class="obs-header-title">OBSERVAÇÕES</span>
    </div>
    <div class="obs-body">
      <textarea id="observacoes" placeholder="Escreva observações que aparecerão ao copiar/salvar/imprimir..."></textarea>
      <div class="obs-options">
        <label><input type="checkbox" id="printObsTitle" checked /> Incluir o título "OBSERVAÇÕES" na impressão/PDF</label>
      </div>
    </div>
  </div>

</div>

<div id="copy-notice">Copiado!</div>

<script>
/* ============================================================
   DADOS
============================================================ */
const PRODUTOS_PRINCIPAL = [
  "Biscoitinho de doce grande 10 unidades",
  "Biscoitinho doce frito 1kg",
  "Biscoito chipa 7kg",
  "Biscoito de queijo 7kg",
  "Biscoito três queijos 7kg",
  "Bolinha de carne pequena 1kg",
  "Broinha de fubá doce 7kg",
  "Broinha de fubá doce grande 7kg",
  "Broinha de sal e queijo 7kg",
  "Broinha temperada com bacon 7kg",
  "Canudinho de queijo 7kg",
  "Canudinho Romeu e Julieta 7kg",
  "Carioca 7kg",
  "Coxinha de frango grande 10 unidades",
  "Coxinha de frango pequena 1kg",
  "Croissant de frango 7kg",
  "Croissant de presunto 7kg",
  "Empada de frango grande 10 unidades",
  "Empadão de frango com catupiry 10 unidades",
  "Empadinha de frango pequena 1kg",
  "Enroladinho de presunto e mussarela grande 10 uni",
  "Enroladinho de presunto pequeno 1kg",
  "Enroladinho de salsicha grande 10 unidades",
  "Mandi 7kg",
  "Meia lua 1kg com 10 unidades",
  "Mini carioca 7kg",
  "Mini pão francês 06hrs 7kg",
  "Palitão de provolone 1kg com 10 unidades",
  "Panhoca 06hrs 7kg",
  "Pão de queijo recheado frango grande 7kg",
  "Pão de queijo recheado frango pequeno 7kg",
  "Pão de queijo tradicional grande 7kg",
  "Pão de queijo tradicional pequeno 7kg",
  "Pão francês 04hrs 7kg",
  "Pão francês 06hrs 7kg",
  "Pão francês 12hrs 7kg",
  "Pão francês 18h 7kg",
  "Pastel assado de frango grande 10 unidades",
  "Pastel português de carne grande 10 unidades",
  "Pastelzinho catupiry pequeno 1kg",
  "Quibe com catupiry pequeno 1kg",
  "Quibe grande 1kg",
  "Rosca caseira PCT com 10 unidades",
  "Tortinha de frango, abacaxi e passas 10 unidades"
];

const PRODUTOS_ILHA = [
  "Biscoito chipa 1kg",
  "Biscoito de queijo 1kg",
  "Bolinha de carne pequena 1kg",
  "Broinha de fubá doce 1kg",
  "Broinha de fubá doce grande 7kg",
  "Broinha de sal e queijo 1kg",
  "Broinha temperada com bacon 1kg",
  "Coxinha de frango pequena 1kg",
  "Empada de frango 10 unidades",
  "Empadinha de frango pequena 1kg",
  "Enroladinho de presunto pequeno 1kg",
  "Meia lua 1kg com 10 unidades",
  "Pão de queijo recheado frango grande 1kg",
  "Pão de queijo recheado frango 1kg",
  "Pão de queijo tradicional grande 1kg",
  "Pão de queijo tradicional pequeno 1kg",
  "Pastelzinho catupiry pequeno 1kg",
  "Quibe com catupiry pequeno 1kg"
];

/* Produtos que recebem seletor de peso (apenas lista principal) */
const PRODUCTS_WITH_WEIGHT_SELECTOR = [
  "Biscoitinho doce frito 1kg",
  "Meia lua 1kg com 10 unidades"
];

/* Mapa de nomes para impressão/exportação */
const PRINT_NAME_MAP = {
  "Biscoitinho de doce grande 10 unidades": "BISCOITINHO DE DOCE GRANDE",
  "Biscoitinho doce frito 1kg": "BISCOITINHO DE DOCE 1KG",
  "Biscoitinho doce frito 7kg": "BISCOITINHO DE DOCE 7KG",
  "Biscoito chipa 7kg": "BISCOITO CHIPA",
  "Biscoito de queijo 7kg": "BISCOITO DE QUEIJO",
  "Biscoito três queijos 7kg": "BISCOITO TRÊS QUEIJOS",
  "Bolinha de carne pequena 1kg": "BOLINHA DE CARNE PEQUENA",
  "Broinha de fubá doce 7kg": "BROINHA DE FUBÁ DOCE",
  "Broinha de fubá doce grande 7kg": "BROINHA DE FUBÁ DOCE GRANDE 7KG",
  "Broinha de sal e queijo 7kg": "BROINHA DE SAL E QUEIJO",
  "Broinha temperada com bacon 7kg": "BROINHA TEMPERADA COM BACON",
  "Canudinho de queijo 7kg": "CANUDINHO DE QUEIJO",
  "Canudinho Romeu e Julieta 7kg": "CANUDINHO ROMEU E JULIETA",
  "Carioca 7kg": "CARIOCA",
  "Coxinha de frango grande 10 unidades": "COXINHA DE FRANGO GRANDE",
  "Coxinha de frango pequena 1kg": "COXINHA DE FRANGO PEQUENA",
  "Croissant de frango 7kg": "CROISSANT DE FRANGO",
  "Croissant de presunto 7kg": "CROISSANT DE PRESUNTO",
  "Empada de frango grande 10 unidades": "EMPADA DE FRANGO",
  "Empadão de frango com catupiry 10 unidades": "EMPADÃO DE FRANGO COM CATUPIRY",
  "Empadinha de frango pequena 1kg": "EMPADINHA DE FRANGO PEQUENA",
  "Enroladinho de presunto e mussarela grande 10 uni": "ENROLADINHO DE PRESUNTO E MUSSARELA GRANDE",
  "Enroladinho de presunto pequeno 1kg": "ENROLADINHO DE PRESUNTO PEQUENO",
  "Enroladinho de salsicha grande 10 unidades": "ENROLADINHO DE SALSICHA GRANDE",
  "Mandi 7kg": "MANDI",
  "Meia lua 1kg com 10 unidades": "MEIA LUA 1KG",
  "Meia lua 7kg": "MEIA LUA 7KG",
  "Mini carioca 7kg": "MINI CARIOCA",
  "Mini pão francês 06hrs 7kg": "MINI PÃO FRANCÊS 06HRS",
  "Palitão de provolone 1kg com 10 unidades": "PALITÃO DE PROVOLONE 1KG",
  "Panhoca 06hrs 7kg": "PANHOCA 06HRS",
  "Pão de queijo recheado frango grande 7kg": "PÃO DE QUEIJO RECHEADO FRANGO GRANDE 7KG",
  "Pão de queijo recheado frango pequeno 7kg": "PÃO DE QUEIJO RECHEADO FRANGO PEQUENO",
  "Pão de queijo tradicional grande 7kg": "PÃO DE QUEIJO TRADICIONAL GRANDE 7KG",
  "Pão de queijo tradicional pequeno 7kg": "PÃO DE QUEIJO TRADICIONAL PEQUENO",
  "Pão francês 04hrs 7kg": "PÃO FRANCÊS 04HRS",
  "Pão francês 06hrs 7kg": "PÃO FRANCÊS 06HRS",
  "Pão francês 12hrs 7kg": "PÃO FRANCÊS 12HRS",
  "Pão francês 18h 7kg": "PÃO FRANCÊS 18H",
  "Pastel assado de frango grande 10 unidades": "PASTEL ASSADO DE FRANGO",
  "Pastel português de carne grande 10 unidades": "PASTEL PORTUGUÊS DE CARNE",
  "Pastelzinho catupiry pequeno 1kg": "PASTELZINHO CATUPIRY PEQUENO",
  "Quibe com catupiry pequeno 1kg": "QUIBE COM CATUPIRY PEQUENO",
  "Quibe grande 1kg": "QUIBE GRANDE",
  "Rosca caseira PCT com 10 unidades": "ROSCA CASEIRA",
  "Tortinha de frango, abacaxi e passas 10 unidades": "TORTINHA DE FRANGO, ABACAXI E PASSAS",
  "Biscoito chipa 1kg": "BISCOITO CHIPA 1KG",
  "Biscoito de queijo 1kg": "BISCOITO DE QUEIJO 1KG",
  "Broinha de fubá doce 1kg": "BROINHA DE FUBÁ DOCE 1KG",
  "Broinha de sal e queijo 1kg": "BROINHA DE SAL E QUEIJO 1KG",
  "Broinha temperada com bacon 1kg": "BROINHA TEMPERADA COM BACON 1KG",
  "Empada de frango 10 unidades": "EMPADA DE FRANGO 10 UNIDADES",
  "Pão de queijo recheado frango grande 1kg": "PÃO DE QUEIJO RECHEADO FRANGO GRANDE 1KG",
  "Pão de queijo recheado frango 1kg": "PÃO DE QUEIJO RECHEADO FRANGO 1KG",
  "Pão de queijo tradicional grande 1kg": "PÃO DE QUEIJO TRADICIONAL GRANDE 1KG",
  "Pão de queijo tradicional pequeno 1kg": "PÃO DE QUEIJO TRADICIONAL PEQUENO 1KG"
};

function getPrintName(prod) {
  return PRINT_NAME_MAP[prod] || prod.toUpperCase();
}

/* ============================================================
   TOAST
============================================================ */
function showBottomNotice(message = 'Copiado!', duration = 2000) {
  const el = document.getElementById('copy-notice');
  if (!el) return;
  if (el._hideTimeout) { clearTimeout(el._hideTimeout); el._hideTimeout = null; }
  el.textContent = message;
  el.style.display = 'block';
  el._hideTimeout = setTimeout(() => { el.style.display = 'none'; el._hideTimeout = null; }, duration);
}

/* ============================================================
   MONTA LISTAS
============================================================ */
function makeItem(nome, listaId) {
  const hasWeightSelector = listaId === 'listaPrincipal' && PRODUCTS_WITH_WEIGHT_SELECTOR.includes(nome);
  const wrap = document.createElement('div');
  wrap.className = 'item';

  /* ── Label ── */
  const labelWrap = document.createElement('div');
  labelWrap.className = 'label-wrap';

  const label = document.createElement('span');
  label.className = 'label';

  if (hasWeightSelector) {
    if (nome === "Biscoitinho doce frito 1kg") {
      label.textContent = "Biscoitinho doce frito";
    } else if (nome === "Meia lua 1kg com 10 unidades") {
      label.textContent = "Meia lua";
    }
  } else {
    label.textContent = nome;
  }

  labelWrap.appendChild(label);

  /* ── Seletor de peso (se houver) ── */
  if (hasWeightSelector) {
    const selector = document.createElement('select');
    selector.className = 'weight-selector';
    if (nome === "Biscoitinho doce frito 1kg") {
      selector.innerHTML = `<option value="1kg">1kg</option><option value="7kg">7kg</option>`;
    } else if (nome === "Meia lua 1kg com 10 unidades") {
      selector.innerHTML = `<option value="1kg com 10 unidades">1kg</option><option value="7kg">7kg</option>`;
    }
    labelWrap.appendChild(selector);
  }

  /* ── Botão de ellipsis ── */
  const ell = document.createElement('button');
  ell.type = 'button';
  ell.className = 'ellipsis-btn';
  ell.textContent = '...';
  ell.title = 'Mostrar texto completo';
  ell.style.display = 'none';
  ell.addEventListener('click', (ev) => {
    ev.preventDefault();
    const expanded = label.classList.toggle('expanded');
    ell.textContent = expanded ? '▴' : '...';
    ell.title = expanded ? 'Fechar' : 'Mostrar texto completo';
  });
  labelWrap.appendChild(ell);

  /* ── Qty wrap com botões +/- ── */
  const qtyWrap = document.createElement('div');
  qtyWrap.className = 'qty-wrap';

  const btnMinus = document.createElement('button');
  btnMinus.type = 'button';
  btnMinus.className = 'qty-btn';
  btnMinus.setAttribute('aria-label', 'Diminuir');
  btnMinus.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/></svg>`;

  const input = document.createElement('input');
  input.type = 'number';
  input.className = 'qty-input';
  input.min = '0';
  input.step = '1';
  input.placeholder = '';
  input.setAttribute('aria-label', `Quantidade de ${nome}`);

  const btnPlus = document.createElement('button');
  btnPlus.type = 'button';
  btnPlus.className = 'qty-btn';
  btnPlus.setAttribute('aria-label', 'Aumentar');
  btnPlus.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>`;

  btnMinus.addEventListener('click', () => {
    input.value = Math.max(0, (parseInt(input.value) || 0) - 1);
    if (ocultando) applyHideState();
    atualizarContagem();
  });
  btnPlus.addEventListener('click', () => {
    input.value = (parseInt(input.value) || 0) + 1;
    if (ocultando) applyHideState();
    atualizarContagem();
  });
  input.addEventListener('input', () => { if (ocultando) applyHideState(); atualizarContagem(); });
  input.addEventListener('focus', () => input.select());
  input.addEventListener('keydown', (ev) => {
    if (ev.key === 'Enter') { ev.preventDefault(); focusNextInput(ev.target); }
  });

  qtyWrap.appendChild(btnMinus);
  qtyWrap.appendChild(input);
  qtyWrap.appendChild(btnPlus);

  wrap.appendChild(labelWrap);
  wrap.appendChild(qtyWrap);
  return wrap;
}

function montarListas() {
  const p = document.getElementById('listaPrincipal');
  const i = document.getElementById('listaIlha');
  p.innerHTML = ''; i.innerHTML = '';
  PRODUTOS_PRINCIPAL.forEach(n => p.appendChild(makeItem(n, 'listaPrincipal')));
  PRODUTOS_ILHA.forEach(n => i.appendChild(makeItem(n, 'listaIlha')));
  setTimeout(checkTruncations, 30);
  atualizarContagem();
}

function checkTruncations() {
  document.querySelectorAll('#listaPrincipal .item, #listaIlha .item').forEach(item => {
    const label = item.querySelector('.label');
    const btn = item.querySelector('.ellipsis-btn');
    if (!label || !btn) return;
    const isTruncated = label.scrollWidth > label.clientWidth + 2;
    btn.style.display = isTruncated ? 'inline-block' : 'none';
    if (!isTruncated) { label.classList.remove('expanded'); btn.textContent = '...'; }
  });
}
window.addEventListener('resize', () => { setTimeout(checkTruncations, 100); });

/* ============================================================
   DATA
============================================================ */
function pad2(n) { return String(n).padStart(2, '0'); }
function formatDDMMYYYY(date) { return `${pad2(date.getDate())}/${pad2(date.getMonth() + 1)}/${date.getFullYear()}`; }
function formatDDMM(date) { return `${pad2(date.getDate())}/${pad2(date.getMonth() + 1)}`; }
function parseDateInput(v) {
  if (!v || v.trim() === '') return null;
  v = v.replace(/\s+/g, '');
  if (/^\d{4}-\d{2}-\d{2}$/.test(v)) { const d = new Date(v); if (!isNaN(d)) return d; }
  const m = v.match(/^(\d{2})\/(\d{2})(?:\/(\d{4}))?$/);
  if (m) { const d = parseInt(m[1], 10), mo = parseInt(m[2], 10) - 1, y = m[3] ? parseInt(m[3], 10) : (new Date()).getFullYear(); const date = new Date(y, mo, d); if (!isNaN(date)) return date; }
  return null;
}
function setDateTo(date) { if (!date) return; document.getElementById('dataPedido').value = formatDDMMYYYY(date); }
function getDisplayDateFull() {
  const v = document.getElementById('dataPedido').value.trim();
  if (v === '') return '';
  const dt = parseDateInput(v); return dt ? formatDDMMYYYY(dt) : '';
}
function getDisplayDateForPrint() {
  const v = document.getElementById('dataPedido').value.trim();
  if (v === '') return formatDDMMYYYY(new Date());
  const dt = parseDateInput(v); return dt ? formatDDMMYYYY(dt) : formatDDMMYYYY(new Date());
}
function sanitizeDateForFile(s) { return s ? s.replace(/\//g, '-') : ''; }

/* ============================================================
   COLETA
============================================================ */
function coletarSeção(rootSel) {
  return Array.from(document.querySelectorAll(rootSel + ' .item')).reduce((acc, r) => {
    let nome = '';
    const label = r.querySelector('.label');
    const selector = r.querySelector('.weight-selector');
    if (selector) {
      nome = label.textContent.trim() + ' ' + selector.value;
    } else {
      nome = label.textContent.trim();
    }
    const val = r.querySelector('input.qty-input').value.trim();
    if (val !== '' && Number(val) > 0) acc.push({ prod: nome, qtd: Number(val) });
    return acc;
  }, []);
}

function coletarCustomItems() {
  const out = [];
  document.querySelectorAll('.custom-item').forEach(item => {
    const nomeInput = item.querySelector('input[type="text"]');
    const qtdInput  = item.querySelector('input[type="number"]');
    const nome = nomeInput.value.trim();
    const qtd  = qtdInput.value.trim();
    const lista = nomeInput.dataset.lista;
    if (nome !== '' && qtd !== '' && Number(qtd) > 0) out.push({ prod: nome, qtd: Number(qtd), lista });
  });
  return out;
}

/* ============================================================
   ENTER NAVIGATION
============================================================ */
function focusNextInput(current) {
  const inputs = Array.from(document.querySelectorAll('#listaPrincipal input.qty-input, #listaIlha input.qty-input'));
  const idx = inputs.indexOf(current);
  if (idx === -1) return;
  for (let i = idx + 1; i < inputs.length; i++) {
    if (inputs[i]) { inputs[i].focus(); inputs[i].select(); return; }
  }
}

/* ============================================================
   CONTAGEM
============================================================ */
function atualizarContagem() {
  const p = coletarSeção('#listaPrincipal');
  const i = coletarSeção('#listaIlha');
  const custom = coletarCustomItems();
  const totalItens = PRODUTOS_PRINCIPAL.length + PRODUTOS_ILHA.length + document.querySelectorAll('.custom-item').length;
  document.getElementById('contador-val').textContent = p.length + i.length + custom.length;
  document.getElementById('total-val').textContent = totalItens;
}

/* ============================================================
   TOGGLE LINHAS VAZIAS
============================================================ */
let ocultando = false;
function applyHideState() {
  const rows = Array.from(document.querySelectorAll('#listaPrincipal .item, #listaIlha .item'));
  if (!ocultando) { rows.forEach(r => r.classList.remove('hidden-empty')); return; }
  rows.forEach(r => {
    const v = r.querySelector('input.qty-input').value.trim();
    if (v === '' || Number(v) <= 0) r.classList.add('hidden-empty');
    else r.classList.remove('hidden-empty');
  });
}
function alternarLinhas() {
  ocultando = !ocultando;
  applyHideState();
  const b = document.getElementById('btn-linhas');
  if (ocultando) {
    b.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>Mostrar Todos`;
  } else {
    b.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>Ocultar Vazios`;
  }
}

/* ============================================================
   RESET
============================================================ */
function resetarTudo() {
  document.querySelectorAll('#listaPrincipal input.qty-input, #listaIlha input.qty-input').forEach(i => i.value = '');
  document.querySelectorAll('.custom-item').forEach(item => item.remove());
  ocultando = false;
  applyHideState();
  document.getElementById('btn-linhas').innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>Ocultar Vazios`;
  document.getElementById('dataPedido').value = '';
  document.getElementById('observacoes').value = '';
  document.querySelectorAll('.weight-selector').forEach(s => s.selectedIndex = 0);
  atualizarContagem();
  showBottomNotice('Tudo limpo!');
}

/* ============================================================
   ADICIONAR ITEM CUSTOMIZADO
============================================================ */
function adicionarItem(listaId) {
  const lista = document.getElementById(listaId);
  const novoItem = document.createElement('div');
  novoItem.className = 'custom-item';

  const nomeInput = document.createElement('input');
  nomeInput.type = 'text';
  nomeInput.placeholder = 'Nome do produto';
  nomeInput.dataset.lista = listaId;

  const qtdInput = document.createElement('input');
  qtdInput.type = 'number';
  qtdInput.min = '0';
  qtdInput.step = '1';
  qtdInput.placeholder = '';
  qtdInput.addEventListener('input', atualizarContagem);

  const removeBtn = document.createElement('button');
  removeBtn.type = 'button';
  removeBtn.className = 'remove-btn';
  removeBtn.textContent = '✕';
  removeBtn.title = 'Remover item';
  removeBtn.addEventListener('click', () => { novoItem.remove(); atualizarContagem(); });

  novoItem.appendChild(nomeInput);
  novoItem.appendChild(qtdInput);
  novoItem.appendChild(removeBtn);

  const addBtn = lista.nextElementSibling;
  lista.parentNode.insertBefore(novoItem, addBtn);
  atualizarContagem();
  setTimeout(() => nomeInput.focus(), 10);
}

/* ============================================================
   COPIAR
============================================================ */
function copiarTudo() {
  const p = coletarSeção('#listaPrincipal');
  const i = coletarSeção('#listaIlha');
  const customItems = coletarCustomItems();
  const obs = (document.getElementById('observacoes') && document.getElementById('observacoes').value.trim()) || '';
  if (p.length === 0 && i.length === 0 && customItems.length === 0 && !obs) { showBottomNotice('Nada para copiar'); return; }
  const ddmm = getDisplayDateFull();
  let txt = ddmm ? `PEDIDO PÃO TOTAL ${ddmm}\n` : `PEDIDO PÃO TOTAL\n`;
  txt += 'PRODUTOS\n';
  p.forEach(({ prod, qtd }) => txt += `${getPrintName(prod)} * ${qtd}\n`);
  customItems.filter(x => x.lista === 'listaPrincipal').forEach(({ prod, qtd }) => txt += `${prod.toUpperCase()} * ${qtd}\n`);
  if (i.length > 0 || customItems.some(x => x.lista === 'listaIlha')) {
    txt += '\nILHA PÃO TOTAL\n';
    i.forEach(({ prod, qtd }) => txt += `${getPrintName(prod)} * ${qtd}\n`);
    customItems.filter(x => x.lista === 'listaIlha').forEach(({ prod, qtd }) => txt += `${prod.toUpperCase()} * ${qtd}\n`);
  }
  if (obs) txt += `\nOBSERVAÇÕES:\n${obs}\n`;
  navigator.clipboard.writeText(txt).then(() => showBottomNotice('Copiado!')).catch(() => showBottomNotice('Falha ao copiar'));
}

/* ============================================================
   TXT
============================================================ */
function salvarTXT(e) {
  if (e) e.preventDefault();
  const p = coletarSeção('#listaPrincipal');
  const i = coletarSeção('#listaIlha');
  const customItems = coletarCustomItems();
  const obs = (document.getElementById('observacoes') && document.getElementById('observacoes').value.trim()) || '';
  if (p.length === 0 && i.length === 0 && customItems.length === 0 && !obs) { showBottomNotice('Nada para salvar'); return; }
  const ddmm = getDisplayDateFull();
  let txt = ddmm ? `PEDIDO PÃO TOTAL ${ddmm}\n` : `PEDIDO PÃO TOTAL\n`;
  txt += `PRODUTOS;QUANTIDADE (PCT)\n`;
  p.forEach(({ prod, qtd }) => txt += `${getPrintName(prod)};${qtd}\n`);
  customItems.filter(x => x.lista === 'listaPrincipal').forEach(({ prod, qtd }) => txt += `${prod.toUpperCase()};${qtd}\n`);
  if (i.length > 0 || customItems.some(x => x.lista === 'listaIlha')) {
    txt += `\nILHA PÃO TOTAL;QUANTIDADE (PCT)\n`;
    i.forEach(({ prod, qtd }) => txt += `${getPrintName(prod)};${qtd}\n`);
    customItems.filter(x => x.lista === 'listaIlha').forEach(({ prod, qtd }) => txt += `${prod.toUpperCase()};${qtd}\n`);
  }
  if (obs) txt += `\nOBSERVAÇÕES:\n${obs}\n`;
  const blob = new Blob([txt], { type: 'text/plain;charset=utf-8' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  const fileDate = ddmm ? sanitizeDateForFile(ddmm) : 'sem-data';
  a.download = `PEDIDO_PAO_TOTAL_${fileDate}.txt`;
  document.body.appendChild(a); a.click(); a.remove();
  setTimeout(() => URL.revokeObjectURL(a.href), 1000);
  showBottomNotice('TXT gerado!');
}

/* ============================================================
   PDF — duas tabelas separadas (PRODUTOS + ILHA)
============================================================ */
function gerarPDF({ abrirEmNovaAba = false, baixarNome } = {}) {
  const p = coletarSeção('#listaPrincipal');
  const i = coletarSeção('#listaIlha');
  const customItems = coletarCustomItems();
  const obs = (document.getElementById('observacoes') && document.getElementById('observacoes').value.trim()) || '';
  const includeTitle = document.getElementById('printObsTitle') ? document.getElementById('printObsTitle').checked : true;

  if (p.length === 0 && i.length === 0 && customItems.length === 0 && !obs) { showBottomNotice('Nada para imprimir'); return; }

  const ddmm = getDisplayDateForPrint();
  const titulo = `PEDIDO PÃO TOTAL ${ddmm}`;

  const bodyP = p.map(({ prod, qtd }) => [getPrintName(prod), String(qtd)]);
  customItems.filter(x => x.lista === 'listaPrincipal').forEach(({ prod, qtd }) => bodyP.push([prod.toUpperCase(), String(qtd)]));

  const bodyI = i.map(({ prod, qtd }) => [getPrintName(prod), String(qtd)]);
  customItems.filter(x => x.lista === 'listaIlha').forEach(({ prod, qtd }) => bodyI.push([prod.toUpperCase(), String(qtd)]));

  let fontSize = 10, margin = 36, fits = false;
  const pageW = 595;
  const numericColWidth = 130;
  const productColWidth = (pageW - margin * 2) - numericColWidth;
  let doc;

  while (!fits && fontSize >= 6) {
    const { jsPDF } = window.jspdf;
    doc = new jsPDF({ unit: 'pt', format: 'a4' });
    const pageH = doc.internal.pageSize.getHeight();

    doc.setFont('helvetica', 'bold');
    doc.setFontSize(14);
    doc.text(titulo, margin, 36);

    let startY = 60;

    if (bodyP.length > 0) {
      doc.autoTable({
        startY,
        head: [["PRODUTOS", "QUANTIDADE (PCT)"]],
        body: bodyP,
        theme: 'grid',
        margin: { left: margin, right: margin },
        tableWidth: pageW - margin * 2,
        styles: { font: 'helvetica', fontSize, cellPadding: 3, lineColor: [0, 0, 0], lineWidth: 1.2, textColor: [0, 0, 0], overflow: 'linebreak', minCellHeight: 12, fillColor: [255, 255, 255] },
        headStyles: { fillColor: [255, 255, 255], textColor: [0, 0, 0], fontStyle: 'bold' },
        columnStyles: { 0: { cellWidth: productColWidth }, 1: { cellWidth: numericColWidth } }
      });
      startY = doc.lastAutoTable.finalY + 20;
    }

    if (bodyI.length > 0) {
      doc.autoTable({
        startY,
        head: [["ILHA PÃO TOTAL", "QUANTIDADE (PCT)"]],
        body: bodyI,
        theme: 'grid',
        margin: { left: margin, right: margin },
        tableWidth: pageW - margin * 2,
        styles: { font: 'helvetica', fontSize, cellPadding: 3, lineColor: [0, 0, 0], lineWidth: 1.2, textColor: [0, 0, 0], overflow: 'linebreak', minCellHeight: 12, fillColor: [255, 255, 255] },
        headStyles: { fillColor: [255, 255, 255], textColor: [0, 0, 0], fontStyle: 'bold' },
        columnStyles: { 0: { cellWidth: productColWidth }, 1: { cellWidth: numericColWidth } }
      });
      startY = doc.lastAutoTable.finalY + 20;
    }

    if (obs) {
      const finalY = doc.lastAutoTable ? doc.lastAutoTable.finalY : startY;
      const obsStartY = finalY + 20;
      doc.setFont('helvetica', 'bold');
      doc.setFontSize(fontSize);
      if (includeTitle) { doc.text('OBSERVAÇÕES:', margin, obsStartY); }
      doc.setFont('helvetica', 'normal');
      doc.setFontSize(fontSize);
      const splitObs = doc.splitTextToSize(obs, pageW - margin * 2);
      doc.text(splitObs, margin, obsStartY + (includeTitle ? fontSize + 4 : 0));
    }

    const pages = doc.internal.getNumberOfPages();
    const finalY = doc.lastAutoTable ? doc.lastAutoTable.finalY : 0;
    if (pages === 1 && finalY <= (pageH - 24)) { fits = true; break; }
    fontSize -= 1;
    if (margin > 24) margin -= 2;
  }

  const arquivo = baixarNome || `PEDIDO_PAO_TOTAL_${sanitizeDateForFile(ddmm) || 'sem-data'}.pdf`;
  if (abrirEmNovaAba) {
    const blob = doc.output('blob');
    const url = URL.createObjectURL(blob);
    const win = window.open('', '_blank');
    if (!win) { doc.save(arquivo); showBottomNotice('PDF baixado'); return; }
    try { win.location.href = url; }
    catch (e) {
      try {
        win.document.open();
        win.document.write(`<!doctype html><html><head><title>PDF</title></head><body style="margin:0"><embed src="${url}" type="application/pdf" width="100%" height="100%"/></body></html>`);
        win.document.close();
      } catch (err) { doc.save(arquivo); }
    }
    setTimeout(() => URL.revokeObjectURL(url), 60000);
  } else { doc.save(arquivo); }
}

function salvarPDF(e) {
  if (e) e.preventDefault();
  const p = coletarSeção('#listaPrincipal');
  const i = coletarSeção('#listaIlha');
  const customItems = coletarCustomItems();
  const obs = (document.getElementById('observacoes') && document.getElementById('observacoes').value.trim()) || '';
  if (p.length === 0 && i.length === 0 && customItems.length === 0 && !obs) { showBottomNotice('Nada para salvar'); return; }
  gerarPDF({ abrirEmNovaAba: false });
  showBottomNotice('PDF gerado!');
}

function imprimirDireto() {
  const p = coletarSeção('#listaPrincipal');
  const i = coletarSeção('#listaIlha');
  const customItems = coletarCustomItems();
  const obs = (document.getElementById('observacoes') && document.getElementById('observacoes').value.trim()) || '';
  if (p.length === 0 && i.length === 0 && customItems.length === 0 && !obs) { showBottomNotice('Nada para imprimir'); return; }
  gerarPDF({ abrirEmNovaAba: true });
}

/* ============================================================
   EXCEL
============================================================ */
function salvarExcel(e) {
  if (e) e.preventDefault();
  const p = coletarSeção('#listaPrincipal');
  const i = coletarSeção('#listaIlha');
  const customItems = coletarCustomItems();
  const obs = (document.getElementById('observacoes') && document.getElementById('observacoes').value.trim()) || '';
  if (p.length === 0 && i.length === 0 && customItems.length === 0 && !obs) { showBottomNotice('Nada para salvar'); return; }
  const ddmm = getDisplayDateFull();
  const linhas = [];
  linhas.push([ddmm ? `PEDIDO PÃO TOTAL ${ddmm}` : `PEDIDO PÃO TOTAL`, "", ""]);
  linhas.push(["PRODUTOS", "QUANTIDADE (PCT)", ""]);
  p.forEach(({ prod, qtd }) => linhas.push([getPrintName(prod), String(qtd), ""]));
  customItems.filter(x => x.lista === 'listaPrincipal').forEach(({ prod, qtd }) => linhas.push([prod.toUpperCase(), String(qtd), ""]));
  if (i.length > 0 || customItems.some(x => x.lista === 'listaIlha')) {
    linhas.push(["", "", ""]);
    linhas.push(["ILHA PÃO TOTAL", "QUANTIDADE (PCT)", ""]);
    i.forEach(({ prod, qtd }) => linhas.push([getPrintName(prod), String(qtd), ""]));
    customItems.filter(x => x.lista === 'listaIlha').forEach(({ prod, qtd }) => linhas.push([prod.toUpperCase(), String(qtd), ""]));
  }
  if (obs) {
    linhas.push(["", "", ""]);
    linhas.push(["OBSERVAÇÕES", "", ""]);
    obs.split(/\r?\n/).forEach(l => linhas.push([l, "", ""]));
  }
  const ws = XLSX.utils.aoa_to_sheet(linhas);
  if (!ws['!merges']) ws['!merges'] = [];
  ws['!merges'].push({ s: { r: 0, c: 0 }, e: { r: 0, c: 2 } });
  ws['!cols'] = [{ wch: 50 }, { wch: 15 }, { wch: 5 }];
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'PEDIDO');
  const fileDate = ddmm ? sanitizeDateForFile(ddmm) : 'sem-data';
  XLSX.writeFile(wb, `PEDIDO_PAO_TOTAL_${fileDate}.xlsx`);
  showBottomNotice('Excel gerado!');
}

/* ============================================================
   MENUS
============================================================ */
function toggleMenu(id) {
  document.querySelectorAll('.menu-dropdown-content').forEach(el => {
    if (el.id !== id) { el.style.display = 'none'; el.setAttribute('aria-hidden', 'true'); }
  });
  const el = document.getElementById(id);
  if (!el) return;
  const open = el.style.display === 'block';
  if (open) { el.style.display = 'none'; el.setAttribute('aria-hidden', 'true'); closeAllSubmenus(); }
  else { closeAllSubmenus(); el.style.display = 'block'; el.setAttribute('aria-hidden', 'false'); }
}

function toggleSubmenu(headerEl) {
  const sub = headerEl.nextElementSibling;
  if (!sub) return;
  const chev = headerEl.querySelector('.chev');
  const isOpen = sub.style.display === 'block';
  sub.style.display = isOpen ? 'none' : 'block';
  if (chev) chev.textContent = isOpen ? '▸' : '▾';
}

function closeAllSubmenus() {
  document.querySelectorAll('.submenu').forEach(s => s.style.display = 'none');
  document.querySelectorAll('.chev').forEach(c => c.textContent = '▸');
}

document.addEventListener('click', (ev) => {
  if (!ev.target.closest('.menu-dropdown')) {
    document.querySelectorAll('.menu-dropdown-content').forEach(el => { el.style.display = 'none'; el.setAttribute('aria-hidden', 'true'); });
    closeAllSubmenus();
  }
});

document.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    document.querySelectorAll('.menu-dropdown-content').forEach(el => { el.style.display = 'none'; el.setAttribute('aria-hidden', 'true'); });
    closeAllSubmenus();
  }
});

function fecharPagina() { try { window.close(); } catch (e) {} }
function voltarMenu() {}

function abrirMac(e, nome) {
  try {
    if (e && e.currentTarget) {
      const href = e.currentTarget.getAttribute('href');
      if (href && href !== '#') {
        closeAllSubmenus();
        document.querySelectorAll('.menu-dropdown-content').forEach(el => el.style.display = 'none');
        window.location.href = href;
        return;
      }
    }
  } catch (err) {}
  if (e) e.preventDefault();
  document.getElementById('titulo-principal').textContent = nome;
  toggleMenu('dropdown-menu');
}

function abrirLocal(e, nome) {
  try {
    if (e && e.currentTarget) {
      const href = e.currentTarget.getAttribute('href');
      if (href && href !== '#') {
        closeAllSubmenus();
        document.querySelectorAll('.menu-dropdown-content').forEach(el => el.style.display = 'none');
        window.location.href = href;
        return;
      }
    }
  } catch (err) {}
  if (e) e.preventDefault();
  toggleMenu('dropdown-menu');
}

/* ============================================================
   INICIALIZAÇÃO
============================================================ */
function setChipLabels() {
  const hoje = new Date(); const amanha = new Date(); amanha.setDate(hoje.getDate() + 1);
  const chHoje = document.getElementById('chipHoje'); const chAmanha = document.getElementById('chipAmanha');
  if (chHoje) chHoje.textContent = `Hoje (${formatDDMM(hoje)})`;
  if (chAmanha) chAmanha.textContent = `Amanhã (${formatDDMM(amanha)})`;
}

function init() {
  montarListas();
  document.getElementById('dataPedido').value = '';
  setChipLabels();

  const $data = document.getElementById('dataPedido');
  $data.addEventListener('blur', () => {
    const d = parseDateInput($data.value.trim());
    $data.value = d ? formatDDMMYYYY(d) : '';
  });

  document.getElementById('chipHoje').addEventListener('click', () => setDateTo(new Date()));
  document.getElementById('chipAmanha').addEventListener('click', () => { const d = new Date(); d.setDate(d.getDate() + 1); setDateTo(d); });

  const printBtn = document.getElementById('btn-print');
  if (printBtn) printBtn.addEventListener('click', (ev) => { ev.preventDefault(); imprimirDireto(); });
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
