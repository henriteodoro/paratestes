<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Anotações — MACs & Guias</title>
<meta name="description" content="Sistema organizado de anotações por tópicos e subtópicos" />
<style>
  :root{
    --azul:#007BFF;
    --accent:#0b5ed7;
    --fundo:#f7fbff;
    --card:#ffffff;
    --muted:#6b7280;
    --borda:#e6eefc;
    --borda-ativa:#cfe0ff;
    --ink:#0b3b6b;
    --ink-strong:#0b4fa0;
    --warn:#f59e0b;
    --success:#10b981;
    --danger:#ef4444;
    --verde-suave:#f0fff4;
    --verde-borda:#38a169;
    --verde-escuro:#059669;
    --verde-claro:#d1fae5;
  }
  body{
    font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    background:linear-gradient(180deg,var(--fundo),#f3f7ff);
    min-height:100vh;margin:0;padding:18px;color:#111;
  }
  .wrap{max-width:1120px;margin:0 auto}
  h1{margin:0 0 8px 0;font-size:22px;color:var(--accent)}
  p.lead{margin:4px 0 16px 0;color:var(--muted);font-size:13px}

  /* LAYOUT */
  .anotacoes-container{display:grid;grid-template-columns:280px 1fr;gap:20px;margin-top:20px}

  /* SIDEBAR */
  .topicos-sidebar{background:var(--card);border:1px solid var(--borda);border-radius:14px;padding:16px;box-shadow:0 10px 30px rgba(11,78,167,.06);height:fit-content;position:sticky;top:20px}
  .sidebar-label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;padding:0 4px 8px;margin-bottom:4px;border-bottom:1px solid var(--borda);display:flex;align-items:center;gap:4px}
  .sidebar-label svg{width:12px;height:12px}
  .topico-item{padding:12px 14px;border-radius:10px;cursor:pointer;margin-bottom:8px;transition:all .2s;font-weight:600;font-size:14px;color:var(--ink);display:flex;align-items:center;gap:10px;border:1px solid transparent}
  .topico-item:hover{background:#f3f8ff;border-color:var(--borda-ativa)}
  .topico-item.ativo{background:var(--azul);color:white}
  .topico-item svg{width:18px;height:18px;flex-shrink:0}

  /* CONTEÚDO */
  .conteudo-area{background:var(--card);border:1px solid var(--borda);border-radius:14px;padding:20px;box-shadow:0 10px 30px rgba(11,78,167,.06);min-height:400px;position:relative}
  .conteudo-header{border-bottom:1px solid var(--borda);padding-bottom:16px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center}
  .conteudo-header h2{margin:0;font-size:18px;color:var(--ink-strong);display:flex;align-items:center;gap:10px}
  .conteudo-header h2 svg{width:20px;height:20px}
  .conteudo-header-acoes{display:flex;gap:8px}

  /* BOTÕES */
  .btn-acao{display:flex;align-items:center;gap:6px;padding:8px 12px;border-radius:6px;border:1px solid var(--borda);background:var(--card);color:var(--ink);cursor:pointer;transition:all .2s;font-size:12px;font-weight:500}
  .btn-acao:hover{background:#f3f8ff;border-color:var(--borda-ativa)}
  .btn-pdf{background:#fff7f0!important;border-color:#fed7aa!important;color:var(--warn)!important}
  .btn-pdf:hover{background:#ffedd5!important}
  .btn-imprimir{background:#f0f9ff!important;border-color:#bae6fd!important;color:var(--azul)!important}
  .btn-imprimir:hover{background:#e0f2fe!important}
  .btn-fechar{background:#fef2f2!important;border-color:#fecaca!important;color:var(--danger)!important}
  .btn-fechar:hover{background:#fee2e2!important}

  /* SUBTÓPICOS */
  .conteudo-com-subtopicos{display:grid;grid-template-columns:250px 1fr;gap:20px}
  .lista-subtopicos{background:var(--fundo);border:1px solid var(--borda);border-radius:12px;padding:16px;height:fit-content;position:sticky;top:20px;max-height:500px;overflow-y:auto}
  .lista-subtopicos-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .lista-subtopicos-header h3{margin:0;font-size:14px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px}
  .btn-icone-editar{background:none;border:none;cursor:pointer;color:var(--muted);padding:6px;border-radius:6px;display:flex;align-items:center;justify-content:center;transition:all .2s}
  .btn-icone-editar:hover{background:#f3f8ff;color:var(--azul)}
  .btn-icone-editar svg{width:16px;height:16px}
  .subtopico-item{padding:12px 14px;border-radius:8px;cursor:pointer;margin-bottom:6px;transition:all .2s;font-size:14px;color:var(--ink);display:flex;align-items:center;justify-content:space-between;border:1px solid transparent;border-bottom:1px solid var(--borda);word-break:break-word}
  .subtopico-item:last-child{border-bottom:none}
  .subtopico-item:hover{background:#fff;border-color:var(--borda-ativa)}
  .subtopico-item.ativo{background:var(--azul);color:white;border-color:var(--azul)}
  .subtopico-checkbox{margin-right:8px;width:16px;height:16px;cursor:pointer}
  .conteudo-subtopico{animation:fadeIn .3s ease}
  .conteudo-carregado{animation:fadeIn .3s ease;max-width:100%;overflow-x:hidden}

  /* CONTEÚDO CARREGADO */
  .conteudo-carregado .container{max-width:100%!important;margin:0!important;padding:0!important;background:transparent!important;border-radius:0!important;box-shadow:none!important;border:none!important}
  .conteudo-carregado h1{color:var(--accent);margin-bottom:8px;font-size:22px;border-bottom:2px solid var(--borda);padding-bottom:12px}
  .conteudo-carregado h2{color:var(--ink-strong);margin:24px 0 12px;font-size:18px;display:flex;align-items:center;gap:8px}
  .conteudo-carregado h2::before{content:"•";color:var(--azul);font-size:24px}
  .conteudo-carregado h3{color:var(--ink-strong);margin:20px 0 8px;font-size:16px;padding-left:16px}
  .conteudo-carregado p{margin:8px 0;padding-left:16px;line-height:1.5}
  .conteudo-carregado ul{margin:8px 0;padding-left:32px}
  .conteudo-carregado li{margin:6px 0}
  .destaque{background:#f0f7ff;padding:12px 16px;border-radius:8px;border-left:4px solid var(--azul);margin:12px 0}
  .info-box{background:#fff7f0;padding:12px 16px;border-radius:8px;border-left:4px solid var(--warn);margin:12px 0;font-size:14px}
  .ferias-box{background:var(--verde-suave);padding:12px 16px;border-radius:8px;border-left:4px solid var(--verde-borda);margin:12px 0;font-size:14px}
  .passo-a-passo{background:#f7fff0;padding:16px;border-radius:8px;border:1px solid var(--borda);margin:16px 0}
  .passo{display:flex;align-items:flex-start;gap:12px;margin:8px 0}
  .passo-num{background:var(--azul);color:white;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:bold;flex-shrink:0}
  .pix-info{background:#f8f0ff;padding:12px 16px;border-radius:8px;border-left:4px solid #8a2be2;margin:12px 0;font-family:monospace;font-size:14px}
  .conteudo-carregado .dados-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:12px;margin:12px 0 24px;padding-left:16px}
  .conteudo-carregado .dado-item{background:#f8f9fa;padding:12px;border-radius:8px;border-left:4px solid var(--azul)}
  .conteudo-carregado .tabela-container{overflow-x:auto;margin:16px 0;border-radius:8px;border:1px solid var(--borda);padding-left:16px}
  .conteudo-carregado .tabela-melhorada{width:100%;border-collapse:collapse;min-width:600px}
  .conteudo-carregado .tabela-melhorada thead{background:var(--azul);color:white}
  .conteudo-carregado .tabela-melhorada th{padding:12px 16px;text-align:left;font-weight:600;border-bottom:2px solid var(--accent)}
  .conteudo-carregado .tabela-melhorada tbody tr{border-bottom:1px solid var(--borda)}
  .conteudo-carregado .tabela-melhorada td{padding:12px 16px;vertical-align:top}
  .conteudo-carregado .tabela-melhorada tbody tr:nth-child(even){background:#fafcff}
  .conteudo-carregado .badge-multiplicador{display:inline-block;background:var(--azul);color:white;padding:4px 10px;border-radius:20px;font-weight:600;font-size:14px;margin-right:8px}
  .conteudo-carregado .transportadores{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:12px;margin:12px 0 24px;padding-left:16px}
  .conteudo-carregado .transportador{background:#f8f9fa;padding:12px;border-radius:8px;border-left:4px solid var(--azul)}
  .conteudo-carregado .dado-linha{display:flex;margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid var(--borda)}
  .conteudo-carregado .dado-rotulo{font-weight:600;min-width:200px;color:var(--ink-strong)}
  .conteudo-carregado .dado-valor{color:var(--ink)}
  .conteudo-carregado .cliente-item{padding:6px 0;border-bottom:1px dotted #e0e0e0;display:flex;align-items:center;justify-content:space-between}
  .conteudo-carregado .cliente-item:last-child{border-bottom:none}
  .conteudo-carregado .cliente-nome{flex-grow:1;font-size:14.5px}
  .conteudo-carregado .codigo-container{display:flex;align-items:center;gap:6px}
  .conteudo-carregado .codigo-box{background:var(--azul);color:white;padding:2px 8px;border-radius:6px;font-size:13px;font-weight:bold;min-width:40px;text-align:center;box-shadow:0 2px 4px rgba(0,123,255,.3)}
  .conteudo-carregado .total-clientes{background:#f5f5f5;padding:8px 12px;border-radius:6px;margin:16px 0;font-size:14px;color:#666;border-left:3px solid #ccc}
  .conteudo-carregado .clientes-container{background:#f8f9fa;padding:16px 20px;border-radius:10px;border-left:4px solid var(--azul);margin:12px 0 24px;box-shadow:0 4px 8px rgba(0,0,0,.05)}
  .conteudo-carregado .rota-jovi .clientes-container{border-left-color:#4CAF50}
  .conteudo-carregado .rota-salsicha .clientes-container{border-left-color:#FF9800}
  .conteudo-carregado .rota-guilherme .clientes-container{border-left-color:#2196F3}
  .conteudo-carregado .rota-nelio .clientes-container,.conteudo-carregado .rota-stenio .clientes-container{border-left-color:#9C27B0}
  .conteudo-carregado .produtos-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:12px;margin:12px 0 16px;padding-left:16px}
  .conteudo-carregado .produto-item{background:#f8f9fa;padding:12px;border-radius:8px;border-left:4px solid var(--azul)}
  .conteudo-carregado .produto-nome{font-weight:bold;color:var(--ink-strong);margin-bottom:4px}
  .conteudo-carregado .produto-detalhe{font-size:14px;color:var(--muted)}
  .conteudo-carregado .image-container{background:#f5f5f5;border:1px solid #ddd;border-radius:8px;padding:10px;text-align:center;margin:16px 0;color:var(--muted)}
  .conteudo-carregado .image-container img{max-width:100%;height:auto;display:block;margin:0 auto;border-radius:4px;max-height:400px;object-fit:contain}
  .conteudo-carregado .image-container p{margin:8px 0 0;padding:0;font-size:13px;color:var(--muted)}
  .conteudo-carregado img{max-width:100%;height:auto;border-radius:8px;margin:12px 0;cursor:pointer;transition:transform .2s}
  .conteudo-carregado img:hover{transform:scale(1.02)}
  @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
  .loading,.erro,.estado-vazio{text-align:center;padding:40px 20px;color:var(--muted)}
  .erro svg,.estado-vazio svg{width:48px;height:48px;opacity:.5;margin-bottom:16px}

  /* TOOLBAR */
  .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;background:var(--card);border:1px solid var(--borda);border-radius:12px;padding:12px;box-shadow:0 10px 30px rgba(11,78,167,.06);position:sticky;top:14px;z-index:60}
  .search{position:relative;flex:1 1 320px}
  .search input{width:100%;padding:12px 40px;border:1px solid var(--borda);border-radius:12px;background:#fbfdff;color:var(--ink);font-size:15px;box-sizing:border-box}
  .search svg{position:absolute;left:12px;top:50%;transform:translateY(-50%);width:18px;height:18px}
  .btn-toolbar{display:flex;align-items:center;gap:8px;padding:10px 14px;border:1px solid var(--borda);border-radius:8px;background:var(--card);color:var(--ink);cursor:pointer;transition:all .2s;font-size:14px;font-weight:500;position:relative}
  .btn-toolbar:hover{background:#f3f8ff;border-color:var(--borda-ativa)}
  .btn-toolbar svg{width:18px;height:18px}
  .btn-toolbar.btn-fechar{background:#fef2f2;border-color:#fecaca;color:var(--danger)}
  .btn-toolbar.btn-fechar:hover{background:#fee2e2;border-color:var(--danger)}
  .btn-menu{background:#f0f9ff;border-color:#bae6fd;color:var(--azul)}
  .btn-menu:hover{background:#e0f2fe}
  .btn-ferias{background:var(--verde-claro);border-color:var(--verde-escuro);color:var(--verde-escuro);position:relative;overflow:visible}
  .btn-ferias:hover{background:#bbf7d0;transform:translateY(-2px);box-shadow:0 6px 12px rgba(5,150,105,.2)}
  .btn-ferias svg{transition:transform .3s}
  .btn-ferias:hover svg{transform:scale(1.1) rotate(-5deg)}
  .btn-ferias .tooltip-text{visibility:hidden;width:140px;background:#111;color:#fff;text-align:center;border-radius:6px;padding:8px;position:absolute;z-index:100;bottom:125%;left:50%;margin-left:-70px;opacity:0;transition:opacity .3s;font-size:12px;font-weight:normal;box-shadow:0 4px 12px rgba(0,0,0,.15);pointer-events:none}
  .btn-ferias .tooltip-text::after{content:"";position:absolute;top:100%;left:50%;margin-left:-5px;border:5px solid transparent;border-top-color:#111}
  .btn-ferias:hover .tooltip-text{visibility:visible;opacity:1}

  /* SELEÇÃO */
  .btn-fechar-topico{background:#fef2f2;border:1px solid #fecaca;color:var(--danger);padding:8px 12px;border-radius:6px;cursor:pointer;font-size:12px;display:flex;align-items:center;gap:6px}
  .btn-fechar-topico:hover{background:#fee2e2}
  .selecao-botoes-container{display:none;gap:8px;margin-top:12px;flex-direction:column}
  .selecao-botoes-container.ativo{display:flex}
  .selecao-botoes-linha{display:flex;gap:8px;width:100%}
  .selecao-botoes-linha .btn-impressao{margin-bottom:0}
  .btn-impressao{display:flex;align-items:center;gap:6px;padding:8px 12px;border-radius:6px;border:1px solid var(--borda);background:var(--card);color:var(--ink);cursor:pointer;transition:all .2s;font-size:12px;font-weight:500;width:100%;justify-content:center;margin-bottom:8px}
  .btn-impressao:hover{background:#f3f8ff}
  .btn-selecionar-todos{flex:1;background:#f0f9ff!important;border-color:#bae6fd!important;color:var(--azul)!important;padding:8px 12px;border-radius:6px;border:1px solid;cursor:pointer;font-size:12px;font-weight:500;display:flex;align-items:center;justify-content:center;gap:6px}
  .btn-selecionar-todos:hover{background:#e0f2fe!important}
  .btn-cancelar-selecao{background:#fef2f2!important;border-color:#fecaca!important;color:var(--danger)!important;padding:8px 12px;min-width:36px;display:flex;align-items:center;justify-content:center;border:1px solid;border-radius:6px;cursor:pointer}
  .btn-cancelar-selecao:hover{background:#fee2e2!important}

  /* RESULTADOS DE BUSCA */
  .resultados-busca{margin-top:16px;display:none;max-height:480px;overflow-y:auto;border:1px solid var(--borda);border-radius:10px;background:var(--card);box-shadow:0 8px 24px rgba(11,78,167,.10);scrollbar-width:none;-ms-overflow-style:none}
  .resultados-busca::-webkit-scrollbar{display:none}
  .resultados-header{padding:10px 14px;border-bottom:1px solid var(--borda);background:#f7fbff;border-radius:10px 10px 0 0;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:2}
  .resultados-header span{font-size:12px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.5px}
  .resultados-count{background:var(--azul);color:white;font-size:11px;font-weight:700;padding:2px 8px;border-radius:20px}
  .resultados-grupo{border-bottom:1px solid var(--borda)}
  .resultados-grupo:last-child{border-bottom:none}
  .resultados-grupo-header{padding:8px 14px;background:#fafcff;font-size:11px;font-weight:700;color:var(--ink-strong);text-transform:uppercase;letter-spacing:.5px;display:flex;align-items:center;gap:6px;border-bottom:1px solid var(--borda);cursor:pointer;transition:background .2s}
  .resultados-grupo-header:hover{background:#f0f7ff}
  .resultado-item{padding:10px 14px;border-bottom:1px solid #f0f4ff;cursor:pointer;transition:all .2s}
  .resultado-item:last-child{border-bottom:none}
  .resultado-item:hover{background:#f3f8ff}
  .resultado-tipo-badge{display:inline-block;font-size:10px;font-weight:700;padding:2px 7px;border-radius:20px;margin-bottom:4px;text-transform:uppercase;letter-spacing:.3px}
  .badge-topico{background:#e0f2fe;color:#0369a1}
  .badge-subtopico{background:#ede9fe;color:#7c3aed}
  .badge-conteudo{background:#dcfce7;color:#166534}
  .resultado-titulo{font-weight:600;color:var(--ink-strong);margin-bottom:4px;font-size:13px}
  .resultado-trecho{font-size:12px;color:var(--muted);line-height:1.4}
  .sem-resultados{text-align:center;padding:30px 20px;color:var(--muted);font-size:14px}
  .sem-resultados svg{width:32px;height:32px;opacity:.4;margin:0 auto 10px;display:block}

  /* HIGHLIGHT — justo nas letras, sem estourar */
  mark{
    background-color:#fef08a;
    color:inherit;
    padding:0;
    margin:0;
    border-radius:2px;
    font-weight:700;
    line-height:inherit;
    display:inline;
  }

  /* MENU SIDEBAR — sem overlay escuro */
  .menu-overlay{display:none!important}
  .menu-sidebar{position:fixed;top:0;left:0;width:320px;height:100vh;background:var(--card);border-right:1px solid var(--borda);box-shadow:4px 0 24px rgba(0,0,0,.12);overflow-y:auto;scrollbar-width:none;-ms-overflow-style:none;transition:transform .3s ease;z-index:1000;padding:20px;transform:translateX(-100%)}
  .menu-sidebar::-webkit-scrollbar{display:none}
  .menu-sidebar.ativo{transform:translateX(0)}
  .menu-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid var(--borda)}
  .menu-header h3{margin:0;color:var(--ink-strong);font-size:18px}
  .btn-fechar-sidebar{background:none;border:none;cursor:pointer;color:var(--muted);padding:8px;border-radius:6px;transition:all .2s}
  .btn-fechar-sidebar:hover{background:#fef2f2;color:var(--danger)}
  .btn-fechar-sidebar svg{width:20px;height:20px}
  .menu-secao{margin-bottom:24px}
  .menu-secao h4{font-size:14px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid var(--borda)}
  .menu-opcao{display:flex;align-items:center;gap:12px;padding:12px 16px;border-radius:8px;cursor:pointer;transition:all .2s;margin-bottom:6px;text-decoration:none;color:var(--ink)}
  .menu-opcao:hover{background:#f3f8ff}
  .menu-opcao .codigo{background:var(--azul);color:white;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:600;min-width:40px;text-align:center}

  /* POPUP */
  .popup-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:none;justify-content:center;align-items:center;z-index:2000}
  .popup-overlay.ativo{display:flex}
  .popup-container{background:var(--card);border-radius:12px;padding:24px;max-width:400px;width:90%;box-shadow:0 10px 30px rgba(0,0,0,.2);animation:popupIn .3s ease}
  @keyframes popupIn{from{opacity:0;transform:scale(.9) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}
  .popup-header{display:flex;align-items:center;gap:12px;margin-bottom:16px}
  .popup-header svg{width:24px;height:24px;color:var(--warn)}
  .popup-header h4{margin:0;color:var(--ink-strong);font-size:16px}
  .popup-content{margin-bottom:20px;color:var(--ink);line-height:1.5}
  .popup-botoes{display:flex;justify-content:flex-end;gap:8px}
  .popup-btn{padding:8px 16px;border-radius:6px;border:1px solid var(--borda);background:var(--card);color:var(--ink);cursor:pointer;font-weight:500;transition:all .2s}
  .popup-btn:hover{background:#f3f8ff}

  /* IMPRESSÃO */
  @media print{
    body *{visibility:hidden}
    .conteudo-area,.conteudo-area *{visibility:visible}
    .conteudo-area{position:absolute;left:0;top:0;width:100%;box-shadow:none;border:none;padding:0}
    .conteudo-header,.btn-acao,.btn-fechar-topico,.lista-subtopicos{display:none}
    .conteudo-carregado h2{page-break-before:auto;page-break-after:avoid;break-inside:avoid}
    @page{margin:1cm}
  }

  /* RESPONSIVO */
  @media(max-width:768px){
    .anotacoes-container{grid-template-columns:1fr}
    .topicos-sidebar{position:static}
    .conteudo-com-subtopicos{grid-template-columns:1fr}
    .lista-subtopicos{position:static;margin-bottom:20px}
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Anotações</h1>
    <p class="lead">Sistema organizado de anotações por tópicos e subtópicos</p>
  </header>

  <div class="toolbar">
    <button class="btn-toolbar btn-fechar" id="btn-fechar">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
      </svg>Fechar
    </button>

    <button class="btn-toolbar btn-ferias" id="btn-ferias">
      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" xml:space="preserve" width="18" height="18">
        <polygon style="fill:none;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;" points="13,18 21,18 12,28 8,28"/>
        <polyline style="fill:none;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;" points="20.2,14 13,6 9,6 13,14"/>
        <path style="fill:none;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;" d="M12,20H4L1,9h3l4,5H28c0.8,0,1.6,0.3,2.1,0.9l0,0c1.2,1.2,1.2,3.1,0,4.2l0,0C29.5,19.7,28.8,20,28,20h-8.8"/>
      </svg>
      <span class="tooltip-text">Abrir Rotinas de Férias</span>
      Rotinas Férias
    </button>

    <button class="btn-toolbar btn-menu" id="btn-menu">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/>
      </svg>Menu
    </button>

    <div class="search">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
      </svg>
      <input type="search" id="campo-busca" placeholder="Buscar nas anotações…" autocomplete="off"/>
    </div>
  </div>

  <div class="anotacoes-container">
    <div class="topicos-sidebar">
      <div class="sidebar-label">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="15" y2="12"/><line x1="3" y1="18" x2="9" y2="18"/>
        </svg>
        Tópicos
      </div>
      <div id="topicos-lista"></div>
      <div class="resultados-busca" id="resultados-busca"></div>
    </div>

    <div class="conteudo-area">
      <div class="conteudo-header">
        <h2 id="topico-titulo">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/>
          </svg>
          Bem-vindo
        </h2>
        <div class="conteudo-header-acoes" id="topico-acoes"></div>
      </div>
      <div id="conteudo-dinamico">
        <div class="estado-vazio">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
          </svg>
          <p>Selecione um tópico para visualizar o conteúdo</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Menu Sidebar -->
<div class="menu-overlay" id="menu-overlay"></div>
<div class="menu-sidebar" id="menu-sidebar">
  <div class="menu-header">
    <h3>Navegação</h3>
    <button class="btn-fechar-sidebar" id="btn-fechar-sidebar">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    </button>
  </div>
  <div class="menu-secao">
    <h4>MACS</h4>
    <a href="../mac77.html" class="menu-opcao"><div class="codigo">77</div><span>MAC Bairro São Geraldo</span></a>
    <a href="../mac78.html" class="menu-opcao"><div class="codigo">78</div><span>MAC Bairro Planalto</span></a>
    <a href="../mac79.html" class="menu-opcao"><div class="codigo">79</div><span>MAC Romeu Duarte</span></a>
    <a href="../mac80.html" class="menu-opcao"><div class="codigo">80</div><span>MAC Rua São Geraldo / Centro 2</span></a>
    <a href="../mac277.html" class="menu-opcao"><div class="codigo">277</div><span>MAC Matriz</span></a>
    <a href="../mac853.html" class="menu-opcao"><div class="codigo">853</div><span>MAC Concesso</span></a>
    <a href="../mac989.html" class="menu-opcao"><div class="codigo">989</div><span>MAC Araújos</span></a>
    <a href="../mac1249.html" class="menu-opcao"><div class="codigo">1249</div><span>MAC Jardim do Lago</span></a>
    <a href="../mac1436.html" class="menu-opcao"><div class="codigo">1436</div><span>MAC São Gonçalo do Pará</span></a>
  </div>
  <div class="menu-secao">
    <h4>São José</h4>
    <a href="../saojose.html" class="menu-opcao"><span>Pedido São José</span></a>
    <a href="../paototal.html" class="menu-opcao"><span>Pedido Pão Total</span></a>
  </div>
  <div class="menu-secao">
    <h4>Tabelas</h4>
    <a href="../pdfs/Tabela 2025 Geral.pdf" class="menu-opcao" target="_blank"><span>Tabela de Preços Geral</span></a>
    <a href="../pdfs/Tabela 2025 Empresa.pdf" class="menu-opcao" target="_blank"><span>Tabela de Preços Empresa</span></a>
    <a href="https://github.com/henriteodoro/paratestes/releases/download/v1.0/Catalogo.Sao.Jose.2025.AT03.pdf" class="menu-opcao" target="_blank"><span>Catálogo de Produtos</span></a>
  </div>
  <div class="menu-secao">
    <h4>Ferramentas</h4>
    <a href="../processadordepedidos.html" class="menu-opcao"><span>Processador de Pedidos</span></a>
    <a href="../ods.html" class="menu-opcao"><span>Visualizar Planilhas</span></a>
    <a href="../simularpedido.html" class="menu-opcao"><span>Simulador de Pedido</span></a>
    <a href="anotacoes.html" class="menu-opcao"><span>Anotações</span></a>
    <a href="../planilhaautocontrole.html" class="menu-opcao"><span>Planilhas de Autocontrole</span></a>
  </div>
</div>

<!-- Lightbox -->
<div id="image-lightbox" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.9);z-index:1000;justify-content:center;align-items:center;">
  <div style="position:relative;max-width:90%;max-height:90%;">
    <button id="lightbox-close" style="position:absolute;top:-40px;right:0;background:none;border:none;color:white;font-size:30px;cursor:pointer;">×</button>
    <img id="lightbox-image" src="" alt="" style="max-width:100%;max-height:80vh;border-radius:8px;">
    <a id="lightbox-download" download style="display:block;text-align:center;margin-top:10px;color:white;text-decoration:none;background:var(--azul);padding:10px;border-radius:6px;">↓ Salvar Imagem</a>
  </div>
</div>

<!-- Popup -->
<div class="popup-overlay" id="popup-overlay">
  <div class="popup-container">
    <div class="popup-header">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      <h4 id="popup-titulo">Atenção</h4>
    </div>
    <div class="popup-content" id="popup-conteudo">Mensagem de alerta</div>
    <div class="popup-botoes"><button class="popup-btn" id="popup-fechar">Fechar</button></div>
  </div>
</div>

<iframe id="print-iframe" style="display:none;"></iframe>

<script>
// ═══════════════════════════════════════════════════
// LISTA DE TÓPICOS — adicione novos aqui.
// Serão exibidos automaticamente em ordem alfabética.
// ═══════════════════════════════════════════════════
const TOPICOS = [
  {
    arquivo: 'fechamento-caixas.html',
    nome: 'Fechamento Caixas',
    icone: `<rect x="2" y="4" width="20" height="16" rx="2"/><path d="M8 2v4M16 2v4M2 10h20"/>`
  },
  {
    arquivo: 'fornecedores.html',
    nome: 'Fornecedores',
    icone: `<path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>`
  },
  {
    arquivo: 'geral.html',
    nome: 'Geral',
    icone: `<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/>`
  },
  {
    arquivo: 'uteis-clientes.html',
    nome: 'Informações Úteis Clientes',
    icone: `<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>`
  },
  {
    arquivo: 'clientes-por-rota.html',
    nome: 'Clientes por Rota',
    icone: `<path d="M3 12h4l3 8 4-16 3 8h4"/>`
  },
  {
    arquivo: 'lancamento-pedidos.html',
    nome: 'Lançamentos Pedidos',
    icone: `<path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/>`
  },
  {
    arquivo: 'montagem-rotas.html',
    nome: 'Montagem Rotas',
    icone: `<path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/>`
  },
  {
    arquivo: 'pedidos-sj-pt.html',
    nome: 'Pedidos São José e Pão Total',
    icone: `<path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/>`
  }
];

// Ordena A→Z com suporte pt-BR
function ordenarTopicos(lista) {
  return [...lista].sort((a,b) => a.nome.localeCompare(b.nome,'pt-BR',{sensitivity:'base'}));
}

// Monta a lista de tópicos na sidebar
function renderizarTopicos() {
  const lista = document.getElementById('topicos-lista');
  lista.innerHTML = ordenarTopicos(TOPICOS).map(t => `
    <div class="topico-item" data-arquivo="${t.arquivo}">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">${t.icone}</svg>
      ${t.nome}
    </div>
  `).join('');
  lista.querySelectorAll('.topico-item').forEach(el => {
    el.addEventListener('click', function() {
      lista.querySelectorAll('.topico-item').forEach(i => i.classList.remove('ativo'));
      this.classList.add('ativo');
      gerenciador.carregarTopico(this.dataset.arquivo);
    });
  });
}

// ═══════════════════════════════════════════════════
// CLASSE PRINCIPAL
// ═══════════════════════════════════════════════════
class GerenciadorAnotacoes {
  constructor() {
    this.topicoAtual = null;
    this.subtopicoAtual = null;
    this.cache = new Map();
    this.conteudoAtual = null;
    this.modoSelecao = false;
    this.topicosSelecionados = new Set();
    this.conteudoSubtopicoAtual = null;
  }

  async carregarTopico(arquivo, scrollTo = null) {
    this.topicoAtual = arquivo;
    this.subtopicoAtual = null;
    this.conteudoSubtopicoAtual = null;
    this.modoSelecao = false;
    this.topicosSelecionados.clear();

    const item = document.querySelector(`[data-arquivo="${arquivo}"]`);
    const nome  = item ? item.textContent.trim() : arquivo;
    const icone = item ? item.querySelector('svg').innerHTML : '';

    document.getElementById('topico-titulo').innerHTML =
      `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">${icone}</svg>${nome}`;

    document.getElementById('topico-acoes').innerHTML = `
      <button class="btn-acao btn-pdf" id="btn-pdf-topico">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/>
        </svg>PDF
      </button>
      <button class="btn-acao btn-imprimir" id="btn-imprimir-topico">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
          <polyline points="6 9 6 2 18 2 18 9"/>
          <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
          <rect x="6" y="14" width="12" height="8"/>
        </svg>Imprimir
      </button>
      <button class="btn-acao btn-fechar" id="btn-fechar-topico">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
          <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
        </svg>Fechar
      </button>
    `;

    document.getElementById('conteudo-dinamico').innerHTML = '<div class="loading">Carregando…</div>';

    try {
      if (!this.cache.has(arquivo)) {
        const r = await fetch(arquivo);
        if (!r.ok) throw new Error('404');
        this.cache.set(arquivo, await r.text());
      }
      this.processarConteudo(this.cache.get(arquivo), arquivo, scrollTo);
    } catch { this.mostrarErro(arquivo); }

    window.scrollTo({top:0,behavior:'smooth'});
  }

  processarConteudo(html, arquivo, scrollTo) {
    const tmp = document.createElement('div');
    tmp.innerHTML = html;
    tmp.querySelectorAll('script,style,link,meta,title,head').forEach(e=>e.remove());
    const body = tmp.querySelector('body');
    let conteudo = body ? body.innerHTML : tmp.innerHTML;
    if (arquivo === 'uteis-clientes.html')
      conteudo = conteudo.replace(/class="container"/g,'class="conteudo-clientes"');

    const tmp2 = document.createElement('div');
    tmp2.innerHTML = conteudo;
    tmp2.querySelectorAll('script,style').forEach(e=>e.remove());

    const info  = TOPICOS.find(t=>t.arquivo===arquivo);
    const titulo = (tmp2.querySelector('h1')?.textContent || info?.nome || arquivo).replace('| °','').trim();
    const h2s   = Array.from(tmp2.querySelectorAll('h2'));

    this.conteudoAtual = {
      html: tmp2.innerHTML,
      titulo,
      subtopicos: h2s.map(h2 => ({
        titulo:   h2.textContent.replace('| °','').trim(),
        id:       this.criarId(h2.textContent),
        conteudo: this.extrairConteudoH2(h2)
      }))
    };

    if (h2s.length > 0) {
      this.criarInterfaceComSubtopicos();
    } else {
      tmp2.querySelector('h1')?.remove();
      document.getElementById('conteudo-dinamico').innerHTML =
        '<div class="conteudo-carregado">' + tmp2.innerHTML + '</div>';
    }

    this.adicionarEventosImagens();
    if (scrollTo) setTimeout(()=>this.rolarParaElemento(scrollTo), 350);
  }

  extrairConteudoH2(h2) {
    let html=''; let cur=h2.nextElementSibling;
    while(cur && cur.tagName!=='H2'){html+=cur.outerHTML; cur=cur.nextElementSibling;}
    return `<h2>${h2.textContent.replace('| °','').trim()}</h2>${html}`;
  }

  criarInterfaceComSubtopicos() {
    document.getElementById('conteudo-dinamico').innerHTML = `
      <div class="conteudo-com-subtopicos">
        <div class="lista-subtopicos">
          <div class="lista-subtopicos-header">
            <h3>TÓPICOS</h3>
            <button class="btn-icone-editar" id="btn-selecionar-topicos" title="Selecionar tópicos">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 11l3 3 7-7"/>
              </svg>
            </button>
          </div>
          <div id="lista-subtopicos-conteudo">
            ${this.conteudoAtual.subtopicos.map((s,i)=>`
              <div class="subtopico-item" data-subtopico="${s.id}" data-index="${i}">
                <div style="display:flex;align-items:center;flex:1;">
                  <label style="cursor:pointer;flex:1;">${s.titulo}</label>
                </div>
              </div>`).join('')}
          </div>
          <div class="selecao-botoes-container" id="selecao-botoes-container">
            <div class="selecao-botoes-linha">
              <button class="btn-selecionar-todos" id="btn-selecionar-todos">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                  <rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 11l3 3 7-7"/>
                </svg>Selecionar todos
              </button>
              <button class="btn-cancelar-selecao" id="btn-cancelar-selecao">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
              </button>
            </div>
            <div class="selecao-botoes-linha">
              <button class="btn-impressao btn-pdf" id="btn-pdf-selecionados">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                  <polyline points="14 2 14 8 20 8"/>
                </svg>PDF
              </button>
              <button class="btn-impressao btn-imprimir" id="btn-imprimir-selecionados">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                  <polyline points="6 9 6 2 18 2 18 9"/>
                  <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
                  <rect x="6" y="14" width="12" height="8"/>
                </svg>Imprimir
              </button>
            </div>
          </div>
        </div>
        <div id="conteudo-subtopico" class="conteudo-subtopico">
          <div class="estado-vazio">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
            </svg>
            <p>Selecione um tópico para visualizar o conteúdo</p>
          </div>
        </div>
      </div>
    `;
    this.adicionarEventosSubtopicos();
    this.adicionarEventosSelecao();
  }

  adicionarEventosSubtopicos() {
    document.querySelectorAll('.subtopico-item').forEach(el => {
      el.addEventListener('click', () => {
        if (this.modoSelecao) {
          const cb = el.querySelector('.subtopico-checkbox');
          if (cb) { cb.checked=!cb.checked; this.topicosSelecionados[cb.checked?'add':'delete'](+el.dataset.index); }
          return;
        }
        this.mostrarSubtopico(+el.dataset.index);
      });
    });
  }

  adicionarEventosSelecao() {
    document.getElementById('btn-selecionar-topicos')?.addEventListener('click',()=>this.ativarModoSelecao());
    document.getElementById('btn-pdf-selecionados')?.addEventListener('click',()=>this.salvarSubtopicosSelecionados('pdf'));
    document.getElementById('btn-imprimir-selecionados')?.addEventListener('click',()=>this.salvarSubtopicosSelecionados('imprimir'));
    document.getElementById('btn-selecionar-todos')?.addEventListener('click',()=>this.selecionarTodosTopicos());
    document.getElementById('btn-cancelar-selecao')?.addEventListener('click',()=>this.desativarModoSelecao());
  }

  ativarModoSelecao() {
    this.modoSelecao = true;
    const cont = document.getElementById('lista-subtopicos-conteudo');
    if (!cont) return;
    cont.innerHTML = this.conteudoAtual.subtopicos.map((s,i)=>`
      <div class="subtopico-item" data-index="${i}">
        <div style="display:flex;align-items:center;flex:1;">
          <input type="checkbox" class="subtopico-checkbox" id="check-${i}" data-index="${i}" ${this.topicosSelecionados.has(i)?'checked':''}>
          <label for="check-${i}" style="margin-left:8px;cursor:pointer;flex:1;">${s.titulo}</label>
        </div>
      </div>`).join('');
    document.getElementById('selecao-botoes-container')?.classList.add('ativo');
    const btn = document.getElementById('btn-selecionar-topicos');
    if (btn) btn.style.display='none';
    document.querySelectorAll('.subtopico-checkbox').forEach(cb=>{
      cb.addEventListener('change',()=>{ this.topicosSelecionados[cb.checked?'add':'delete'](+cb.dataset.index); });
    });
  }

  desativarModoSelecao() {
    this.modoSelecao = false; this.topicosSelecionados.clear();
    const cont = document.getElementById('lista-subtopicos-conteudo');
    if (!cont) return;
    cont.innerHTML = this.conteudoAtual.subtopicos.map((s,i)=>`
      <div class="subtopico-item" data-subtopico="${s.id}" data-index="${i}">
        <div style="display:flex;align-items:center;flex:1;">
          <label style="cursor:pointer;flex:1;">${s.titulo}</label>
        </div>
      </div>`).join('');
    document.getElementById('selecao-botoes-container')?.classList.remove('ativo');
    const btn = document.getElementById('btn-selecionar-topicos');
    if (btn) btn.style.display='flex';
    this.adicionarEventosSubtopicos();
  }

  selecionarTodosTopicos() {
    const cbs = document.querySelectorAll('.subtopico-checkbox');
    if (!cbs.length) return;
    const tudo = Array.from(cbs).every(c=>c.checked);
    cbs.forEach(c=>{ c.checked=!tudo; this.topicosSelecionados[c.checked?'add':'delete'](+c.dataset.index); });
    const btn = document.getElementById('btn-selecionar-todos');
    if (btn) btn.innerHTML = `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
        <rect x="3" y="3" width="18" height="18" rx="2"/>${tudo?'<path d="M9 11l3 3 7-7"/>':''}
      </svg>${tudo?'Selecionar todos':'Desmarcar todos'}`;
  }

  mostrarSubtopico(index) {
    const cont = document.getElementById('conteudo-subtopico');
    if (!cont || !this.conteudoAtual?.subtopicos[index]) return;
    const sub = this.conteudoAtual.subtopicos[index];
    this.subtopicoAtual = index;
    this.conteudoSubtopicoAtual = sub.conteudo;
    cont.innerHTML = '<div class="conteudo-carregado">'+sub.conteudo+'</div>';
    document.querySelectorAll('.subtopico-item').forEach(el=>el.classList.remove('ativo'));
    document.querySelector(`[data-index="${index}"]`)?.classList.add('ativo');
    this.adicionarEventosImagens();
    cont.scrollTo({top:0,behavior:'smooth'});
  }

  adicionarEventosImagens() {
    document.querySelectorAll('#conteudo-dinamico img').forEach(img=>{
      img.addEventListener('click',()=>this.abrirLightbox(img.src));
    });
  }

  abrirLightbox(src) {
    document.getElementById('lightbox-image').src = src;
    document.getElementById('lightbox-download').href = src;
    document.getElementById('lightbox-download').download = src.split('/').pop()||'imagem.png';
    document.getElementById('image-lightbox').style.display = 'flex';
  }

  fecharLightbox() { document.getElementById('image-lightbox').style.display='none'; }

  criarId(t) { return t.toLowerCase().replace(/\s+/g,'-').normalize('NFD').replace(/[\u0300-\u036f]/g,''); }

  mostrarErro(arquivo) {
    document.getElementById('conteudo-dinamico').innerHTML = `
      <div class="erro">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <p>Arquivo não encontrado: <strong>${arquivo}</strong></p>
        <p style="font-size:13px;margin-top:8px">Crie o arquivo na mesma pasta para ver o conteúdo.</p>
      </div>`;
  }

  fecharTopico() {
    this.topicoAtual=null; this.subtopicoAtual=null;
    this.conteudoAtual=null; this.conteudoSubtopicoAtual=null;
    this.modoSelecao=false; this.topicosSelecionados.clear();
    document.querySelectorAll('.topico-item').forEach(i=>i.classList.remove('ativo'));
    document.getElementById('topico-titulo').innerHTML = `
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/>
      </svg>Bem-vindo`;
    document.getElementById('topico-acoes').innerHTML='';
    document.getElementById('conteudo-dinamico').innerHTML=`
      <div class="estado-vazio">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <p>Selecione um tópico para visualizar o conteúdo</p>
      </div>`;
    window.scrollTo({top:0,behavior:'smooth'});
  }

  salvarSubtopicoAtual(fmt) {
    if (!this.conteudoSubtopicoAtual){this.mostrarPopup('Selecione um subtópico primeiro.');return;}
    const sub=this.conteudoAtual.subtopicos[this.subtopicoAtual];
    this.gerarSaida(`<h1>${this.conteudoAtual.titulo} — ${sub.titulo}</h1>${this.conteudoSubtopicoAtual}`,`${this.conteudoAtual.titulo} - ${sub.titulo}`,fmt);
  }
  salvarTopicoCompleto(fmt) {
    const tmp=document.createElement('div'); tmp.innerHTML=this.conteudoAtual.html; tmp.querySelector('h1')?.remove();
    this.gerarSaida(`<h1>${this.conteudoAtual.titulo}</h1>${tmp.innerHTML}`,this.conteudoAtual.titulo,fmt);
  }
  salvarSubtopicosSelecionados(fmt) {
    if(!this.topicosSelecionados.size){this.mostrarPopup('Selecione pelo menos um tópico.');return;}
    let html=`<h1>${this.conteudoAtual.titulo}</h1>`;
    this.topicosSelecionados.forEach(i=>{html+=this.conteudoAtual.subtopicos[i].conteudo;});
    this.gerarSaida(html,this.conteudoAtual.titulo,fmt);
  }

  async gerarSaida(conteudo, titulo, formato) {
    const tmp=document.createElement('div'); tmp.innerHTML=conteudo;
    for(const img of tmp.querySelectorAll('img')){
      const src=img.src||img.getAttribute('src');
      if(!src||src.startsWith('data:')) continue;
      try{
        const url=src.startsWith('http')?src:new URL(src,location.href).href;
        const r=await fetch(url); if(!r.ok) continue;
        const b64=await new Promise(res=>{const fr=new FileReader();fr.onloadend=()=>res(fr.result);fr.readAsDataURL(await r.blob());});
        img.src=b64;
      }catch{}
    }
    const estilos=`<style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
      body{font-family:'Inter',system-ui;line-height:1.6;margin:40px;color:#0b3b6b;background:white}
      h1{color:#0b5ed7;border-bottom:2px solid #e6eefc;padding-bottom:10px;margin-bottom:25px;font-size:24px}
      h2{color:#0b4fa0;margin-top:25px;border-left:4px solid #007BFF;padding-left:12px;font-size:18px}
      h2::before{content:"• ";color:#007BFF}
      h3{color:#0b4fa0;font-size:16px;margin:20px 0 8px}
      .destaque{background:#f0f7ff;padding:12px 16px;border-radius:8px;border-left:4px solid #007BFF;margin:15px 0}
      .info-box{background:#fff7f0;padding:12px 16px;border-radius:8px;border-left:4px solid #f59e0b;margin:15px 0}
      .ferias-box{background:#f0fff4;padding:12px 16px;border-radius:8px;border-left:4px solid #38a169;margin:15px 0}
      .pix-info{background:#f8f0ff;padding:12px 16px;border-radius:8px;border-left:4px solid #8a2be2;margin:12px 0;font-family:monospace;font-size:14px}
      .tabela-melhorada{width:100%;border-collapse:collapse}
      .tabela-melhorada thead{background:#007BFF;color:white}
      .tabela-melhorada th,.tabela-melhorada td{padding:10px 14px;text-align:left;border-bottom:1px solid #e6eefc}
      .clientes-container{background:#f8f9fa;padding:16px 20px;border-radius:10px;border-left:4px solid #007BFF;margin:12px 0 24px}
      .codigo-box{background:#007BFF;color:white;padding:2px 8px;border-radius:6px;font-size:13px;font-weight:bold}
      .image-container{background:#f5f5f5;border:1px solid #ddd;border-radius:8px;padding:10px;text-align:center;margin:16px 0}
      .image-container img{max-width:100%;max-height:400px;object-fit:contain}
      @media print{@page{margin:1cm}}
    </style>`;
    const full=`<!DOCTYPE html><html><head><meta charset="utf-8"><title>${titulo}</title>${estilos}</head><body>${tmp.innerHTML}</body></html>`;
    if(formato==='imprimir'){
      const iframe=document.getElementById('print-iframe');
      const url=URL.createObjectURL(new Blob([full],{type:'text/html'}));
      iframe.src=url;
      iframe.onload=()=>{try{iframe.contentWindow.focus();iframe.contentWindow.print();setTimeout(()=>URL.revokeObjectURL(url),1000);}catch{}};
    }else{
      const a=Object.assign(document.createElement('a'),{href:URL.createObjectURL(new Blob([full],{type:'text/html'})),download:`${titulo.replace(/\s+/g,'_').replace(/[^\w]/g,'')}.html`});
      document.body.appendChild(a);a.click();document.body.removeChild(a);setTimeout(()=>URL.revokeObjectURL(a.href),1000);
    }
  }

  mostrarPopup(msg,titulo='Atenção'){
    document.getElementById('popup-titulo').textContent=titulo;
    document.getElementById('popup-conteudo').textContent=msg;
    document.getElementById('popup-overlay').classList.add('ativo');
  }
  fecharPopup(){ document.getElementById('popup-overlay').classList.remove('ativo'); }

  // ═══════════════════════════════════════════════════
  // BUSCA ABRANGENTE — percorre TODOS os nós de texto
  // ═══════════════════════════════════════════════════
  async buscarConteudo(termo) {
    const ctr = document.getElementById('resultados-busca');
    if (!termo.trim()) {
      ctr.style.display='none';
      document.querySelectorAll('.topico-item').forEach(i=>i.style.display='flex');
      return;
    }

    ctr.style.display='block';
    ctr.innerHTML=`
      <div class="resultados-header"><span>Buscando…</span></div>
      <div style="padding:20px;text-align:center;color:var(--muted);font-size:13px">Pesquisando em todos os tópicos…</div>`;
    document.querySelectorAll('.topico-item').forEach(i=>i.style.display='none');

    const termoL = termo.toLowerCase().trim();

    const mapa = new Map(); // arquivo → { topico, itens:[], nomeMatch }

    for (const topico of TOPICOS) {
      const arquivo = topico.arquivo;
      try {
        if (!this.cache.has(arquivo)) {
          const r = await fetch(arquivo);
          if (!r.ok) continue;
          this.cache.set(arquivo, await r.text());
        }

        const tmp = document.createElement('div');
        tmp.innerHTML = this.cache.get(arquivo);
        tmp.querySelectorAll('script,style,link,meta,title,head').forEach(e=>e.remove());
        const raiz = tmp.querySelector('body') || tmp;

        const itens = [];

        // — H2: subtópicos —
        raiz.querySelectorAll('h2').forEach(h2 => {
          const txt = h2.textContent.replace('| °','').trim();
          if (txt.toLowerCase().includes(termoL))
            itens.push({tipo:'subtopico', titulo:txt, id:this.criarId(txt), posicao:'h2', trecho:txt});
        });

        // — H3, H4 —
        raiz.querySelectorAll('h3,h4').forEach(h => {
          const txt = h.textContent.trim();
          if (txt.toLowerCase().includes(termoL))
            itens.push({tipo:'conteudo', titulo:txt, textoCompleto:txt, posicao:h.tagName.toLowerCase(), trecho:txt});
        });

        // — VARREDURA COMPLETA por nós de texto (captura divs, spans, p, li, td, th, label, etc.) —
        const vistos = new Set();
        const walker = document.createTreeWalker(raiz, NodeFilter.SHOW_TEXT, {
          acceptNode(node) {
            const tag = node.parentElement?.tagName?.toLowerCase();
            if (!tag || ['script','style','head','title','meta','noscript'].includes(tag)) return NodeFilter.FILTER_REJECT;
            return NodeFilter.FILTER_ACCEPT;
          }
        });

        let node;
        while ((node = walker.nextNode())) {
          const raw = node.textContent.trim();
          if (raw.length < 2) continue;
          if (!raw.toLowerCase().includes(termoL)) continue;

          const pai = node.parentElement;
          const tagPai = pai?.tagName?.toLowerCase() || '';

          // H1–H4 já tratados
          if (['h1','h2','h3','h4'].includes(tagPai)) continue;

          // Contexto: pega o bloco mais próximo com texto curto o suficiente
          let ctx = raw;
          if (pai && pai.textContent.trim().length <= 400)
            ctx = pai.textContent.trim();

          // Deduplica por contexto (evita múltiplos hits no mesmo bloco)
          const chave = ctx.toLowerCase().substring(0,100);
          if (vistos.has(chave)) continue;
          vistos.add(chave);

          const titulo = ctx.length>72 ? ctx.substring(0,72)+'…' : ctx;
          itens.push({tipo:'conteudo', titulo, textoCompleto:ctx, posicao:tagPai||'p', trecho:ctx});
        }

        const nomeMatch = topico.nome.toLowerCase().includes(termoL);
        if (itens.length > 0 || nomeMatch)
          mapa.set(arquivo, {topico, itens, nomeMatch});

      } catch(err) { console.error('Erro em', arquivo, err); }
    }

    this.exibirResultados(mapa, termo);
  }

  exibirResultados(mapa, termo) {
    const ctr = document.getElementById('resultados-busca');
    if (!ctr) return;

    if (!mapa.size) {
      ctr.innerHTML=`
        <div class="resultados-header"><span>Resultados</span><span class="resultados-count">0</span></div>
        <div class="sem-resultados">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
          </svg>
          Nenhum resultado para "<strong>${this.esc(termo)}</strong>"
        </div>`;
      return;
    }

    let total=0;
    mapa.forEach(({itens})=>total+=Math.max(itens.length,1));

    let html=`<div class="resultados-header">
      <span>Resultados para "${this.esc(termo)}"</span>
      <span class="resultados-count">${total}</span>
    </div>`;

    mapa.forEach(({topico,itens,nomeMatch},arquivo)=>{
      html+=`<div class="resultados-grupo">
        <div class="resultados-grupo-header" data-arquivo="${arquivo}" data-abrir="1">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
          </svg>
          ${this.esc(topico.nome)}
          ${nomeMatch?'<span style="margin-left:auto;font-size:10px;background:#dbeafe;color:#1d4ed8;padding:2px 6px;border-radius:20px;text-transform:none;font-weight:600;">Tópico</span>':''}
        </div>`;

      if (itens.length===0 && nomeMatch) {
        html+=`<div class="resultado-item" data-arquivo="${arquivo}" data-tipo="topico">
          <span class="resultado-tipo-badge badge-topico">Tópico</span>
          <div class="resultado-titulo">${this.destacar(this.esc(topico.nome),termo)}</div>
          <div class="resultado-trecho">Clique para abrir este tópico</div>
        </div>`;
      }

      itens.forEach(item=>{
        const badge  = item.tipo==='subtopico'?'badge-subtopico':'badge-conteudo';
        const label  = item.tipo==='subtopico'?'Subtópico':'Conteúdo';
        const trecho = (item.trecho||'').substring(0,160);
        html+=`<div class="resultado-item"
            data-arquivo="${arquivo}"
            data-tipo="${item.tipo}"
            data-id="${item.id||''}"
            data-texto="${this.escAttr(item.textoCompleto||'')}"
            data-posicao="${item.posicao||''}">
          <span class="resultado-tipo-badge ${badge}">${label}</span>
          <div class="resultado-titulo">${this.destacar(this.esc(item.titulo),termo)}</div>
          ${trecho&&trecho!==item.titulo?`<div class="resultado-trecho">${this.destacar(this.esc(trecho),termo)}</div>`:''}
        </div>`;
      });

      html+=`</div>`;
    });

    ctr.innerHTML=html;

    // Eventos nos itens
    ctr.querySelectorAll('.resultado-item').forEach(el=>{
      el.addEventListener('click',()=>{
        const arq  = el.dataset.arquivo;
        const tipo = el.dataset.tipo;
        const id   = el.dataset.id;
        const txt  = el.dataset.texto;
        const pos  = el.dataset.posicao;
        let scrollTo=null;
        if(tipo==='subtopico'&&id)   scrollTo={tipo:'id',   valor:id};
        else if(tipo==='conteudo'&&txt) scrollTo={tipo:'texto',valor:txt,posicao:pos};
        document.querySelectorAll('.topico-item').forEach(i=>{i.style.display='flex';i.classList.remove('ativo');});
        document.querySelector(`[data-arquivo="${arq}"]`)?.classList.add('ativo');
        gerenciador.carregarTopico(arq,scrollTo);
        ctr.style.display='none';
        document.getElementById('campo-busca').value='';
      });
    });

    // Cabeçalho do grupo abre o tópico diretamente
    ctr.querySelectorAll('[data-abrir="1"]').forEach(h=>{
      h.addEventListener('click',e=>{
        e.stopPropagation();
        const arq=h.dataset.arquivo;
        document.querySelectorAll('.topico-item').forEach(i=>{i.style.display='flex';i.classList.remove('ativo');});
        document.querySelector(`[data-arquivo="${arq}"]`)?.classList.add('ativo');
        gerenciador.carregarTopico(arq);
        ctr.style.display='none';
        document.getElementById('campo-busca').value='';
      });
    });
  }

  // Highlight: envolve apenas o texto, sem padding extra
  destacar(textoEsc, termo) {
    if (!textoEsc||!termo) return textoEsc||'';
    const re = new RegExp(`(${termo.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`, 'gi');
    return textoEsc.replace(re,'<mark>$1</mark>');
  }

  esc(s){ if(!s)return''; return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
  escAttr(s){ if(!s)return''; return s.replace(/"/g,'&quot;').replace(/\n/g,' ').substring(0,300); }

  rolarParaElemento(dados) {
    if (!dados) return;
    setTimeout(()=>{
      if (dados.tipo==='id') {
        const el=document.querySelector(`[data-subtopico="${dados.valor}"]`);
        if(el){el.click();setTimeout(()=>document.getElementById('conteudo-subtopico')?.scrollTo({top:0,behavior:'smooth'}),300);}
      } else if(dados.tipo==='texto'&&dados.valor) {
        const sel=dados.posicao?`#conteudo-dinamico ${dados.posicao}`:'#conteudo-dinamico *';
        const sub=dados.valor.substring(0,60);
        for(const el of document.querySelectorAll(sel)){
          if(el.textContent.includes(sub)){
            el.scrollIntoView({behavior:'smooth',block:'center'});
            this.destacarElemento(el);
            break;
          }
        }
      }
    },500);
  }

  destacarElemento(el){
    el.style.transition='background-color 1s';
    el.style.backgroundColor='#fef9c3';
    el.style.borderRadius='4px';
    setTimeout(()=>{el.style.backgroundColor='';el.style.borderRadius='';},3000);
  }
}

// ═══════════════════════════════════════════════════
// INIT
// ═══════════════════════════════════════════════════
let gerenciador;

document.addEventListener('DOMContentLoaded', ()=>{
  renderizarTopicos();
  gerenciador = new GerenciadorAnotacoes();

  document.getElementById('btn-fechar').addEventListener('click',()=>window.location.href='../index.html');
  document.getElementById('btn-ferias').addEventListener('click',()=>window.location.href='../rotinas.html');

  // Menu sidebar
  const sidebar = document.getElementById('menu-sidebar');
  document.getElementById('btn-menu').addEventListener('click',()=>sidebar.classList.add('ativo'));
  document.getElementById('btn-fechar-sidebar').addEventListener('click',()=>sidebar.classList.remove('ativo'));

  // Busca com debounce
  const input = document.getElementById('campo-busca');
  let timer;
  input.addEventListener('input',e=>{ clearTimeout(timer); timer=setTimeout(()=>gerenciador.buscarConteudo(e.target.value),350); });

  // Fecha resultados ao clicar fora
  document.addEventListener('click',e=>{
    const ctr=document.getElementById('resultados-busca');
    if(!e.target.closest('.search')&&!e.target.closest('.resultados-busca')&&ctr?.style.display!=='none'){
      ctr.style.display='none';
      document.querySelectorAll('.topico-item').forEach(i=>i.style.display='flex');
    }
  });

  // ESC
  document.addEventListener('keydown',e=>{
    if(e.key!=='Escape')return;
    const ctr=document.getElementById('resultados-busca');
    if(ctr?.style.display!=='none'){
      ctr.style.display='none';
      document.querySelectorAll('.topico-item').forEach(i=>i.style.display='flex');
      input.value='';
    }
    if(gerenciador?.modoSelecao) gerenciador.desativarModoSelecao();
    sidebar.classList.remove('ativo');
  });

  // Lightbox
  document.getElementById('lightbox-close').addEventListener('click',()=>gerenciador.fecharLightbox());
  document.getElementById('image-lightbox').addEventListener('click',e=>{ if(e.target===e.currentTarget) gerenciador.fecharLightbox(); });

  // Popup
  document.getElementById('popup-fechar').addEventListener('click',()=>gerenciador.fecharPopup());
  document.getElementById('popup-overlay').addEventListener('click',e=>{ if(e.target===e.currentTarget) gerenciador.fecharPopup(); });

  // Botões dinâmicos
  document.addEventListener('click',e=>{
    if(e.target.closest('#btn-fechar-topico'))   gerenciador.fecharTopico();
    if(e.target.closest('#btn-pdf-topico'))      gerenciador.subtopicoAtual!=null?gerenciador.salvarSubtopicoAtual('pdf')     :gerenciador.salvarTopicoCompleto('pdf');
    if(e.target.closest('#btn-imprimir-topico')) gerenciador.subtopicoAtual!=null?gerenciador.salvarSubtopicoAtual('imprimir'):gerenciador.salvarTopicoCompleto('imprimir');
  });
});
</script>
</body>
</html>
