<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lista Ordenada</title>

<!-- jsPDF + SheetJS via CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
  /* ===== base / tipografia ===== */
  :root {
    --azul: #007BFF;
    --azul-escuro: #0056b3;
    --amarelo: #FFD700;
    --vermelho: #b22222;
  }
  html,body { height:100%; }
  body {
    font-family: monospace;
    margin: 0;
    padding: 0;
    color: #111;
    background: #fff;
  }

  /* ===== header ===== */
  header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    background: var(--azul);
    color: white;
    padding: 10px 14px;
    gap: 12px;
    position: sticky;
    top: 0;
    z-index: 999;
  }
  .menu-left, .menu-right {
    display:flex;
    gap: 8px;
    align-items:center;
  }
  .icon-btn {
    background: none;
    border: none;
    color: white;
    font-size: 18px;
    cursor: pointer;
    padding: 6px 8px;
    border-radius: 6px;
  }
  .icon-btn:hover { background: rgba(255,255,255,0.08); }

  /* dropdowns */
  .menu-dropdown { position: relative; }
  .menu-dropdown-content {
    display: none;
    position: absolute;
    top: calc(100% + 6px);
    left: 0;
    background: white;
    color: #111;
    border-radius: 6px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.15);
    min-width: 220px;
    max-width: calc(100vw - 40px);
    overflow: auto;
    z-index: 1200;
    padding: 6px 0;
    white-space: normal;
  }
  .menu-right .menu-dropdown-content { right: 0; left: auto; }

  .menu-dropdown-content a {
    display:block;
    padding: 8px 12px;
    color: #111;
    text-decoration: none;
    font-family: monospace;
  }
  .menu-dropdown-content a:hover { background: #f2f2f2; }

  .dropdown-section { border-top: 1px solid #f0f0f0; padding-top: 6px; margin-top: 6px; }
  .section-header {
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:8px;
    padding: 8px 12px;
    cursor: pointer;
    font-weight:700;
  }
  .section-header small { font-weight:400; color:#666; }
  .submenu { display:none; padding-left: 6px; padding-bottom:6px; }
  .submenu a { padding-left: 18px; font-weight:500; }

  /* ===== título (sem setas) ===== */
  .titulo-nav {
    display:flex;
    justify-content:center;
    align-items:center;
    margin: 14px 10px 8px;
  }
  .titulo-nav h1 {
    margin:0;
    font-size:18px;
    color:#111;
    text-align:center;
  }

  /* ===== container duas colunas ===== */
  .container {
    display:flex;
    justify-content:center;
    gap: 48px;
    align-items:flex-start; /* garante topo alinhado */
    padding: 10px 14px 24px;
    flex-wrap:wrap;
  }
  .column {
    display:flex;
    flex-direction:column;
    gap:6px;
    min-width: 300px;
    max-width: 420px;
    width: 100%;
  }

  /* rótulos uniformes para evitar diferenças de altura entre colunas */
  .small {
    font-size:13px;
    color:#111; /* mudado para preto conforme solicitado */
    display:block;
    margin:0 0 6px 0;
  }

  /* ===== nova regra: quando dentro do header da coluna direita, mantenha inline ===== */
  .col-header { display:flex; align-items:center; justify-content:flex-start; gap:8px; }
  .col-header .small { display:inline-flex; align-items:center; gap:6px; margin:0; font-size:13px; color:#111; }
  .col-header .counter { font-weight:700; font-size:13px; margin-left:0; color:#111; font-family: monospace; display:inline-block; }

  /* rótulo das opções (antes inline) */
  .opt-label { font-size:13px; color:#111; }

  .item {
    display:flex;
    align-items:center;
    gap:10px;
    padding:6px 8px;
    border-radius:6px;
  }
  .item span { flex:1; color:#111; }
  .item input[type="text"] {
    width: 60px;
    padding:6px 6px;
    font-family: monospace;
    text-align:center;
    border:1px solid #ddd;
    border-radius:4px;
    background: white;
    transition: box-shadow .12s, border-color .12s;
  }
  .item input[readonly] { background: #fafafa; }

  .item input:focus {
    outline: none;
    border-color: var(--azul-escuro);
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.12);
  }

  /* ===== middle controls ===== */
  #middle-controls {
    display:flex;
    flex-direction:column;
    gap:10px;
    align-items:center;
    justify-content:center;
    min-width:170px;
  }
  #middle-controls button {
    width:170px;
    padding:10px 12px;
    font-size:14px;
    border-radius:6px;
    border:none;
    cursor:pointer;
  }
  /* primeiro botão azul exatamente como no seu código */
  #middle-controls button:first-child { background:var(--azul); color:white; }
  .btn-vermelho { background: var(--vermelho); color:white; }
  .btn-vermelho:hover { background:#8b1a1a; }

  /* retângulos (iguais e um pouco maiores) */
  textarea{
    flex:1;
    resize:none;
    min-height:460px;
    padding:14px;
    border-radius:8px;
    border:1px solid #e6e9ef;
    background:white;
    font-size:14px; /* padronizado para 14px */
    font-family: monospace;
    color:#111;
    line-height:1.4;
    margin:0; /* garante topo alinhado */
  }
  pre#output{
    flex:1;
    padding:14px;
    border-radius:8px;
    border:1px solid #e6e9ef;
    background:#fff;
    overflow:auto;
    white-space:pre-wrap;
    word-break:break-word;
    color:#111;
    min-height:460px;
    margin:0; /* zera a margem padrão do <pre> que deixava mais baixo */
    font-size:14px; /* padronizado para 14px */
    font-family: monospace;
    line-height:1.4;
  }

  /* contador dentro do cabeçalho da coluna direita */
  #contador-linhas { text-align:right; margin: 0; font-weight:700; font-size:13px; color:#111; }

  /* aviso / toast */
  #copy-notice {
    position: fixed;
    right: 18px;
    bottom: 18px;
    background: rgba(0,0,0,0.78);
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    display: none;
    z-index: 2000;
    font-family: monospace;
    font-size: 13px;
  }

  @media (max-width:900px) {
    .container { gap: 20px; padding:10px; }
    #middle-controls { order: 2; }
  }
  @media (max-width:520px) {
    .container { flex-direction:column; align-items:center; }
    .column { max-width: 100%; min-width: auto; width: 100%; }
    #middle-controls { flex-direction:row; gap: 8px; }
    #middle-controls button { width: 120px; }
  }

  /* ---------- PRINT (mantido) ---------- */
  @media print {
    header, .menu-dropdown-content, #middle-controls, #copy-notice, #contador-linhas { display: none !important; }
    html, body { height: auto !important; min-height: auto !important; font-family: monospace; }
    @page { size: A4 portrait; margin: 8mm; }
    .container { display: block !important; gap: 8px !important; padding: 0 !important; }
    .container:after { content: ''; display: block; clear: both; }
    .column { box-shadow: none; border: none; min-width: auto; max-width: 48%; width: 48%; float: left !important; box-sizing: border-box; }
    .item { gap: 6px !important; padding: 2px 4px !important; page-break-inside: avoid; break-inside: avoid; }
    .item span { font-size: 11px; line-height: 1.12; }
    .item input[type="text"] { width: 44px; padding: 2px 4px; font-size: 11px; text-align: center; }
    body.print-tight { font-size: 10px !important; }
  }
</style>
</head>
<body>

<header>
  <div class="menu-left">
    <div class="menu-dropdown">
      <button class="icon-btn" id="btn-hamburger" title="Menu" onclick="toggleMenu('dropdown-menu')">☰</button>

      <div class="menu-dropdown-content" id="dropdown-menu" role="menu" aria-hidden="true">
        <div class="dropdown-section">
          <div class="section-header" tabindex="0" onclick="toggleSubmenu(this)" onkeydown="if(event.key==='Enter') toggleSubmenu(this)">
            <span>MACS</span>
            <small class="chev">▸</small>
          </div>
          <div class="submenu">
            <a href="#" data-mac="77" onclick="abrirMac(event, 'MAC Bairro São Geraldo - Cód. 77')">MAC Bairro São Geraldo - Cód. 77</a>
            <a href="#" data-mac="78" onclick="abrirMac(event, 'MAC Bairro Planalto - Cód. 78')">MAC Bairro Planalto - Cód. 78</a>
            <a href="#" data-mac="79" onclick="abrirMac(event, 'MAC Romeu Duarte - Cód. 79')">MAC Romeu Duarte - Cód. 79</a>
            <a href="#" data-mac="80" onclick="abrirMac(event, 'MAC Rua São Geraldo / Centro 2 - Cód. 80')">MAC Rua São Geraldo / Centro 2 - Cód. 80</a>
            <a href="#" data-mac="277" onclick="abrirMac(event, 'MAC Matriz - Cód. 277')">MAC Matriz - Cód. 277</a>
            <a href="#" data-mac="853" onclick="abrirMac(event, 'MAC Concesso - Cód. 853')">MAC Concesso - Cód. 853</a>
            <a href="#" data-mac="1249" onclick="abrirMac(event, 'MAC Jardim do Lago - Cód. 1249')">MAC Jardim do Lago - Cód. 1249</a>
            <a href="#" data-mac="989" onclick="abrirMac(event, 'MAC Araújos - Cód. 989')">MAC Araújos - Cód. 989</a>
          </div>
        </div>

        <div class="dropdown-section">
          <div class="section-header" tabindex="0" onclick="toggleSubmenu(this)" onkeydown="if(event.key==='Enter') toggleSubmenu(this)">
            <span>São José</span>
            <small class="chev">▸</small>
          </div>
          <div class="submenu">
            <a href="#" onclick="abrirLocal(event, 'São José')">São José</a>
            <a href="#" onclick="abrirLocal(event, 'Pão Total')">Pão Total</a>
          </div>
        </div>
      </div>
    </div>

    <!-- X (fechar) — sem confirm -->
    <button class="icon-btn" id="btn-close" title="Fechar" onclick="fecharPagina()">❌</button>

    <!-- Home — placeholder sem alert -->
    <button class="icon-btn" id="btn-home" title="Menu inicial" onclick="voltarMenu()">🏠</button>
  </div>

  <div class="menu-right">
    <div class="menu-dropdown">
      <button class="icon-btn" id="btn-salvar" title="Salvar" onclick="toggleMenu('dropdown-save')">💾</button>
      <div class="menu-dropdown-content" id="dropdown-save" aria-labelledby="btn-salvar">
        <a href="#" onclick="salvarComoTXT(event)" title="Salvar como TXT">Salvar como TXT</a>
        <a href="#" onclick="salvarComoPDF(event)" title="Salvar como PDF">Salvar como PDF</a>
        <a href="#" onclick="salvarComoExcel(event)" title="Salvar como Excel">Salvar como Excel</a>
      </div>
    </div>

    <!-- botão imprimir: listener adicionado via JS mais abaixo -->
    <button class="icon-btn" id="btn-print" title="Imprimir">🖨️</button>

    <button class="icon-btn" id="btn-copy" title="Copiar" onclick="copiarDireita()">📋</button>
  </div>
</header>

<div class="titulo-nav" aria-label="Título">
  <h1 id="titulo-principal">Lista Ordenada</h1>
</div>

<div class="container">
  <div class="column">
    <label class="small">Entrada (cole seu texto)</label>
    <textarea id="input" placeholder="Ex: 12 pacote de arroz&#10;kibe com queijo&#10;PCTS feijão" spellcheck="false"></textarea>

    <!-- opções -->
    <div style="margin-top:10px;display:flex;gap:12px;flex-wrap:wrap;">
      <label class="opt-label"><input type="checkbox" id="optRemove" checked> Remover palavras (pct, pcts, pacote(s), pct de)</label>
      <label class="opt-label"><input type="checkbox" id="optMoveNum" checked> Mover número do início para o fim</label>
      <label class="opt-label"><input type="checkbox" id="optReplace" checked> Substituir "kibe" → "quibe"</label>
    </div>
  </div>

  <div id="middle-controls" aria-hidden="false">
    <button id="btn-transfer" onclick="transferir()">→</button>
    <button onclick="resetarTudo()" class="btn-vermelho">Resetar Tudo</button>
  </div>

  <div class="column">
    <div class="col-header">
      <label class="small">Resultado</label>
      <span id="contador-inline" aria-live="polite" class="counter">(Linhas preenchidas: 0)</span>
    </div>
    <pre id="output" aria-live="polite"></pre>
  </div>
</div>

<!-- aviso discreto -->
<div id="copy-notice">Copiado!</div>

<script>
/* ============================
   Regras e utilitários
   ============================ */
const bannedWords = ['pct','pcts','pacote','pacotes','pacote de','pacotes de','pct de'];
const replacements = { 'kibe': 'quibe' };

function escapeRegExp(s){ return s.replace(/[.*+?^${}()|[\\]\\]/g, '\\$&'); }

function removeBannedWords(line){
  let text = line;
  for(const w of bannedWords){
    const pattern = new RegExp('\\b' + escapeRegExp(w) + '\\b', 'gi');
    text = text.replace(pattern, '');
  }
  return text.replace(/\s{2,}/g, ' ').trim();
}
function applyReplacements(line){
  let text = line;
  for(const k in replacements){
    const pattern = new RegExp('\\b' + escapeRegExp(k) + '\\b', 'gi');
    text = text.replace(pattern, (match)=>{
      const repl = replacements[k];
      if(match[0] === match[0].toUpperCase()) return repl[0].toUpperCase() + repl.slice(1);
      return repl;
    });
  }
  return text;
}
function moveLeadingNumberToEnd(line){
  const m = line.match(/^\s*([0-9]+(?:[.\-/][0-9]+)*)(?:\s+)(.*)$/);
  if(m){ return (m[2] + ' ' + m[1]).trim(); }
  return line;
}

/* ============================
   Processamento + transferência
   ============================ */
function transferir(){
  const optRemove = document.getElementById('optRemove').checked;
  const optMoveNum = document.getElementById('optMoveNum').checked;
  const optReplace = document.getElementById('optReplace').checked;

  const raw = document.getElementById('input').value || '';
  const lines = raw.split(/\r?\n/);

  const processed = lines.map((ln)=>{
    let line = ln.trim();
    if(optReplace) line = applyReplacements(line);
    if(optRemove) line = removeBannedWords(line);
    if(optMoveNum) line = moveLeadingNumberToEnd(line);
    line = line.replace(/\s{2,}/g, ' ').trim();
    return line;
  }).filter(l => l.length>0); // sempre remove vazios

  processed.sort((a,b)=> a.localeCompare(b, 'pt', {sensitivity:'base'}));

  document.getElementById('output').textContent = processed.join('\n');
  atualizarContagemDireita();
}

/* ============================
   Contagem e utilitários
   ============================ */
function atualizarContagemDireita(){
  const out = document.getElementById('output').textContent || '';
  const preenchidos = out.split(/\r?\n/).filter(l=>l.trim()!=='').length;
  const contadorEl = document.getElementById('contador-inline');
  if(contadorEl){
    contadorEl.textContent = `(Linhas preenchidas: ${preenchidos})`;
  } else {
    const contadorOld = document.getElementById('contador-linhas');
    if(contadorOld) contadorOld.innerText = `Linhas preenchidas: ${preenchidos}`;
  }
}

function copiarDireita(){
  const texto = document.getElementById('output').textContent || '';
  if(!texto.trim()){ showBottomNotice('Nada para copiar',2000); return; }
  navigator.clipboard.writeText(texto).then(()=> showBottomNotice('Copiado!',2000)).catch(()=>{
    const ta = document.createElement('textarea'); ta.value = texto; ta.style.position='fixed'; ta.style.left='-9999px'; document.body.appendChild(ta); ta.select();
    try{ document.execCommand('copy'); showBottomNotice('Copiado!',2000); }catch(e){ showBottomNotice('Falha ao copiar',2000); }
    ta.remove();
  });
}

function resetarTudo(){
  document.getElementById('input').value = '';
  document.getElementById('output').textContent = '';
  atualizarContagemDireita();
}

/* ============================
   Salvar (TXT / PDF / Excel)
   ============================ */
function baixarArquivo(conteudo, nomeArquivo, tipo){
  const blob = new Blob([conteudo], {type});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = nomeArquivo; document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=>{ try{ URL.revokeObjectURL(a.href); }catch(e){} }, 60000);
}

function salvarComoTXT(e){
  if(e) e.preventDefault();
  const texto = document.getElementById('output').textContent || '';
  if(!texto.trim()){ showBottomNotice('Nenhum item preenchido para salvar',2000); return; }
  baixarArquivo(texto, 'lista-ordenada.txt', 'text/plain');
  showBottomNotice('Arquivo TXT salvo',2000);
}

function salvarComoPDF(e){
  if(e) e.preventDefault();
  const texto = document.getElementById('output').textContent || '';
  if(!texto.trim()){ showBottomNotice('Nenhum item preenchido para salvar em PDF',2000); return; }
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit:'pt', format:'a4' });
  doc.setFont('courier','normal'); doc.setFontSize(11);
  const marginLeft = 40; const maxWidth = doc.internal.pageSize.getWidth() - marginLeft*2; let y = 40;
  doc.text(document.getElementById('titulo-principal').textContent || '', marginLeft, y); y+=18;
  const linhas = texto.split(/\r?\n/);
  linhas.forEach(l=>{
    doc.text(l, marginLeft, y, { maxWidth }); y+=14;
    if(y>doc.internal.pageSize.getHeight()-60){ doc.addPage(); doc.setFont('courier','normal'); y=40; }
  });
  y+=8; doc.text(`Linhas preenchidas: ${linhas.filter(x=>x.trim()!=='').length}`, marginLeft, y);
  doc.save('lista-ordenada.pdf');
  showBottomNotice('PDF salvo',2000);
}

function salvarComoExcel(e){
  if(e) e.preventDefault();
  const texto = document.getElementById('output').textContent || '';
  const linhas = texto.split(/\r?\n/).filter(l=>l.trim()!=='');
  if(linhas.length===0){ showBottomNotice('Nenhum item preenchido para exportar Excel',2000); return; }
  const data = [['Item']]; linhas.forEach(l=> data.push([l]));
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.aoa_to_sheet(data);
  XLSX.utils.book_append_sheet(wb, ws, 'Lista');
  XLSX.writeFile(wb, 'lista-ordenada.xlsx');
  showBottomNotice('Excel salvo',2000);
}

/* ============================
   Impressão
   ============================ */
function prepareAndPrintSinglePage(){
  const esquer = document.getElementById('input'); const direi = document.getElementById('output'); if(!esquer || !direi || !direi.textContent.trim()){ showBottomNotice('Nada para imprimir',2000); return; }
  const totalRows = direi.textContent.split(/\r?\n/).length; document.body.classList.remove('print-tight'); if(totalRows>34) document.body.classList.add('print-tight');
  const cleanup = ()=>{ document.body.classList.remove('print-tight'); try{ window.removeEventListener('afterprint', cleanup); }catch(e){} };
  try{ window.addEventListener('afterprint', cleanup); window.print(); } catch(e){ showBottomNotice('Falha ao abrir impressão',2000); setTimeout(cleanup,1000); }
}

/* ============================
   Toast
   ============================ */
function showBottomNotice(message='Copiado!', duration=2000){ const el = document.getElementById('copy-notice'); if(!el) return; if(el._hideTimeout){ clearTimeout(el._hideTimeout); el._hideTimeout=null; } el.textContent=message; el.style.display='block'; el._hideTimeout = setTimeout(()=>{ el.style.display='none'; el._hideTimeout=null; }, duration); }

/* ============================
   Dropdowns / menus
   ============================ */
function toggleMenu(id){ document.querySelectorAll('.menu-dropdown-content').forEach(el=>{ if(el.id!==id){ el.style.display='none'; el.style.opacity=0; el.setAttribute('aria-hidden','true'); } }); const el = document.getElementById(id); if(!el) return; if(el.style.display==='block'){ el.style.opacity=0; setTimeout(()=>{ el.style.display='none'; el.setAttribute('aria-hidden','true'); },180); } else { el.style.display='block'; el.style.opacity=0; el.setAttribute('aria-hidden','false'); setTimeout(()=>el.style.opacity=1,10); } }
function toggleSubmenu(headerEl){ const submenu = headerEl.nextElementSibling; if(!submenu) return; const chev = headerEl.querySelector('.chev'); if(submenu.style.display==='block'){ submenu.style.display='none'; if(chev) chev.textContent='▸'; } else { submenu.style.display='block'; if(chev) chev.textContent='▾'; } }

document.addEventListener('click', (ev)=>{ if(!ev.target.closest('.menu-dropdown')){ document.querySelectorAll('.menu-dropdown-content').forEach(el=>{ el.style.display='none'; el.style.opacity=0; el.setAttribute('aria-hidden','true'); }); } });

/* ============================
   Placeholders / ações dos ícones esquerdo
   ============================ */
function fecharPagina(){ try{ window.close(); }catch(e){} }
function voltarMenu(){ /* placeholder */ }
function navegarAnterior(){ /* placeholder */ }
function navegarProximo(){ /* placeholder */ }
function abrirMac(e, nome){ if(e) e.preventDefault(); document.getElementById('titulo-principal').textContent = nome; toggleMenu('dropdown-menu'); }
function abrirLocal(e, nome){ if(e) e.preventDefault(); toggleMenu('dropdown-menu'); }

/* ============================
   Inicialização
   ============================ */
// liga eventos
const transferBtn = document.querySelector('#middle-controls #btn-transfer'); if(transferBtn) transferBtn.addEventListener('click', () => { transferir(); });
const printBtn = document.getElementById('btn-print'); if(printBtn){ try{ printBtn.onclick = null; }catch(e){}; printBtn.addEventListener('click', (ev)=>{ ev.preventDefault(); if(printBtn.disabled) return; prepareAndPrintSinglePage(); }); }

// input UX
const inputEl = document.getElementById('input'); if(inputEl){
  inputEl.addEventListener('keydown',(e)=>{ if((e.ctrlKey||e.metaKey) && e.key==='Enter'){ e.preventDefault(); transferir(); } });
}

// atualiza contador no carregamento (se necessário)
document.addEventListener('DOMContentLoaded', atualizarContagemDireita);
</script>
</body>
</html>
