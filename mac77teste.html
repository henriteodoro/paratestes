<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MAC 77 - Organizador de Lista</title>

<link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700;800&family=DM+Sans:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
:root {
  --bg: #eef3fb;
  --surface: #ffffff;
  --surface2: #f4f8ff;
  --border: #dce8fb;
  --border2: #c8d9f5;
  --text-primary: #1a2740;
  --text-secondary: #4e6080;
  --text-muted: #8fa3bf;
  --accent: #1a56db;
  --accent-dark: #1040b0;
  --accent-light: #e8f0fe;
  --warn: #f59e0b;
  --success: #10b981;
  --danger: #dc2626;
  --purple: #7c3aed;
  --shadow-sm: 0 2px 8px rgba(20,60,120,0.07);
  --shadow-md: 0 6px 24px rgba(20,60,120,0.10);
  --shadow-lg: 0 14px 40px rgba(20,60,120,0.14);
  --radius-sm: 10px;
  --radius-md: 16px;
  --radius-lg: 22px;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html, body { height: 100%; }

body {
  font-family: 'DM Sans', system-ui, sans-serif;
  background: var(--bg);
  color: var(--text-primary);
  line-height: 1.55;
}

body::before {
  content: '';
  position: fixed; inset: 0;
  background-image: radial-gradient(circle, #c0d0eb 1px, transparent 1px);
  background-size: 28px 28px;
  opacity: 0.3;
  pointer-events: none;
  z-index: 0;
}

.sr-only {
  position: absolute; width: 1px; height: 1px; padding: 0;
  margin: -1px; overflow: hidden; clip: rect(0,0,0,0);
  white-space: nowrap; border: 0;
}

/* ── TOPBAR ─────────────────────────────────── */
.topbar {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
  padding: 0 20px;
  height: 62px;
  display: flex;
  align-items: center;
  gap: 14px;
  position: sticky;
  top: 0;
  z-index: 100;
}

.topbar-brand {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-shrink: 0;
}
.brand-icon {
  width: 38px; height: 38px;
  background: var(--accent);
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 4px 12px rgba(26,86,219,0.3);
  font-family: 'Sora', sans-serif;
  font-weight: 800;
  font-size: 0.75rem;
  color: white;
  letter-spacing: -0.5px;
  flex-shrink: 0;
}
.brand-name {
  font-family: 'Sora', sans-serif;
  font-weight: 700;
  font-size: 1rem;
  color: var(--accent);
  line-height: 1.1;
  white-space: nowrap;
}
.brand-sub {
  font-size: 0.7rem;
  color: var(--text-muted);
  font-weight: 500;
}

/* title nav in topbar */
.topbar-nav {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
  justify-content: center;
}
.topbar-nav h1 {
  font-family: 'Sora', sans-serif;
  font-weight: 700;
  font-size: 0.95rem;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 320px;
}
.nav-arrow-btn {
  display: flex; align-items: center; justify-content: center;
  width: 32px; height: 32px;
  border-radius: 8px;
  border: 1.5px solid var(--border2);
  background: white;
  color: var(--text-secondary);
  cursor: pointer;
  text-decoration: none;
  flex-shrink: 0;
  transition: all 0.18s;
  font-size: 14px;
}
.nav-arrow-btn:hover {
  background: var(--accent-light);
  border-color: var(--accent);
  color: var(--accent);
}

.topbar-actions {
  display: flex;
  gap: 4px;
  align-items: center;
  flex-shrink: 0;
}

/* Icon buttons in topbar */
.icon-btn {
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 7px 8px;
  border-radius: 8px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: all 0.18s;
  position: relative;
}
.icon-btn svg { width: 20px; height: 20px; display: block; }
.icon-btn:hover {
  background: var(--accent-light);
  color: var(--accent);
}
.icon-btn.active {
  background: var(--accent-light);
  color: var(--accent);
}

/* Divider in topbar */
.topbar-divider {
  width: 1px; height: 28px;
  background: var(--border);
  flex-shrink: 0;
}

/* ── DROPDOWNS ──────────────────────────────── */
.menu-dropdown { position: relative; }
.menu-dropdown-content {
  display: none;
  position: absolute;
  top: calc(100% + 8px);
  left: 0;
  background: var(--surface);
  border: 1.5px solid var(--border2);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  min-width: 260px;
  max-width: calc(100vw - 32px);
  overflow: auto;
  z-index: 1200;
  padding: 6px;
}
.menu-right .menu-dropdown-content { right: 0; left: auto; }

.menu-dropdown-content a {
  display: flex;
  align-items: center;
  padding: 9px 11px;
  color: var(--text-primary);
  text-decoration: none;
  font-family: 'DM Sans', sans-serif;
  font-size: 0.87rem;
  border-radius: 8px;
  transition: all 0.15s;
  gap: 8px;
}
.menu-dropdown-content a:hover {
  background: var(--accent-light);
  color: var(--accent);
}

.dropdown-section {
  border-top: 1px solid var(--border);
  margin-top: 4px;
  padding-top: 4px;
}
.dropdown-section:first-child { border-top: none; margin-top: 0; padding-top: 0; }

.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  padding: 8px 11px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.8rem;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--text-muted);
  border-radius: 8px;
  transition: all 0.15s;
}
.section-header:hover {
  background: var(--surface2);
  color: var(--text-secondary);
}

.mac-code {
  display: inline-flex; align-items: center; justify-content: center;
  background: var(--accent);
  color: white;
  padding: 3px 7px;
  border-radius: 6px;
  font-size: 0.75rem;
  font-weight: 700;
  min-width: 30px;
  flex-shrink: 0;
}

.submenu { display: none; padding-left: 4px; }
.submenu a { padding-left: 14px; }

/* ── MAIN LAYOUT ────────────────────────────── */
.page-wrapper {
  position: relative;
  z-index: 1;
  padding: 20px 20px 40px;
  max-width: 1280px;
  margin: 0 auto;
}

/* ── STAT BAR ───────────────────────────────── */
.stat-bar {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 18px;
  flex-wrap: wrap;
}
.stat-chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 14px;
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: 99px;
  font-size: 0.82rem;
  font-weight: 600;
  color: var(--text-secondary);
  box-shadow: var(--shadow-sm);
}
.stat-chip svg { width: 14px; height: 14px; color: var(--accent); }
.stat-chip .val { color: var(--accent); font-family: 'Sora', sans-serif; }

/* ── CONTENT GRID ───────────────────────────── */
.content-grid {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  gap: 16px;
  align-items: start;
}

/* ── COLUMN PANELS ──────────────────────────── */
.col-panel {
  background: var(--surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
}

.col-header {
  padding: 14px 18px;
  background: var(--surface2);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 10px;
}
.col-header-icon {
  width: 30px; height: 30px;
  border-radius: 8px;
  background: var(--accent);
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
  box-shadow: 0 2px 8px rgba(26,86,219,0.25);
}
.col-header-icon svg { width: 15px; height: 15px; color: white; }
.col-header-title {
  font-family: 'Sora', sans-serif;
  font-weight: 700;
  font-size: 0.9rem;
  color: var(--text-primary);
  flex: 1;
}
.col-header-count {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--text-muted);
  background: #e5e7eb;
  padding: 2px 8px;
  border-radius: 99px;
}

.col-body { padding: 10px; }

/* ── ITEMS ──────────────────────────────────── */
.item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  border-radius: 8px;
  transition: background 0.15s;
  border: 1px solid transparent;
}
.item:hover { background: var(--surface2); }

.item span {
  flex: 1;
  font-size: 0.85rem;
  color: var(--text-primary);
  line-height: 1.3;
}

.item input[type="text"] {
  width: 58px;
  padding: 5px 7px;
  font-family: 'DM Sans', monospace;
  font-size: 0.85rem;
  text-align: center;
  border: 1.5px solid var(--border2);
  border-radius: 7px;
  background: white;
  color: var(--text-primary);
  transition: border-color 0.15s, box-shadow 0.15s;
  flex-shrink: 0;
}
.item input[type="text"]:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(26,86,219,0.12);
}
.item input[readonly] {
  background: var(--surface2);
  border-color: var(--border);
  color: var(--text-secondary);
  cursor: default;
}
.item input[readonly]:focus {
  border-color: var(--border2);
  box-shadow: none;
}

.item.novo-item {
  background: #f0fdf4;
  border-color: #86efac;
}
.item.novo-item:hover { background: #dcfce7; }

.remove-btn {
  background: none; border: none; cursor: pointer;
  color: var(--text-muted); font-size: 14px; font-weight: 700;
  width: 22px; height: 22px;
  border-radius: 6px;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
  transition: all 0.15s;
  line-height: 1;
}
.remove-btn:hover { background: #fee2e2; color: var(--danger); }

/* ── MIDDLE CONTROLS ────────────────────────── */
.middle-controls {
  display: flex;
  flex-direction: column;
  gap: 8px;
  align-items: center;
  padding-top: 60px;
}

.ctrl-btn {
  width: 158px;
  padding: 10px 14px;
  font-size: 0.85rem;
  font-family: 'DM Sans', sans-serif;
  font-weight: 600;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  transition: all 0.18s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 7px;
  box-shadow: var(--shadow-sm);
}
.ctrl-btn svg { width: 15px; height: 15px; flex-shrink: 0; }
.ctrl-btn:hover { transform: translateY(-1px); box-shadow: var(--shadow-md); }
.ctrl-btn:active { transform: translateY(0); }

.ctrl-btn.purple { background: var(--purple); color: white; }
.ctrl-btn.purple:hover { background: #6d28d9; }

.ctrl-btn.blue { background: var(--accent); color: white; }
.ctrl-btn.blue:hover { background: var(--accent-dark); }

.ctrl-btn.amber { background: #f59e0b; color: white; }
.ctrl-btn.amber:hover { background: #d97706; }

.ctrl-btn.red { background: var(--danger); color: white; }
.ctrl-btn.red:hover { background: #b91c1c; }

/* ── SAVE DROPDOWN ──────────────────────────── */
.save-dropdown {
  display: none;
  position: absolute;
  top: calc(100% + 6px);
  right: 0;
  background: var(--surface);
  border: 1.5px solid var(--border2);
  border-radius: var(--radius-sm);
  box-shadow: var(--shadow-lg);
  min-width: 200px;
  z-index: 1200;
  padding: 6px;
}
.save-dropdown a {
  display: flex; align-items: center; gap: 8px;
  padding: 9px 12px;
  border-radius: 8px;
  color: var(--text-primary);
  text-decoration: none;
  font-size: 0.87rem;
  transition: background 0.15s;
}
.save-dropdown a svg { width: 16px; height: 16px; color: var(--text-muted); flex-shrink: 0; }
.save-dropdown a:hover { background: var(--accent-light); color: var(--accent); }
.save-dropdown a:hover svg { color: var(--accent); }

/* ── TOAST ──────────────────────────────────── */
#copy-notice {
  position: fixed;
  right: 20px; bottom: 20px;
  background: var(--text-primary);
  color: white;
  padding: 10px 16px;
  border-radius: 10px;
  display: none;
  z-index: 3000;
  font-family: 'DM Sans', sans-serif;
  font-size: 0.85rem;
  font-weight: 500;
  box-shadow: var(--shadow-lg);
  animation: slideIn 0.2s ease;
}
@keyframes slideIn {
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* ── MODAL ──────────────────────────────────── */
.modal-overlay {
  display: none;
  position: fixed; inset: 0;
  background: rgba(15, 30, 60, 0.45);
  backdrop-filter: blur(4px);
  z-index: 3000;
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: var(--surface);
  border: 1.5px solid var(--border2);
  border-radius: var(--radius-lg);
  padding: 28px;
  width: 90%;
  max-width: 480px;
  box-shadow: var(--shadow-lg);
  animation: modalIn 0.22s ease;
}
@keyframes modalIn {
  from { opacity: 0; transform: scale(0.96) translateY(8px); }
  to   { opacity: 1; transform: scale(1) translateY(0); }
}
.modal-header {
  display: flex; align-items: center; gap: 12px;
  margin-bottom: 22px;
}
.modal-icon {
  width: 40px; height: 40px;
  background: var(--purple);
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 4px 12px rgba(124,58,237,0.3);
}
.modal-icon svg { width: 20px; height: 20px; color: white; }
.modal-header h2 {
  font-family: 'Sora', sans-serif;
  font-size: 1.05rem;
  font-weight: 700;
  color: var(--text-primary);
}
.modal-input-group { margin-bottom: 16px; }
.modal-input-group label {
  display: block;
  margin-bottom: 6px;
  font-size: 0.82rem;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.04em;
}
.modal-input-group input {
  width: 100%;
  padding: 10px 14px;
  border: 1.5px solid var(--border2);
  border-radius: 10px;
  font-family: 'DM Sans', sans-serif;
  font-size: 0.92rem;
  color: var(--text-primary);
  background: var(--surface2);
  transition: border-color 0.15s, box-shadow 0.15s;
  outline: none;
}
.modal-input-group input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(26,86,219,0.12);
  background: white;
}
.modal-footer {
  display: flex; justify-content: flex-end; gap: 10px; margin-top: 22px;
}
.btn-modal {
  padding: 9px 18px;
  border-radius: 9px;
  border: none;
  font-family: 'DM Sans', sans-serif;
  font-size: 0.88rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.18s;
}
.btn-modal.confirm { background: var(--success); color: white; }
.btn-modal.confirm:hover { background: #059669; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(16,185,129,0.35); }
.btn-modal.cancel { background: var(--surface2); color: var(--text-secondary); border: 1.5px solid var(--border2); }
.btn-modal.cancel:hover { background: #f1f5f9; }

/* ── PRINT ──────────────────────────────────── */
@media print {
  .topbar, .stat-bar, .middle-controls, #copy-notice, .modal-overlay,
  .remove-btn, .col-header-icon, body::before { display: none !important; }
  body { background: white; font-family: 'DM Sans', sans-serif; }
  @page { size: A4 portrait; margin: 8mm; }
  .page-wrapper { padding: 0 !important; max-width: 100% !important; }
  .content-grid {
    display: block !important;
  }
  .content-grid:after { content: ''; display: block; clear: both; }
  .col-panel {
    float: left !important;
    width: 49% !important;
    max-width: 49% !important;
    box-shadow: none !important;
    border: 1px solid #ccc !important;
    border-radius: 6px !important;
    margin-bottom: 4px !important;
  }
  .col-header { padding: 6px 10px !important; }
  .col-body { padding: 4px !important; }
  .item { padding: 2px 4px !important; }
  .item span { font-size: 9.5px !important; line-height: 1.2 !important; }
  .item input[type="text"] { width: 38px !important; font-size: 9.5px !important; padding: 1px 3px !important; }
}

/* ── RESPONSIVE ─────────────────────────────── */
@media (max-width: 900px) {
  .content-grid { grid-template-columns: 1fr; }
  .middle-controls { flex-direction: row; flex-wrap: wrap; justify-content: center; padding-top: 0; }
  .ctrl-btn { width: 148px; }
  .topbar-nav h1 { max-width: 180px; font-size: 0.82rem; }
  .brand-name, .brand-sub { display: none; }
}
@media (max-width: 600px) {
  .page-wrapper { padding: 14px 12px 32px; }
  .topbar { padding: 0 12px; }
  .topbar-nav { display: none; }
}
</style>
</head>
<body>

<!-- TOPBAR -->
<header class="topbar">
  <div style="display:flex;align-items:center;gap:10px;flex-shrink:0;">

    <!-- Hamburger menu -->
    <div class="menu-dropdown">
      <button class="icon-btn" id="btn-hamburger" title="Menu" onclick="toggleMenu('dropdown-menu')" aria-haspopup="true" aria-controls="dropdown-menu" aria-expanded="false">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/>
        </svg>
        <span class="sr-only">Menu</span>
      </button>
      <div class="menu-dropdown-content" id="dropdown-menu" role="menu" aria-hidden="true">
        <div class="dropdown-section">
          <div class="section-header" tabindex="0" onclick="toggleSubmenu(this)" onkeydown="if(event.key==='Enter')toggleSubmenu(this)">
            <span>MACS</span><small class="chev">▸</small>
          </div>
          <div class="submenu">
            <a href="mac77.html"  onclick="abrirMac(event,'MAC Bairro São Geraldo')"><span class="mac-code">77</span>MAC Bairro São Geraldo</a>
            <a href="mac78.html"  onclick="abrirMac(event,'MAC Bairro Planalto')"><span class="mac-code">78</span>MAC Bairro Planalto</a>
            <a href="mac79.html"  onclick="abrirMac(event,'MAC Romeu Duarte')"><span class="mac-code">79</span>MAC Romeu Duarte</a>
            <a href="mac80.html"  onclick="abrirMac(event,'MAC Rua São Geraldo / Centro 2')"><span class="mac-code">80</span>MAC Rua São Geraldo / Centro 2</a>
            <a href="mac277.html" onclick="abrirMac(event,'MAC Matriz')"><span class="mac-code">277</span>MAC Matriz</a>
            <a href="mac853.html" onclick="abrirMac(event,'MAC Concesso')"><span class="mac-code">853</span>MAC Concesso</a>
            <a href="mac1249.html" onclick="abrirMac(event,'MAC Jardim do Lago')"><span class="mac-code">1249</span>MAC Jardim do Lago</a>
            <a href="mac989.html" onclick="abrirMac(event,'MAC Araújos')"><span class="mac-code">989</span>MAC Araújos</a>
          </div>
        </div>
        <div class="dropdown-section">
          <div class="section-header" tabindex="0" onclick="toggleSubmenu(this)" onkeydown="if(event.key==='Enter')toggleSubmenu(this)">
            <span>São José</span><small class="chev">▸</small>
          </div>
          <div class="submenu">
            <a href="saojose.html" onclick="abrirLocal(event,'Pedido São José')">Pedido São José</a>
            <a href="paototal.html" onclick="abrirLocal(event,'Pedido Pão Total')">Pedido Pão Total</a>
          </div>
        </div>
        <div class="dropdown-section">
          <div class="section-header" tabindex="0" onclick="toggleSubmenu(this)" onkeydown="if(event.key==='Enter')toggleSubmenu(this)">
            <span>Tabelas</span><small class="chev">▸</small>
          </div>
          <div class="submenu">
            <a href="pdfs/Tabela 2025 Geral.pdf" onclick="abrirLocal(event,'Tabela de Preços Geral')">Tabela de Preços Geral</a>
            <a href="pdfs/Tabela 2025 Empresa.pdf" onclick="abrirLocal(event,'Tabela de Preços Empresa')">Tabela de Preços Empresa</a>
            <a href="https://github.com/henriteodoro/paratestes/releases/download/v1.0/Catalogo.Sao.Jose.2025.AT03.pdf" onclick="abrirLocal(event,'Catálogo de Produtos')">Catálogo de Produtos</a>
          </div>
        </div>
        <div class="dropdown-section">
          <div class="section-header" tabindex="0" onclick="toggleSubmenu(this)" onkeydown="if(event.key==='Enter')toggleSubmenu(this)">
            <span>Ferramentas</span><small class="chev">▸</small>
          </div>
          <div class="submenu">
            <a href="processadordepedidos.html" onclick="abrirLocal(event,'Processador de Pedidos')">Processador de Pedidos</a>
            <a href="ods.html" onclick="abrirLocal(event,'Visualizar Planilhas')">Visualizar Planilhas</a>
            <a href="simularpedido.html" onclick="abrirLocal(event,'Simulador de Pedido')">Simulador de Pedido</a>
            <a href="anotacoes/anotacoes.html" onclick="abrirLocal(event,'Anotações')">Anotações</a>
            <a href="planilhaautocontrole.html" onclick="abrirLocal(event,'Planilhas de Autocontrole')">Planilhas de Autocontrole</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Close -->
    <button class="icon-btn" title="Fechar" onclick="fecharPagina()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
      <span class="sr-only">Fechar</span>
    </button>

    <!-- Home -->
    <button class="icon-btn" title="Início" onclick="voltarMenu()">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M21.4498 10.275L11.9998 3.1875L2.5498 10.275L2.9998 11.625H3.7498V20.25H20.2498V11.625H20.9998L21.4498 10.275ZM5.2498 18.75V10.125L11.9998 5.0625L18.7498 10.125V18.75H14.9999V14.3333L14.2499 13.5833H9.74988L8.99988 14.3333V18.75H5.2498ZM10.4999 18.75H13.4999V15.0833H10.4999V18.75Z"/>
      </svg>
      <span class="sr-only">Início</span>
    </button>
  </div>

  <!-- Brand -->
  <div class="topbar-brand">
    <div class="brand-icon">77</div>
    <div>
      <div class="brand-name">MAC Bairro São Geraldo</div>
      <div class="brand-sub">Organizador de Lista · Cód. 77</div>
    </div>
  </div>

  <!-- Title Nav -->
  <div class="topbar-nav" role="navigation" aria-label="Navegação MAC">
    <a href="mac78.html" class="nav-arrow-btn" id="arrow-right" title="Próximo MAC" onclick="abrirMac(event,'MAC Bairro Planalto')">→</a>
    <h1 id="titulo-principal">MAC Bairro São Geraldo — Cód. 77</h1>
    <a href="mac78.html" class="nav-arrow-btn" title="Próximo MAC" onclick="abrirMac(event,'MAC Bairro Planalto')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="9 18 15 12 9 6"/></svg>
    </a>
  </div>

  <!-- Actions right -->
  <div class="topbar-actions">
    <div class="topbar-divider"></div>

    <!-- Save dropdown -->
    <div class="menu-dropdown menu-right" style="position:relative;">
      <button class="icon-btn" title="Salvar" onclick="toggleMenu('dropdown-save')" aria-haspopup="true" aria-controls="dropdown-save">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7z"/>
          <path d="M17 3v4H7V3"/><rect x="7" y="13" width="10" height="8" rx="1"/>
        </svg>
        <span class="sr-only">Salvar</span>
      </button>
      <div class="save-dropdown menu-dropdown-content" id="dropdown-save">
        <a href="#" onclick="salvarComoTXT(event)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
          Salvar como TXT
        </a>
        <a href="#" onclick="salvarComoPDF(event)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
          Salvar como PDF
        </a>
        <a href="#" onclick="salvarComoExcel(event)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/><line x1="2" y1="20" x2="22" y2="20"/></svg>
          Salvar como Excel
        </a>
      </div>
    </div>

    <!-- Print -->
    <button class="icon-btn" id="btn-print" title="Imprimir">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M7 18H6.2C5.08 18 4.52 18 4.09 17.78 3.72 17.59 3.41 17.28 3.22 16.91 3 16.48 3 15.92 3 14.8V10.2C3 9.08 3 8.52 3.22 8.09 3.41 7.72 3.72 7.41 4.09 7.22 4.52 7 5.08 7 6.2 7H7M17 18h.8c1.12 0 1.68 0 2.11-.22.38-.19.69-.5.87-.87C21 16.48 21 15.92 21 14.8V10.2c0-1.12 0-1.68-.22-2.11a2 2 0 0 0-.87-.87C19.48 7 18.92 7 17.8 7H17M7 11h.01M17 7V5.4V4.6C17 4.04 17 3.76 16.89 3.55 16.8 3.36 16.64 3.2 16.45 3.11 16.24 3 15.96 3 15.4 3H8.6C8.04 3 7.76 3 7.55 3.11 7.36 3.2 7.2 3.36 7.11 3.55 7 3.76 7 4.04 7 4.6V5.4V7M17 7H7M8.6 21h6.8c.56 0 .84 0 1.05-.11.19-.1.34-.25.44-.45C17 20.24 17 19.96 17 19.4v-2.8c0-.56 0-.84-.11-1.05a1 1 0 0 0-.44-.44C16.24 15 15.96 15 15.4 15H8.6c-.56 0-.84 0-1.05.11a1 1 0 0 0-.44.44C7 15.76 7 16.04 7 16.6v2.8c0 .56 0 .84.11 1.05.1.19.25.34.44.44C7.76 21 8.04 21 8.6 21z"/>
      </svg>
      <span class="sr-only">Imprimir</span>
    </button>

    <!-- Copy -->
    <button class="icon-btn" title="Copiar lista" onclick="copiarDireita()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M15 17v3a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1H7"/>
        <rect x="7" y="3" width="12" height="14" rx="1"/>
      </svg>
      <span class="sr-only">Copiar</span>
    </button>
  </div>
</header>

<!-- PAGE WRAPPER -->
<div class="page-wrapper">

  <!-- Stat bar -->
  <div class="stat-bar">
    <div class="stat-chip">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="9" y1="18" x2="9" y2="12"/><line x1="9" y1="9" x2="9" y2="9.01"/><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
      MAC Bairro São Geraldo
    </div>
    <div class="stat-chip" id="stat-filled">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
      Preenchidas: <span class="val" id="contador-val">0</span>
    </div>
    <div class="stat-chip">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
      Itens: <span class="val" id="total-val">0</span>
    </div>
  </div>

  <!-- Main grid -->
  <div class="content-grid">

    <!-- Left column -->
    <div class="col-panel">
      <div class="col-header">
        <div class="col-header-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
        </div>
        <span class="col-header-title">Lançar Quantidades</span>
        <span class="col-header-count" id="esq-count">0 itens</span>
      </div>
      <div class="col-body" id="coluna-esquerda"></div>
    </div>

    <!-- Middle controls -->
    <div class="middle-controls" id="middle-controls" aria-hidden="false">
      <button class="ctrl-btn purple" onclick="abrirModalAdicionar()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Adicionar
      </button>
      <button class="ctrl-btn blue" id="btn-transfer" onclick="transferir()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
        Transferir
      </button>
      <button class="ctrl-btn amber" onclick="alternarLinhas()" id="btn-linhas">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        Ocultar Vazios
      </button>
      <button class="ctrl-btn red" onclick="resetarTudo()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 .49-4.95"/></svg>
        Resetar Tudo
      </button>
    </div>

    <!-- Right column -->
    <div class="col-panel">
      <div class="col-header">
        <div class="col-header-icon" style="background:var(--success);">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><polyline points="20 6 9 17 4 12"/></svg>
        </div>
        <span class="col-header-title">Lista Formatada</span>
        <span class="col-header-count" id="dir-count">0 itens</span>
      </div>
      <div class="col-body" id="coluna-direita"></div>
    </div>

  </div>
</div>

<!-- Modal adicionar -->
<div class="modal-overlay" id="modal-adicionar">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      </div>
      <h2>Adicionar Novo Item</h2>
    </div>
    <div class="modal-input-group">
      <label for="nome-esquerda">Nome na coluna esquerda</label>
      <input type="text" id="nome-esquerda" placeholder="Ex: PÃO DE FORMA MP 500G">
    </div>
    <div class="modal-input-group">
      <label for="nome-direita">Nome na coluna direita</label>
      <input type="text" id="nome-direita" placeholder="Deixe em branco para preenchimento automático">
    </div>
    <div class="modal-footer">
      <button class="btn-modal cancel" onclick="fecharModalAdicionar()">Cancelar</button>
      <button class="btn-modal confirm" onclick="confirmarAdicionarItem()">Adicionar Item</button>
    </div>
  </div>
</div>

<div id="copy-notice">Copiado!</div>

<script>
/* ============================
   Dados
   ============================ */
const frasesEsquerda = [
  "PÃO DE QUEIJO RECHEADO FRANGO PAC 7 KG",
  "PÃO DE QUEIJO TRADICIONAL PACT 7 KG",
  "PÃO FRANCÊS 6HRS PAC 7 KG",
  "PÃO FRANCÊS 4HRS PAC 7 KG",
  "BAGUETE 6 HRS 7 KG",
  "BISCOITO DOCE FRITO MP 1 KG",
  "BISCOITO DE QUEIJO MP 7 KG",
  "BISCOITO SEQUILHO MP MANGA",
  "BISCOITO TRES QUEIJOS MP 7 KG",
  "BOLO FUBA CREMOSO MP 1 UNIDADE",
  "BOLO MILHO MP 1 UNIDADE",
  "BROINHA DE FUBA DOCE MP 7 KG",
  "BROINHA BACON TEMPERADA MP 7 KG",
  "CROISSANT DE FRANGO MP 7 KG",
  "CROISSANT DE PRESUNTO MP 7 KG",
  "PÃO BATATA",
  "PÃO DE MILHO",
  "PÃO DE QUEIJO MEIA LUA PAC COM 10 UNI",
  "PÃO DOCE C/CREME MP 7 KG CARACOL",
  "PÃO DOCE MP 7 KG",
  "PÃO PANHOCA MP 7KG",
  "ROSCOVADO MP UNIDADE",
  "ROSCA CREME E COCO MP PAC COM 5 UNI",
  "ROSCA TRANÇA MP PAC COM 10 UNID",
  "ROSCA TRANCINHA MP PAC 3KG",
  "ROSCA TRANÇA REDONDA MP",
  "ROSQUINHA CANUDINHO DE QUEIJO MP PAC COM 7KG",
  "SALGADO COXINHA DE FRANGO MP 1 KG",
  "SALGADOS BOLINHA DE CARNE MP 1 KG",
  "SALGADOS EMPADA DE FRANGO MP 1 KG",
  "SALGADOS ENROLADINHO PRESUNTO MP 1 KG",
  "SALGADOS PASTEL CATUPIRY MP 1 KG",
  "SALGADOS KIBE CATUPIRY MP 1 KG",
  "SONHO MP PAC 3 KG"
];

const mapeamentoProdutos = {
  "PÃO DE QUEIJO RECHEADO FRANGO PAC 7 KG": "Pão de queijo recheado frango pequeno 7kg",
  "PÃO DE QUEIJO TRADICIONAL PACT 7 KG": "Pão de queijo tradicional pequeno 7kg",
  "PÃO FRANCÊS 6HRS PAC 7 KG": "Pão francês 06hrs 7kg",
  "PÃO FRANCÊS 4HRS PAC 7 KG": "Pão francês 04hrs 7kg",
  "BAGUETE 6 HRS 7 KG": "Baguete 06hrs 7kg",
  "BISCOITO DOCE FRITO MP 1 KG": "Biscoitinho doce frito 1kg",
  "BISCOITO DE QUEIJO MP 7 KG": "Biscoito de queijo 7kg",
  "BISCOITO SEQUILHO MP MANGA": "Mistura biscoito sequilho 4kg",
  "BISCOITO TRES QUEIJOS MP 7 KG": "Biscoito três queijos 7kg",
  "BOLO FUBA CREMOSO MP 1 UNIDADE": "Bolo cremoso de fubá 1 unidade",
  "BOLO MILHO MP 1 UNIDADE": "Bolo cremoso de milho 1 unidade",
  "BROINHA DE FUBA DOCE MP 7 KG": "Broinha de fubá doce 7kg",
  "BROINHA BACON TEMPERADA MP 7 KG": "Broinha temperada com bacon 7kg",
  "CROISSANT DE FRANGO MP 7 KG": "Croissant de frango 7kg",
  "CROISSANT DE PRESUNTO MP 7 KG": "Croissant de presunto 7kg",
  "PÃO BATATA": "Pão de batata 7kg",
  "PÃO DE MILHO": "Pão de milho 7kg",
  "PÃO DE QUEIJO MEIA LUA PAC COM 10 UNI": "Meia lua 1kg com 10 unidades",
  "PÃO DOCE C/CREME MP 7 KG CARACOL": "Caracol 7kg",
  "PÃO DOCE MP 7 KG": "Carioca 7kg",
  "PÃO PANHOCA MP 7KG": "Panhoca 7kg",
  "ROSCOVADO MP UNIDADE": "Roscovado 1 unidade",
  "ROSCA CREME E COCO MP PAC COM 5 UNI": "Rosca creme e coco PCT 5 unidades",
  "ROSCA TRANÇA MP PAC COM 10 UNID": "Trança PCT 10 unidades",
  "ROSCA TRANCINHA MP PAC 3KG": "Trancinha PCT 3kg",
  "ROSCA TRANÇA REDONDA MP": "Trancinha redonda",
  "ROSQUINHA CANUDINHO DE QUEIJO MP PAC COM 7KG": "Canudinho de queijo 7kg",
  "SALGADO COXINHA DE FRANGO MP 1 KG": "Coxinha de frango pequena 1kg",
  "SALGADOS BOLINHA DE CARNE MP 1 KG": "Bolinha de carne pequena 1kg",
  "SALGADOS EMPADA DE FRANGO MP 1 KG": "Empadinha de frango pequena 1kg",
  "SALGADOS ENROLADINHO PRESUNTO MP 1 KG": "Enroladinho de presunto pequeno 1kg",
  "SALGADOS PASTEL CATUPIRY MP 1 KG": "Pastelzinho catupiry pequeno 1kg",
  "SALGADOS KIBE CATUPIRY MP 1 KG": "Quibe com catupiry pequeno 1kg",
  "SONHO MP PAC 3 KG": "Sonho PCT 3kg"
};

const itensAdicionados = { esquerda: [], direita: [] };

let frasesDireitaOrdenadas = Object.values(mapeamentoProdutos).sort((a, b) =>
  a.localeCompare(b, 'pt-BR', { sensitivity: 'base' })
);

const mapeamentoReverso = {};
Object.keys(mapeamentoProdutos).forEach(k => {
  mapeamentoReverso[mapeamentoProdutos[k]] = k;
});

/* ============================
   Utilitários
   ============================ */
function showBottomNotice(msg = 'Copiado!', dur = 2000) {
  const el = document.getElementById('copy-notice');
  if (!el) return;
  if (el._t) { clearTimeout(el._t); el._t = null; }
  el.textContent = msg;
  el.style.display = 'block';
  el._t = setTimeout(() => { el.style.display = 'none'; el._t = null; }, dur);
}

/* ============================
   Modal
   ============================ */
function abrirModalAdicionar() {
  document.getElementById('modal-adicionar').style.display = 'flex';
  document.getElementById('nome-esquerda').focus();
}
function fecharModalAdicionar() {
  document.getElementById('modal-adicionar').style.display = 'none';
  document.getElementById('nome-esquerda').value = '';
  document.getElementById('nome-direita').value = '';
}
function confirmarAdicionarItem() {
  const nomeEsq = document.getElementById('nome-esquerda').value.trim();
  let nomeDir   = document.getElementById('nome-direita').value.trim();
  if (!nomeEsq) { showBottomNotice('Preencha o nome da coluna esquerda!'); return; }
  if (!nomeDir)  nomeDir = nomeEsq.toLowerCase().replace(/\b\w/g, l => l.toUpperCase());
  if ([...frasesEsquerda, ...itensAdicionados.esquerda].includes(nomeEsq)) {
    showBottomNotice('Item já existe na coluna esquerda!'); return;
  }
  if (frasesDireitaOrdenadas.includes(nomeDir)) {
    showBottomNotice('Item já existe na coluna direita!'); return;
  }
  itensAdicionados.esquerda.push(nomeEsq);
  mapeamentoProdutos[nomeEsq] = nomeDir;
  mapeamentoReverso[nomeDir] = nomeEsq;
  frasesDireitaOrdenadas = Object.values(mapeamentoProdutos).sort((a, b) =>
    a.localeCompare(b, 'pt-BR', { sensitivity: 'base' })
  );
  montarInterface();
  fecharModalAdicionar();
  showBottomNotice('Item adicionado com sucesso!');
}

function removerItem(nomeEsq, nomeDir) {
  const idx = itensAdicionados.esquerda.indexOf(nomeEsq);
  if (idx > -1) itensAdicionados.esquerda.splice(idx, 1);
  delete mapeamentoProdutos[nomeEsq];
  delete mapeamentoReverso[nomeDir];
  frasesDireitaOrdenadas = Object.values(mapeamentoProdutos).sort((a, b) =>
    a.localeCompare(b, 'pt-BR', { sensitivity: 'base' })
  );
  montarInterface();
  showBottomNotice('Item removido.');
}

document.addEventListener('keydown', e => {
  if (e.key === 'Escape') fecharModalAdicionar();
});
document.getElementById('modal-adicionar').addEventListener('click', e => {
  if (e.target.id === 'modal-adicionar') fecharModalAdicionar();
});

/* ============================
   Construção da interface
   ============================ */
function montarInterface() {
  const colEsq = document.getElementById('coluna-esquerda');
  const colDir = document.getElementById('coluna-direita');
  colEsq.innerHTML = '';
  colDir.innerHTML = '';

  const todosEsquerda = [...frasesEsquerda, ...itensAdicionados.esquerda];

  todosEsquerda.forEach((frase, i) => {
    const isCustom = i >= frasesEsquerda.length;
    const item = document.createElement('div');
    item.className = 'item' + (isCustom ? ' novo-item' : '');

    const label = document.createElement('span');
    label.textContent = frase;

    const input = document.createElement('input');
    input.type = 'text';
    input.dataset.index = i;
    input.dataset.nome = frase;
    input.setAttribute('inputmode', 'numeric');
    input.setAttribute('aria-label', `Quantidade ${frase}`);

    input.addEventListener('input', () => {
      const f = input.value.replace(/[^0-9]/g, '');
      if (input.value !== f) input.value = f;
    });
    input.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        e.preventDefault();
        const next = colEsq.querySelector(`input[data-index="${i+1}"]`);
        if (next) next.focus();
      }
    });

    item.appendChild(label);
    item.appendChild(input);

    if (isCustom) {
      const btn = document.createElement('button');
      btn.className = 'remove-btn';
      btn.title = 'Remover item';
      btn.textContent = '✕';
      btn.onclick = () => removerItem(frase, mapeamentoProdutos[frase]);
      item.appendChild(btn);
    }
    colEsq.appendChild(item);
  });

  frasesDireitaOrdenadas.forEach((frase, i) => {
    const nomeOriginal = mapeamentoReverso[frase];
    const isCustom = itensAdicionados.esquerda.includes(nomeOriginal);
    const item = document.createElement('div');
    item.className = 'item' + (isCustom ? ' novo-item' : '');

    const label = document.createElement('span');
    label.textContent = frase;

    const output = document.createElement('input');
    output.type = 'text';
    output.readOnly = true;
    output.dataset.index = i;
    output.dataset.nome = frase;
    output.setAttribute('aria-label', `Resultado ${frase}`);

    item.appendChild(label);
    item.appendChild(output);

    if (isCustom) {
      const btn = document.createElement('button');
      btn.className = 'remove-btn';
      btn.title = 'Remover item';
      btn.textContent = '✕';
      btn.onclick = () => removerItem(nomeOriginal, frase);
      item.appendChild(btn);
    }
    colDir.appendChild(item);
  });

  atualizarContagem();
}

/* ============================
   Funções principais
   ============================ */
function transferir() {
  const inputs  = Array.from(document.querySelectorAll('#coluna-esquerda input'));
  const outputs = Array.from(document.querySelectorAll('#coluna-direita input'));
  outputs.forEach(o => o.value = '');
  inputs.forEach(input => {
    if (input.value.trim()) {
      const nomeFormatado = mapeamentoProdutos[input.dataset.nome];
      const out = outputs.find(o => o.dataset.nome === nomeFormatado);
      if (out) out.value = input.value.trim();
    }
  });
  atualizarContagem();
}

let linhasOcultas = false;
let elementosOcultos = [];

function alternarLinhas() {
  const btn = document.getElementById('btn-linhas');
  if (!linhasOcultas) {
    const items = document.querySelectorAll('#coluna-direita .item');
    elementosOcultos = [];
    items.forEach(it => {
      const inp = it.querySelector('input');
      if (inp && inp.value.trim() === '') {
        it.style.display = 'none';
        elementosOcultos.push(it);
      }
    });
    btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>Mostrar Todos`;
  } else {
    elementosOcultos.forEach(el => el.style.display = '');
    elementosOcultos = [];
    btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>Ocultar Vazios`;
  }
  linhasOcultas = !linhasOcultas;
}

function resetarTudo() {
  document.querySelectorAll("input[type='text']").forEach(i => i.value = '');
  if (linhasOcultas) {
    elementosOcultos.forEach(el => el.style.display = '');
    elementosOcultos = [];
    linhasOcultas = false;
    const btn = document.getElementById('btn-linhas');
    btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>Ocultar Vazios`;
  }
  atualizarContagem();
}

function atualizarContagem() {
  const outputs = document.querySelectorAll('#coluna-direita input');
  let preenchidos = 0;
  outputs.forEach(o => {
    if (o.parentElement.style.display !== 'none' && o.value.trim()) preenchidos++;
  });
  const total = [...frasesEsquerda, ...itensAdicionados.esquerda].length;
  document.getElementById('contador-val').textContent = preenchidos;
  document.getElementById('total-val').textContent = total;
  document.getElementById('esq-count').textContent = total + ' itens';
  document.getElementById('dir-count').textContent = frasesDireitaOrdenadas.length + ' itens';
}

/* ============================
   Copiar
   ============================ */
function copiarDireita() {
  const outputs = Array.from(document.querySelectorAll('#coluna-direita input'));
  const textos = [];
  outputs.forEach(o => {
    if (o.value.trim()) {
      const label = o.parentElement.querySelector('span').textContent;
      textos.push(`${label}: ${o.value}`);
    }
  });
  const texto = textos.join('\n');
  if (!texto) { showBottomNotice('Nada para copiar'); return; }
  navigator.clipboard.writeText(texto).then(() => {
    showBottomNotice('Copiado!');
  }).catch(() => {
    const ta = document.createElement('textarea');
    ta.value = texto; ta.style.position = 'fixed'; ta.style.left = '-9999px';
    document.body.appendChild(ta); ta.select();
    try { document.execCommand('copy'); showBottomNotice('Copiado!'); } catch(e) { showBottomNotice('Falha ao copiar'); }
    ta.remove();
  });
}

/* ============================
   Salvar TXT / PDF / Excel
   ============================ */
function salvarComoTXT(e) {
  if (e) e.preventDefault();
  const outputs = Array.from(document.querySelectorAll('#coluna-direita input'));
  const linhas = [];
  outputs.forEach(o => {
    if (o.value.trim()) {
      linhas.push(`${o.parentElement.querySelector('span').textContent}: ${o.value}`);
    }
  });
  if (!linhas.length) { showBottomNotice('Nenhum item preenchido'); return; }
  baixarArquivo(linhas.join('\n'), 'lista_mac_77.txt', 'text/plain');
  showBottomNotice('Arquivo TXT salvo');
}

function salvarComoPDF(e) {
  if (e) e.preventDefault();
  const outputs = Array.from(document.querySelectorAll('#coluna-direita input'));
  const linhas = [];
  outputs.forEach(o => {
    if (o.value.trim()) linhas.push({ texto: o.parentElement.querySelector('span').textContent, valor: o.value.trim() });
  });
  if (!linhas.length) { showBottomNotice('Nenhum item preenchido'); return; }
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: 'pt', format: 'a4' });
  doc.setFont('courier', 'normal'); doc.setFontSize(11);
  const ml = 40, mw = doc.internal.pageSize.getWidth() - ml * 2;
  let y = 40;
  doc.text('MAC Bairro São Geraldo — Cód. 77', ml, y); y += 18;
  linhas.forEach(({ texto, valor }) => {
    if (y > doc.internal.pageSize.getHeight() - 40) { doc.addPage(); y = 40; }
    doc.text(texto, ml, y, { maxWidth: mw });
    doc.text(String(valor), ml + 360, y);
    y += 14;
  });
  if (y > doc.internal.pageSize.getHeight() - 30) { doc.addPage(); y = 40; }
  y += 8;
  doc.text(`Linhas preenchidas: ${linhas.length}`, ml, y);
  doc.save('lista_mac_77.pdf');
  showBottomNotice('PDF salvo');
}

function salvarComoExcel(e) {
  if (e) e.preventDefault();
  const outputs = Array.from(document.querySelectorAll('#coluna-direita input'));
  const data = [['Produto', 'Quantidade']];
  outputs.forEach(o => {
    if (o.value.trim()) data.push([o.parentElement.querySelector('span').textContent, o.value.trim()]);
  });
  if (data.length === 1) { showBottomNotice('Nenhum item preenchido'); return; }
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.aoa_to_sheet(data);
  XLSX.utils.book_append_sheet(wb, ws, 'MAC 77');
  XLSX.writeFile(wb, 'lista_mac_77.xlsx');
  showBottomNotice('Excel salvo');
}

/* ============================
   Imprimir
   ============================ */
function prepareAndPrint() {
  const printBtn = document.getElementById('btn-print');
  if (printBtn) printBtn.disabled = true;
  transferir();
  const total = [...frasesEsquerda, ...itensAdicionados.esquerda].length;
  document.body.classList.remove('print-tight');
  if (total > 34) document.body.classList.add('print-tight');
  const cleanup = () => {
    document.body.classList.remove('print-tight');
    try { window.removeEventListener('afterprint', cleanup); } catch(e){}
    if (printBtn) printBtn.disabled = false;
  };
  try { window.addEventListener('afterprint', cleanup); } catch(e){}
  try { window.print(); } catch(err) { showBottomNotice('Falha ao imprimir'); setTimeout(cleanup, 1000); }
}

/* ============================
   Util
   ============================ */
function baixarArquivo(conteudo, nome, tipo) {
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([conteudo], { type: tipo }));
  a.download = nome;
  document.body.appendChild(a); a.click(); a.remove();
}

/* ============================
   Menus / dropdown
   ============================ */
function toggleMenu(id) {
  document.querySelectorAll('.menu-dropdown-content').forEach(el => {
    if (el.id !== id) { el.style.display = 'none'; el.setAttribute('aria-hidden','true'); }
  });
  const el = document.getElementById(id);
  if (!el) return;
  const open = el.style.display === 'block';
  if (open) { el.style.display = 'none'; el.setAttribute('aria-hidden','true'); closeAllSubmenus(); }
  else { closeAllSubmenus(); el.style.display = 'block'; el.setAttribute('aria-hidden','false'); }
}

function toggleSubmenu(headerEl) {
  const sub = headerEl.nextElementSibling;
  if (!sub) return;
  const chev = headerEl.querySelector('.chev');
  const isOpen = sub.style.display === 'block';
  sub.style.display = isOpen ? 'none' : 'block';
  if (chev) chev.textContent = isOpen ? '▸' : '▾';
}

function closeAllSubmenus() {
  document.querySelectorAll('.submenu').forEach(s => s.style.display = 'none');
  document.querySelectorAll('.chev').forEach(c => c.textContent = '▸');
}

document.addEventListener('click', ev => {
  if (!ev.target.closest('.menu-dropdown') && !ev.target.closest('.menu-right')) {
    document.querySelectorAll('.menu-dropdown-content').forEach(el => {
      el.style.display = 'none'; el.setAttribute('aria-hidden','true');
    });
    closeAllSubmenus();
  }
});

document.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    document.querySelectorAll('.menu-dropdown-content').forEach(el => {
      el.style.display = 'none'; el.setAttribute('aria-hidden','true');
    });
    closeAllSubmenus();
  }
});

/* ============================
   Navegação
   ============================ */
function fecharPagina() { window.location.href = 'index.html'; }
function voltarMenu()   { window.location.href = 'index.html'; }

function abrirMac(e, nome) {
  try {
    if (e && e.currentTarget) {
      const href = e.currentTarget.getAttribute('href');
      if (href && href !== '#') {
        closeAllSubmenus();
        document.querySelectorAll('.menu-dropdown-content').forEach(el => { el.style.display = 'none'; });
        window.location.href = href; return;
      }
    }
  } catch(err){}
  if (e) e.preventDefault();
}

function abrirLocal(e, nome) {
  try {
    if (e && e.currentTarget) {
      const href = e.currentTarget.getAttribute('href');
      if (href && href !== '#') {
        closeAllSubmenus();
        document.querySelectorAll('.menu-dropdown-content').forEach(el => { el.style.display = 'none'; });
        window.location.href = href; return;
      }
    }
  } catch(err){}
  if (e) e.preventDefault();
}

/* ============================
   Init
   ============================ */
montarInterface();

document.getElementById('btn-print').addEventListener('click', ev => {
  ev.preventDefault();
  if (!document.getElementById('btn-print').disabled) prepareAndPrint();
});
</script>
</body>
</html>
